{"meta":{"version":1,"warehouse":"4.0.2"},"models":{"Asset":[{"_id":"source/img/20230822143445.jpg","path":"img/20230822143445.jpg","modified":1,"renderable":0},{"_id":"source/img/20230818103122.jpg","path":"img/20230818103122.jpg","modified":1,"renderable":0},{"_id":"themes/butterfly/source/css/index.styl","path":"css/index.styl","modified":1,"renderable":1},{"_id":"themes/butterfly/source/css/var.styl","path":"css/var.styl","modified":1,"renderable":1},{"_id":"themes/butterfly/source/img/20230818103122.jpg","path":"img/20230818103122.jpg","modified":1,"renderable":1},{"_id":"themes/butterfly/source/img/20230823160932.png","path":"img/20230823160932.png","modified":1,"renderable":1},{"_id":"themes/butterfly/source/img/404.jpg","path":"img/404.jpg","modified":1,"renderable":1},{"_id":"themes/butterfly/source/img/favicon.png","path":"img/favicon.png","modified":1,"renderable":1},{"_id":"themes/butterfly/source/img/friend_404.gif","path":"img/friend_404.gif","modified":1,"renderable":1},{"_id":"themes/butterfly/source/img/thumbbig-1221433.jpg","path":"img/thumbbig-1221433.jpg","modified":1,"renderable":1},{"_id":"themes/butterfly/source/js/main.js","path":"js/main.js","modified":1,"renderable":1},{"_id":"themes/butterfly/source/js/tw_cn.js","path":"js/tw_cn.js","modified":1,"renderable":1},{"_id":"themes/butterfly/source/js/utils.js","path":"js/utils.js","modified":1,"renderable":1},{"_id":"themes/butterfly/source/js/search/algolia.js","path":"js/search/algolia.js","modified":1,"renderable":1},{"_id":"themes/butterfly/source/js/search/local-search.js","path":"js/search/local-search.js","modified":1,"renderable":1}],"Cache":[{"_id":"source/_data/link.yaml","hash":"80576ac894f882f25903e2ab824427b8d11988cd","modified":1692324729920},{"_id":"source/_drafts/draft.md","hash":"b472be5771163e18b109ee34e0cc62ba571bb40d","modified":1692327202494},{"_id":"source/_posts/hello-world.md","hash":"9db9748dfecfc3146a3239035331efaf5cb9cf92","modified":1692774850502},{"_id":"source/about/index.md","hash":"67d4cc7108911b8662a0201bdabf042dbaef7b09","modified":1691119039026},{"_id":"source/categories/index.md","hash":"d77b6f39e85b912ee0a4f6708974edf1677f7c8a","modified":1692324631370},{"_id":"source/link/index.md","hash":"b749372caa351fad232a4420c82ae06acca33d7a","modified":1692324680798},{"_id":"source/tags/index.md","hash":"fbfe43a3c44f87bafe265cc8d0ef3de7acbed1cf","modified":1692324602674},{"_id":"source/_posts/docker/uninstall_docker.md","hash":"fe3044b3520af04ef501894ee9345b302546540f","modified":1692856339606},{"_id":"source/_posts/golang/go_template.md","hash":"576c203bdf37b4a835f657a26c086ef704896acc","modified":1692773723180},{"_id":"source/_posts/golang/last_version_mod.md","hash":"3623367c5fa8c4ff5bc93b1d023e8b8844fe4f7e","modified":1692773729952},{"_id":"source/_posts/nodejs/install_nodejs.md","hash":"46282da1aa96fc8843c1209df2da921cf4727795","modified":1692693367375},{"_id":"source/_posts/linux/chrony.md","hash":"3428f5425df5d51f9c87d98c60f194fc6367d9a1","modified":1698390511967},{"_id":"source/_posts/kubernetes/deepflow-dashboard.md","hash":"7db65ddc47fbd7bc9346e36fa86c207ce42b8807","modified":1697620707736},{"_id":"source/_posts/kubernetes/efk.md","hash":"07bac5cc6a41a1525479956266d636f71466ed6d","modified":1692866102494},{"_id":"source/_posts/kubernetes/fluent_Bit_Fluentd.md","hash":"aad3274f394baa501e2ac724183f136ec885b562","modified":1692864882291},{"_id":"source/_posts/kubernetes/grafana-create-alert-rule.md","hash":"7a4562029a4e3333ce5ba8be8c19a59651db0ee4","modified":1693473182480},{"_id":"source/_posts/kubernetes/image-1.png","hash":"0bae2d21312c343fd0a9d5e3a08ba0a22a4c740e","modified":1697619448570},{"_id":"source/_posts/kubernetes/kibana-ilm.md","hash":"aee2063dbe6ef6784d668fe3587af183a9524513","modified":1693901792662},{"_id":"source/_posts/kubernetes/kubevirt-vm-expose.md","hash":"df504cf158ab3119727bdc8edf94fac62eae5b17","modified":1693561138859},{"_id":"source/_posts/kubernetes/metrics-server.md","hash":"72afa48992cda6663acfd8d8be61fb5a044ebc8d","modified":1692930793160},{"_id":"source/_posts/kubernetes/monitor.md","hash":"4ddc99d69c473ffb33b4ad5bed84de4e4a072d3a","modified":1692773744756},{"_id":"source/_posts/kubernetes/uninstall_cintainerd.md","hash":"18cfe19dd7d2878fdbf3f37b6420a060227dd464","modified":1692689392616},{"_id":"source/img/20230818103122.jpg","hash":"690b5dbaea6aff4c293708ec80de2ac601b3495c","modified":1692325882489},{"_id":"source/_posts/kubernetes/image.png","hash":"c00ddad579b17a31ca404ab556135d9d91b6cdf4","modified":1697619408222},{"_id":"source/img/20230822143445.jpg","hash":"3a109901811ca6833fb3223189064fa867653bbf","modified":1692686095318},{"_id":"source/_posts/kubernetes/image-11.png","hash":"f090d32691a601a3a72c857178314feb6f4a4a1e","modified":1697619571328},{"_id":"source/_posts/kubernetes/image-22.png","hash":"e1c93d730901898a27860e76a6f84d353fb2101b","modified":1697619686062},{"_id":"source/_posts/kubernetes/image-23.png","hash":"e1c93d730901898a27860e76a6f84d353fb2101b","modified":1697619695438},{"_id":"source/_posts/kubernetes/image-10.png","hash":"7d76732ad4527872e296755bdf77e63913403408","modified":1697619561608},{"_id":"source/_posts/kubernetes/image-12.png","hash":"0d05e583a35c37c95401e432d9095adbc3cc01b2","modified":1697619579008},{"_id":"source/_posts/kubernetes/image-2.png","hash":"8cf3b9cff450966ebfb92ce8064a3ff7fc999a1c","modified":1697619496901},{"_id":"source/_posts/kubernetes/image-26.png","hash":"eb6b5a407fe209b16f295dba705c53f81be24d3e","modified":1697619909607},{"_id":"source/_posts/kubernetes/image-27.png","hash":"eb6b5a407fe209b16f295dba705c53f81be24d3e","modified":1697619925471},{"_id":"source/_posts/kubernetes/image-25.png","hash":"eb6b5a407fe209b16f295dba705c53f81be24d3e","modified":1697619900099},{"_id":"source/_posts/kubernetes/image-28.png","hash":"eb6b5a407fe209b16f295dba705c53f81be24d3e","modified":1697619936771},{"_id":"source/_posts/kubernetes/image-29.png","hash":"eb6b5a407fe209b16f295dba705c53f81be24d3e","modified":1697620057858},{"_id":"source/_posts/kubernetes/image-16.png","hash":"7c0981723b4a22b60e2f1e5d2ed85b82735afec7","modified":1697619620123},{"_id":"source/_posts/kubernetes/image-17.png","hash":"7c0981723b4a22b60e2f1e5d2ed85b82735afec7","modified":1697619626943},{"_id":"source/_posts/kubernetes/image-21.png","hash":"bb110c2d27853f867fd2c701783dfc4d7900169e","modified":1697619678634},{"_id":"source/_posts/kubernetes/image-20.png","hash":"aee0b068cfdfc7ca5ee5c7a4571c704f766ef8ee","modified":1697619669930},{"_id":"themes/butterfly/LICENSE","hash":"1128f8f91104ba9ef98d37eea6523a888dcfa5de","modified":1691120115272},{"_id":"themes/butterfly/README.md","hash":"b5d6e7271b88d1a63755386442663af03e36a428","modified":1691120115276},{"_id":"themes/butterfly/README_CN.md","hash":"86569b94949392e9b981608433495f0941d20b0c","modified":1691120115276},{"_id":"themes/butterfly/_config.yml","hash":"be87170c21e91b4eac9ccf9a76eb5adf16f048c3","modified":1692857608301},{"_id":"themes/butterfly/package.json","hash":"1646604798f745ef068852772eb22239985ba731","modified":1691120115284},{"_id":"themes/butterfly/languages/default.yml","hash":"4025c0ba440eb24705dd0293ca9ca84efb3105cc","modified":1691120115276},{"_id":"themes/butterfly/languages/zh-CN.yml","hash":"7dd849c3ba34986c57c764d9e36150b4bfffd2e9","modified":1691120115276},{"_id":"themes/butterfly/plugins.yml","hash":"d0e179ae31cdc62037062432b0ee7a9008155a73","modified":1691120115284},{"_id":"themes/butterfly/languages/zh-TW.yml","hash":"ee01e068f12dc33adfae5733824ea1255deb5ca6","modified":1691120115276},{"_id":"themes/butterfly/languages/en.yml","hash":"4e9cdb7a3570929bcf082de7a4eac49140dddc73","modified":1691120115276},{"_id":"themes/butterfly/layout/category.pug","hash":"710708cfdb436bc875602abf096c919ccdf544db","modified":1691120115276},{"_id":"themes/butterfly/layout/index.pug","hash":"e1c3146834c16e6077406180858add0a8183875a","modified":1691120115284},{"_id":"themes/butterfly/layout/page.pug","hash":"baf469784aef227e4cc840550888554588e87a13","modified":1691120115284},{"_id":"themes/butterfly/layout/post.pug","hash":"fc9f45252d78fcd15e4a82bfd144401cba5b169a","modified":1691120115284},{"_id":"themes/butterfly/layout/archive.pug","hash":"a0c034c2d319320a54046805e80b58dc48b7e233","modified":1691120115276},{"_id":"themes/butterfly/layout/tag.pug","hash":"0440f42569df2676273c026a92384fa7729bc4e9","modified":1691120115284},{"_id":"themes/butterfly/layout/includes/404.pug","hash":"cb49f737aca272ccfeb62880bd651eccee72a129","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/additional-js.pug","hash":"aca0ec7ef69b21d1f242c62fed389468a0f0e1a2","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/footer.pug","hash":"02390a5b6ae1f57497b22ba2e6be9f13cfb7acac","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/head.pug","hash":"dd9fde431add984330e3178e06a8d74705e7340e","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/layout.pug","hash":"7fa9ae4b70b87fc97e992dde5944681f92b59bea","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/pagination.pug","hash":"4c85de4dea4dca4e5088097a79bd6d7009cbf8ef","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/rightside.pug","hash":"d15124c488273ea0801a042888feadc9261d0b2f","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/sidebar.pug","hash":"9f0e9e039f304439007460fa0a7c8ac18e0ffd37","modified":1691120115276},{"_id":"themes/butterfly/scripts/events/404.js","hash":"83cd7f73225ccad123afbd526ce1834eb1eb6a6d","modified":1691120115284},{"_id":"themes/butterfly/scripts/events/cdn.js","hash":"21fb5aabe043486d095c4c8cce361ed85ba88a26","modified":1691120115284},{"_id":"themes/butterfly/scripts/events/comment.js","hash":"5351e0bc09e6b5b3f6d30f333a2520626a28ca3a","modified":1691120115284},{"_id":"themes/butterfly/scripts/events/init.js","hash":"428b94c7b9e83f7ea36227dee66bfe3c23aee4a8","modified":1691120115284},{"_id":"themes/butterfly/scripts/events/stylus.js","hash":"9819f0996234fbd80d6c50a9e526c56ebf22588d","modified":1691120115284},{"_id":"themes/butterfly/scripts/events/welcome.js","hash":"8ad9911b755cba13dde2cc055c3f857a6b0dd20e","modified":1691120115284},{"_id":"themes/butterfly/scripts/filters/post_lazyload.js","hash":"932df912976261929f809b7dbd4eb473e7787345","modified":1691120115284},{"_id":"themes/butterfly/scripts/filters/random_cover.js","hash":"8d25f47434deae870bbffd07efe528a40363ab4d","modified":1691120115284},{"_id":"themes/butterfly/scripts/helpers/aside_archives.js","hash":"2ec66513d5322f185d2071acc052978ba9415a8e","modified":1691120115284},{"_id":"themes/butterfly/scripts/helpers/aside_categories.js","hash":"e00efdb5d02bc5c6eb4159e498af69fa61a7dbb9","modified":1691120115284},{"_id":"themes/butterfly/scripts/helpers/findArchiveLength.js","hash":"9ea86bd7a3c3fca3324f70b1cd4d9e42f9efb08d","modified":1691120115284},{"_id":"themes/butterfly/scripts/helpers/inject_head_js.js","hash":"4238e06ff448ff2ee717cd4c874f37f04d35da06","modified":1691120115284},{"_id":"themes/butterfly/scripts/helpers/page.js","hash":"ce5d5a3d07b0d76ac5e96e5f9e5783f4b601b6be","modified":1691120115284},{"_id":"themes/butterfly/scripts/helpers/related_post.js","hash":"4677be4175da6800c0b3b8c1614e593f73df8831","modified":1691120115284},{"_id":"themes/butterfly/scripts/tag/button.js","hash":"91d954f6e9fe6e571eb8ec9f8996294b2dc3688e","modified":1691120115284},{"_id":"themes/butterfly/scripts/tag/flink.js","hash":"ab62919fa567b95fbe14889517abda649991b1ee","modified":1691120115284},{"_id":"themes/butterfly/scripts/tag/gallery.js","hash":"950b3dbac0b21717458a8d1769cbfc454d0eff54","modified":1691120115284},{"_id":"themes/butterfly/scripts/tag/hide.js","hash":"396c3ab1bcf1c7693ad7e506eadd13016c6769b6","modified":1691120115284},{"_id":"themes/butterfly/scripts/tag/inlineImg.js","hash":"a43ee2c7871bdd93cb6beb804429e404570f7929","modified":1691120115284},{"_id":"themes/butterfly/scripts/tag/label.js","hash":"03b2afef41d02bd1045c89578a02402c28356006","modified":1691120115284},{"_id":"themes/butterfly/scripts/tag/mermaid.js","hash":"531808a290b8bdd66bac2faab211ada8e9646a37","modified":1691120115284},{"_id":"themes/butterfly/scripts/tag/note.js","hash":"d51812b43924f1bbf413c67499510dd125022005","modified":1691120115284},{"_id":"themes/butterfly/scripts/tag/score.js","hash":"ea679dfe12d0e2290113b4a9d00663ce7a5ee5ad","modified":1691120115284},{"_id":"themes/butterfly/scripts/tag/tabs.js","hash":"6c6e415623d0fd39da016d9e353bb4f5cca444f5","modified":1691120115284},{"_id":"themes/butterfly/scripts/tag/timeline.js","hash":"300eb779588bf35a1b687d9f829d866074b707e3","modified":1691120115284},{"_id":"themes/butterfly/source/css/index.styl","hash":"755490867fd8afe47d5cce24faea2ca172b0c4dd","modified":1691120115292},{"_id":"themes/butterfly/source/css/var.styl","hash":"30abbb8eed880d51f61f336064d93abd709e0115","modified":1691120115292},{"_id":"themes/butterfly/source/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":1691120115292},{"_id":"themes/butterfly/source/img/favicon.png","hash":"3cf89864b4f6c9b532522a4d260a2e887971c92d","modified":1691120115292},{"_id":"themes/butterfly/source/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1691120115292},{"_id":"themes/butterfly/source/img/thumbbig-1221433.jpg","hash":"8c32ca61f09cf449dee0024a21972a3ad9c26eff","modified":1692857524894},{"_id":"themes/butterfly/source/js/main.js","hash":"0227b5bd233a3c66582e0ee820cdb353ce52ece1","modified":1691120115292},{"_id":"themes/butterfly/source/js/tw_cn.js","hash":"42b106354d72a0ea1fe62587b313a5b7de3cc393","modified":1691120115292},{"_id":"themes/butterfly/source/js/utils.js","hash":"aaaedc207440095da1ffabcad870fc2641befb0e","modified":1691120115292},{"_id":"themes/butterfly/layout/includes/head/Open_Graph.pug","hash":"8aa8d799aedbfd811195b84a451bc4b6e2647c12","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/head/analytics.pug","hash":"67e1c3b48e4ca7ee0b2c76d3ca7476b9883cf105","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/head/config.pug","hash":"75e7a524af64fbaaaf7b05a1b1922bf6940d7afe","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/head/config_site.pug","hash":"7df90c8e432e33716517ab918b0a125bc284041b","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/head/noscript.pug","hash":"d16ad2ee0ff5751fd7f8a5ce1b83935518674977","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/head/google_adsense.pug","hash":"95a37e92b39c44bcbea4be7e29ddb3921c5b8220","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/head/preconnect.pug","hash":"a03b3ddc06e7aa9fd07eea0d5f97c8d5addd2315","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/head/pwa.pug","hash":"3d492cfe645d37c94d30512e0b230b0a09913148","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/head/site_verification.pug","hash":"e2e8d681f183f00ce5ee239c42d2e36b3744daad","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/header/index.pug","hash":"944d6e9dd50df3395f3a2c7ad9db667d50dea4ed","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/header/menu_item.pug","hash":"31346a210f4f9912c5b29f51d8f659913492f388","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/header/nav.pug","hash":"f61659aa457d1a2d1baa3a13157996cfac4d6609","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/header/post-info.pug","hash":"9698f22751778dde063cbfbd01c59ca4462ccd85","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/header/social.pug","hash":"5de9a82032cdad1db3b868b797460921cd775fc2","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/loading/fullpage-loading.pug","hash":"9e8c5788602b29a527ef35fe8a20076a5fa969bd","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/loading/index.pug","hash":"131f344d68b4c241d6e03849b243ee792fcd3cea","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/loading/pace.pug","hash":"6ab4e301c92586505d6cddce1b3ad23b7c79010d","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/mixins/post-ui.pug","hash":"1ed873db25eec869beebb6873f04e19f0b0f4134","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/mixins/article-sort.pug","hash":"90554c2ca5ba946f4c02e1bc5fe2859cef1b1594","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/page/categories.pug","hash":"5276a8d2835e05bd535fedc9f593a0ce8c3e8437","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/page/default-page.pug","hash":"12c65c174d26a41821df9bad26cdf1087ec5b0ca","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/page/flink.pug","hash":"f9ce83978b217a71a2eb8761dc14b09866faa3f4","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/page/tags.pug","hash":"9621991359e22b14049346f1cf87bdedc94edf5a","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/post/post-copyright.pug","hash":"ebecba46a5f4efe1c98a386df06c56e26fbd07b9","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/post/reward.pug","hash":"864869c43fe5b5bb6f4ac6b13dd4bfb16ea47550","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/third-party/aplayer.pug","hash":"c7cfade2b160380432c47eef4cd62273b6508c58","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/third-party/effect.pug","hash":"6528e86656906117a1af6b90e0349c2c4651d5e1","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/pangu.pug","hash":"0f024e36b8116118233e10118714bde304e01e12","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/pjax.pug","hash":"cde142861edfc7aab435b8a0ebb84d9ba450fb5b","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/prismjs.pug","hash":"ffb9ea15a2b54423cd4cd441e2d061b8233e9b58","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/subtitle.pug","hash":"8044b9c18b34b019ffe26b7383e7e80356b5e4b5","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/widget/card_ad.pug","hash":"60dc48a7b5d89c2a49123c3fc5893ab9c57dd225","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/widget/card_announcement.pug","hash":"ae392459ad401a083ca51ee0b27526b3c1e1faed","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/widget/card_archives.pug","hash":"86897010fe71503e239887fd8f6a4f5851737be9","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/widget/card_bottom_self.pug","hash":"13dc8ce922e2e2332fe6ad5856ebb5dbf9ea4444","modified":1691120115284},{"_id":"themes/butterfly/layout/includes/widget/card_author.pug","hash":"03c6afabbf1ac729c7fb21c7ec06da0190b0fdc7","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/widget/card_newest_comment.pug","hash":"7834bf7c711e739fd33cfcd0b53d151013b3d449","modified":1691120115284},{"_id":"themes/butterfly/layout/includes/widget/card_categories.pug","hash":"d1a416d0a8a7916d0b1a41d73adc66f8c811e493","modified":1691120115284},{"_id":"themes/butterfly/layout/includes/widget/card_post_toc.pug","hash":"3057a2f6f051355e35d3b205121af8735100eacf","modified":1691120115284},{"_id":"themes/butterfly/layout/includes/widget/card_tags.pug","hash":"eceb4420a64c720f0d2741e89d6229bbb3d87353","modified":1691120115284},{"_id":"themes/butterfly/layout/includes/widget/card_recent_post.pug","hash":"e5aac7b28ed4123d75797263c64e74ac547945bc","modified":1691120115284},{"_id":"themes/butterfly/layout/includes/widget/card_top_self.pug","hash":"ae67c6d4130a6c075058a9c1faea1648bcc6f83e","modified":1691120115284},{"_id":"themes/butterfly/layout/includes/widget/card_webinfo.pug","hash":"35ce167c5a275211bfc1fa3d49adfde5b404d98f","modified":1691120115284},{"_id":"themes/butterfly/layout/includes/widget/index.pug","hash":"010e3d548ababca2280c4fc4168d9a4a1ee4f536","modified":1691120115284},{"_id":"themes/butterfly/source/css/_global/function.styl","hash":"e0de61a059b5e6c7b8ebc7149b4650bdcd69af5e","modified":1691120115284},{"_id":"themes/butterfly/source/css/_global/index.styl","hash":"51868d861c94a9f1ad7c0dbd66d2f475c5d4ea62","modified":1691120115284},{"_id":"themes/butterfly/source/css/_highlight/highlight.styl","hash":"57a19eb0c418d92a88b143f56ccb8cd60e6d7ad0","modified":1691120115284},{"_id":"themes/butterfly/source/css/_highlight/theme.styl","hash":"bcd384c8b2aa0390c9eb69ac1abbfd1240ce1da4","modified":1691120115288},{"_id":"themes/butterfly/source/css/_layout/aside.styl","hash":"57adf29a3e36e4ea84384e36c034eb294dffb208","modified":1691120115288},{"_id":"themes/butterfly/source/css/_layout/chat.styl","hash":"f9a5d3f1fc5ed0ed2ee4c1eaa58ed650d11ddebd","modified":1691120115288},{"_id":"themes/butterfly/source/css/_layout/comments.styl","hash":"c61dccca690d486c3d9c29cf028d87b777385141","modified":1691120115288},{"_id":"themes/butterfly/source/css/_layout/footer.styl","hash":"83a7a70eb0532ea9c4267939fe484af915fca01e","modified":1691120115288},{"_id":"themes/butterfly/source/css/_layout/head.styl","hash":"8cd2aaa32cd68cd1908c9001444a811c3d0f9267","modified":1691120115288},{"_id":"themes/butterfly/source/css/_layout/loading.styl","hash":"ac2aeee9926f75b2a0098efe1c114126987430f2","modified":1691120115288},{"_id":"themes/butterfly/source/css/_layout/pagination.styl","hash":"fb9f78bfbb79579f1d752cb73fb6d25c8418e0fd","modified":1691120115288},{"_id":"themes/butterfly/source/css/_layout/post.styl","hash":"fc9424d9c5def2201ec1d04dc79d0beedc1d2175","modified":1691120115288},{"_id":"themes/butterfly/source/css/_layout/relatedposts.styl","hash":"d53de408cb27a2e704aba7f7402b7caebe0410d8","modified":1691120115288},{"_id":"themes/butterfly/source/css/_layout/reward.styl","hash":"c5cfed620708807a48076b5ee59b0ba84e29aa80","modified":1691120115288},{"_id":"themes/butterfly/source/css/_layout/rightside.styl","hash":"bbc884d6b2158a833b77a1bbc07248e17874b22e","modified":1691120115288},{"_id":"themes/butterfly/source/css/_layout/sidebar.styl","hash":"631ca35a38bc4ac052e9caf47508ff1f99842fc7","modified":1691120115288},{"_id":"themes/butterfly/source/css/_layout/third-party.styl","hash":"5556c9bf4f53a90cb9b4945cd76a8849bd67f3f3","modified":1691120115288},{"_id":"themes/butterfly/source/css/_mode/darkmode.styl","hash":"e4f948b0d4eb5483b2b360e56cbfe3359751b438","modified":1691120115288},{"_id":"themes/butterfly/source/css/_mode/readmode.styl","hash":"c481d1f689a4e6d7ee492a03751bda47a30225ce","modified":1691120115288},{"_id":"themes/butterfly/source/css/_page/404.styl","hash":"50dbb9e6d98c71ffe16741b8c1b0c1b9771efd2b","modified":1691120115288},{"_id":"themes/butterfly/source/css/_page/categories.styl","hash":"f01ee74948cedb44e53cd3bb1ef36b7d2778ede7","modified":1691120115288},{"_id":"themes/butterfly/source/css/_page/common.styl","hash":"4e320e16d49bc18085045937681f7331a1e243ca","modified":1691120115288},{"_id":"themes/butterfly/source/css/_page/flink.styl","hash":"98d755b686ee833e9da10afaa40c4ec2bd66c19a","modified":1691120115288},{"_id":"themes/butterfly/source/css/_page/homepage.styl","hash":"b3ea08d9460122751144a3ca835e009a460d6ad3","modified":1691120115288},{"_id":"themes/butterfly/source/css/_page/tags.styl","hash":"580feb7e8b0822a1be48ac380f8c5c53b1523321","modified":1691120115288},{"_id":"themes/butterfly/source/css/_page/archives.styl","hash":"c9e98027f2dd730ce389c2047f62ebb748955fcf","modified":1691120115288},{"_id":"themes/butterfly/source/css/_search/algolia.styl","hash":"649a054e73278b6724bd4dd9b94724791ec5c928","modified":1691120115288},{"_id":"themes/butterfly/source/css/_search/index.styl","hash":"20a3134e1302b62bfc881f4ec43f398267111f22","modified":1691120115288},{"_id":"themes/butterfly/source/css/_search/local-search.styl","hash":"a86e4e9198b225b4b73a7a45f04b86cbbed0d231","modified":1691120115288},{"_id":"themes/butterfly/source/css/_tags/button.styl","hash":"45f0c32bdea117540f6b14ebac6450d7142bd710","modified":1691120115292},{"_id":"themes/butterfly/source/css/_tags/gallery.styl","hash":"81ad85acf0e0fe7f9ee23c16a700e7154574d5dd","modified":1691120115292},{"_id":"themes/butterfly/source/css/_tags/hexo.styl","hash":"d76c38adf1d9c1279ef4241835667789f5b736e0","modified":1691120115292},{"_id":"themes/butterfly/source/css/_tags/hide.styl","hash":"ce489ca2e249e2a3cf71584e20d84bdb022e3475","modified":1691120115292},{"_id":"themes/butterfly/source/css/_tags/inlineImg.styl","hash":"df9d405c33a9a68946b530410f64096bcb72560c","modified":1691120115292},{"_id":"themes/butterfly/source/css/_tags/label.styl","hash":"66c59e193d794cdb02cca7bd1dc4aea5a19d7e84","modified":1691120115292},{"_id":"themes/butterfly/source/css/_tags/note.styl","hash":"85ae91c83691ea4511f4277da1194a185251cc78","modified":1691120115292},{"_id":"themes/butterfly/source/css/_tags/tabs.styl","hash":"bf9568444dd54e39dc59b461323dcd38942f27d9","modified":1691120115292},{"_id":"themes/butterfly/source/css/_tags/timeline.styl","hash":"f071156d439556e7463ed4bc61ceee87170d5d08","modified":1691120115292},{"_id":"themes/butterfly/source/css/_third-party/normalize.min.css","hash":"2c18a1c9604af475b4749def8f1959df88d8b276","modified":1691120115292},{"_id":"themes/butterfly/source/js/search/algolia.js","hash":"fd86281d4f0f99ce173e49c1a0df3507fe268d37","modified":1691120115292},{"_id":"themes/butterfly/source/js/search/local-search.js","hash":"8509cbd954ee9e099dcfbbfdafba70893a56e9ae","modified":1691120115292},{"_id":"themes/butterfly/layout/includes/third-party/abcjs/abcjs.pug","hash":"ed6906b7c6aa7046bbad95dfdda9211997be7099","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/third-party/abcjs/index.pug","hash":"f58f1648d2d71311bafca4833f20b605bb5f18c8","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/artalk.pug","hash":"5f86add36eeffbed61d11f08972a13697b4d9437","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/disqus.pug","hash":"d85c3737b5c9548553a78b757a7698df126a52cf","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/fb.pug","hash":"0344477a2cf38698318ead2681c63ac12f01586e","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/index.pug","hash":"b2d274db84ef22fbd6d5ea8f4404821898934209","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/remark42.pug","hash":"001e8be47854b891efe04013c240c38fed4185eb","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/twikoo.pug","hash":"56c028ba0ea8fac19f0125114d765dfc56ce2b48","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/valine.pug","hash":"39427e107230a10790972349c9dd4c4f31d55eb7","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/waline.pug","hash":"d02f3cc9e6183e7d05c7e90e9ae1dee5ce21f297","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/third-party/chat/chatra.pug","hash":"ddce8352b371a1fb426bdb6c33f587eb37a69647","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/third-party/chat/crisp.pug","hash":"2fb098a7aa45010a8cd212dc0bd5308c6e7c63e3","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/third-party/chat/daovoice.pug","hash":"9b57a8e13de8fc51a5f550854e47164fd8ac1be8","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/third-party/chat/index.pug","hash":"618e1b7f9204049b07beb9e1363c844a78a9ace3","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/third-party/chat/messenger.pug","hash":"e39a9c37adf4cb15a2ba3b2cc65542ffea88650d","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/third-party/chat/tidio.pug","hash":"dd61eca6e9a45f63e09bdefba89fe285a81ba096","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/third-party/comments/artalk.pug","hash":"5d5d8a0a3a7690d6d01e3feb91c2a36a5cd651b1","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/third-party/comments/disqus.pug","hash":"9ef303da16d180619da18b146ddb9bc35f66bdbf","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/third-party/comments/disqusjs.pug","hash":"6e17b2cea503eabeb328835038812cfa95f15871","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/third-party/comments/giscus.pug","hash":"5127bc550a2edb1ab9f45416e1964c76e8201544","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/third-party/comments/facebook_comments.pug","hash":"0704efed9079c867ab5f7bee7381a6c869154c73","modified":1691120115276},{"_id":"themes/butterfly/layout/includes/third-party/comments/gitalk.pug","hash":"2fc5627eb63118c83df9422b47c801822e28df98","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/comments/index.pug","hash":"35ae7980f658a349c5956c5699efd435b604b836","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/comments/js.pug","hash":"00ed91c52939b9675b316137f854d13684c895a6","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/comments/livere.pug","hash":"52ea8aa26b84d3ad38ae28cdf0f163e9ca8dced7","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/comments/remark42.pug","hash":"598790433e3c9be28b0063bff08d257acd0abf75","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/comments/twikoo.pug","hash":"4d78f6266d0870c06c10eaf47c951bd4d9a7732e","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/comments/utterances.pug","hash":"2a8d02ed9303092e8816f6489a443e7388102470","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/comments/valine.pug","hash":"e55b9c0f8ced231f47eb88bd7f4ec99f29c5c29d","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/comments/waline.pug","hash":"0a1b8fe95623b095eb7ede3f30ca327684d1e613","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/math/index.pug","hash":"b8ae5fd7d74e1edcef21f5004fc96147e064d219","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/math/katex.pug","hash":"dfcbd9881be569ea420eff1a6b00e4f4dbe2138e","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/math/mathjax.pug","hash":"fc072ac839401174b5d3cf9acd3b694246c23a55","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/math/mermaid.pug","hash":"d0ce1891b042dcc2c93cacc866e38721b94aa4c4","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/artalk.pug","hash":"8c0d9a45bd2d83cc6d0e7bbfe172a09ff33c0178","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/disqus-comment.pug","hash":"4fe8faf77b8420fc031ae1b54f78b2ece9fcc07e","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/github-issues.pug","hash":"0330e3063ccf0ce40e4828b8d4fbef62362e8195","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/index.pug","hash":"4ec0642f2d5444acfab570a6f8c7868e7ff43fde","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/remark42.pug","hash":"aa6061183a32472cd1882fce445a5049108a984b","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/twikoo-comment.pug","hash":"44991d67abb81784c5cdb4337b2b9798fc4361e1","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/valine.pug","hash":"b7b2aa5be4112065d5066c0f066f5f58721153bf","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/waline.pug","hash":"ae1ccd78926cc19399d396b237d5161d7cde44a8","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/search/algolia.pug","hash":"9c3c109a12d2b6916e8b4965cca12f521510ead9","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/search/index.pug","hash":"a99a41334387ee9a46c6f8e8212331a29a10d159","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/search/local-search.pug","hash":"5ebd5e8d39c9f77f5b2d983f6cd6802ccaf98746","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/search/docsearch.pug","hash":"1c3e101445c5571ba998ce293d3984319df1b3b0","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/share/add-this.pug","hash":"2980f1889226ca981aa23b8eb1853fde26dcf89a","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/share/addtoany.pug","hash":"85c92f8a7e44d7cd1c86f089a05be438535e5362","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/share/index.pug","hash":"4c4a9c15215ae8ac5eadb0e086b278f76db9ee92","modified":1691120115280},{"_id":"themes/butterfly/layout/includes/third-party/share/share-js.pug","hash":"c7dd2b2ae9b23aa0a60fffd7df9e9f76ef52033e","modified":1691120115280},{"_id":"themes/butterfly/source/css/_highlight/highlight/diff.styl","hash":"cf1fae641c927621a4df1be5ca4a853b9b526e23","modified":1691120115284},{"_id":"themes/butterfly/source/css/_highlight/highlight/index.styl","hash":"18804c58239d95798fa86d0597f32d7f7dd30051","modified":1691120115284},{"_id":"themes/butterfly/source/css/_highlight/prismjs/diff.styl","hash":"5972c61f5125068cbe0af279a0c93a54847fdc3b","modified":1691120115288},{"_id":"themes/butterfly/source/css/_highlight/prismjs/index.styl","hash":"5dc2e0bcae9a54bfb9bdcc82d02ae5a3cf1ca97d","modified":1691120115288},{"_id":"themes/butterfly/source/css/_highlight/prismjs/line-number.styl","hash":"8970cc1916c982b64a1478792b2822d1d31e276d","modified":1691120115288},{"_id":"source/_posts/kubernetes/image-4.png","hash":"959af5ef59ac3a24e595faf6230f58bf0b33243e","modified":1697619515457},{"_id":"source/_posts/kubernetes/image-3.png","hash":"a81a8f9bab8435537e5cd0fb019c67e7d6da17ea","modified":1697619509317},{"_id":"source/_posts/kubernetes/image-6.png","hash":"d872952ad5d1a85c93386637ccee9c518f4789ee","modified":1697619535316},{"_id":"source/_posts/kubernetes/image-7.png","hash":"425ad21cb2c5486d5c20685dfc36c556f34e715a","modified":1697619540588},{"_id":"source/_posts/kubernetes/image-15.png","hash":"d32f59117d4817866be14e904b370cd265b0f784","modified":1697619614575},{"_id":"themes/butterfly/source/img/20230818103122.jpg","hash":"690b5dbaea6aff4c293708ec80de2ac601b3495c","modified":1692325954425},{"_id":"source/_posts/kubernetes/image-8.png","hash":"c19eff01c86dff878643104cabd691ad2d6eb2f3","modified":1697619548336},{"_id":"source/_posts/kubernetes/image-9.png","hash":"c19eff01c86dff878643104cabd691ad2d6eb2f3","modified":1697619554620},{"_id":"source/_posts/kubernetes/image-19.png","hash":"f9c0e4887ce3bcd96ea8a8396d49042bcbee3063","modified":1697619657446},{"_id":"source/_posts/kubernetes/image-24.png","hash":"b6c6757c1d0be6252a3b60d3b96e520f84ff599c","modified":1697619855624},{"_id":"source/_posts/kubernetes/image-13.png","hash":"f49833ea73f79f8dd1e0b510641d94c7bc79b14c","modified":1697619586691},{"_id":"source/_posts/kubernetes/image-14.png","hash":"f49833ea73f79f8dd1e0b510641d94c7bc79b14c","modified":1697619599783},{"_id":"source/_posts/kubernetes/image-5.png","hash":"c7c05824a660325f6b8ae10ed634158af50a3941","modified":1697619526600},{"_id":"source/_posts/kubernetes/image-18.png","hash":"7f214ee3a7bdfb4a347f5e9d5fb3ac1ea0d448ce","modified":1697619639199},{"_id":"themes/butterfly/source/img/20230823160932.png","hash":"9864346b852cb55c5fb3fdd45b80265e0f64bf20","modified":1692778176057},{"_id":"public/search.xml","hash":"2f09a20a2e7eebc8b08c3e60db236c6ce65aa6d8","modified":1698390519625},{"_id":"public/about/index.html","hash":"4117c8614d713829a1b1f5cc6c896a25d8e84ad5","modified":1698390519625},{"_id":"public/link/index.html","hash":"0e531fee46bb761595b0973fe5a39be5dac45194","modified":1698390519625},{"_id":"public/categories/index.html","hash":"e7eb945d5b58f3a9f23c1f2536c4cdc20d2f919a","modified":1698390519625},{"_id":"public/tags/index.html","hash":"17974a4630f218729ff27111b85555b60694e111","modified":1698390519625},{"_id":"public/2023/10/27/linux/chrony/index.html","hash":"6a9740957c488a29f9e5c2ab207359709ada46d8","modified":1698390519625},{"_id":"public/2023/10/18/kubernetes/deepflow-dashboard/index.html","hash":"837f1828c7f47b7798ad2a1fa64db0bd963a334a","modified":1698390519625},{"_id":"public/2023/09/05/kubernetes/kibana-ilm/index.html","hash":"9e32ca340f060791c304a95c64ac25d0990b0a62","modified":1698390519625},{"_id":"public/2023/09/01/kubernetes/kubevirt-vm-expose/index.html","hash":"e0662f9d2d098cde326e4a115d4aff50c11744f2","modified":1698390519625},{"_id":"public/2023/08/31/kubernetes/grafana-create-alert-rule/index.html","hash":"476c5d891bdcf83bc81ac1076e7212ddf8f2c352","modified":1698390519625},{"_id":"public/2023/08/25/kubernetes/metrics-server/index.html","hash":"8c7600b4ffd452481264963f1eaefe30bb59d518","modified":1698390519625},{"_id":"public/2023/08/24/kubernetes/efk/index.html","hash":"8379a765011d6281ce309f6c7b4b6a099d9805f0","modified":1698390519625},{"_id":"public/2023/08/24/kubernetes/fluent_Bit_Fluentd/index.html","hash":"4cc2caf5c2790cda23e35d8726495a2fe4dd0b4d","modified":1698390519625},{"_id":"public/2023/08/23/golang/go_template/index.html","hash":"ff1d1c323ea1579e7ef945d2596e420fecc071ff","modified":1698390519625},{"_id":"public/2023/08/23/docker/uninstall_docker/index.html","hash":"2bf33ec938e4f521279c09f2d31194bc6892721f","modified":1698390519625},{"_id":"public/2023/08/22/nodejs/install_nodejs/index.html","hash":"e0e59ea7950029fa3b74272967403909eef12220","modified":1698390519625},{"_id":"public/2023/08/22/kubernetes/uninstall_cintainerd/index.html","hash":"7dea85a6788763f35b1c77b6bd5954f4dc3bb889","modified":1698390519625},{"_id":"public/2023/08/18/golang/last_version_mod/index.html","hash":"950fd451d553547dfe7e3e1d0f4adb467ca2138f","modified":1698390519625},{"_id":"public/2023/08/18/kubernetes/monitor/index.html","hash":"15780de665ac06169282b3af2a4b728bec03ea9a","modified":1698390519625},{"_id":"public/2023/08/04/hello-world/index.html","hash":"7d35f6b0ba22fb8d1bd4a7f7f1919590a8919d4a","modified":1698390519625},{"_id":"public/archives/index.html","hash":"a70132082bdfd9db70fdd327468ba75e97b45b55","modified":1698390519625},{"_id":"public/archives/2023/index.html","hash":"db4134aeae3f23a7e91d1b65f288e7018c2396c4","modified":1698390519625},{"_id":"public/archives/page/2/index.html","hash":"55cd1628ddf1a062ef994ee9513d1e42813ba242","modified":1698390519625},{"_id":"public/archives/2023/page/2/index.html","hash":"78a31ca291b7eb6118a9dc4024d0d804b5f82070","modified":1698390519625},{"_id":"public/archives/2023/08/index.html","hash":"ce46ceee44011cbac75dd03f69e140480b2b3d69","modified":1698390519625},{"_id":"public/archives/2023/08/page/2/index.html","hash":"2a7bd73b9f4bab07ad2352b5d571b54e0912a146","modified":1698390519625},{"_id":"public/archives/2023/09/index.html","hash":"d8137befc806b62bf162502e74f8944b62935c1d","modified":1698390519625},{"_id":"public/archives/2023/10/index.html","hash":"89ce49663dd9c1399964d76f2acbb10199247f5c","modified":1698390519625},{"_id":"public/categories/docker/index.html","hash":"61b95540a7c9c2f530fe8f8a4b9e1841a0aff12e","modified":1698390519625},{"_id":"public/categories/golang/index.html","hash":"756fb2e6e01d81a79988dc150018490eeb311765","modified":1698390519625},{"_id":"public/categories/linux/index.html","hash":"281a93e15e4d2698b4b6d6fcb763249fa83484b7","modified":1698390519625},{"_id":"public/categories/kubernetes/index.html","hash":"c6357ff57f56b06d28214f4e2b51297ff8d02dd4","modified":1698390519625},{"_id":"public/index.html","hash":"b0024715c11bc761bef44ea6319c52367cef448d","modified":1698390519625},{"_id":"public/page/2/index.html","hash":"f0d2b0c5adceea5e0b2cc394140b1e7c1eba069f","modified":1698390519625},{"_id":"public/tags/docker/index.html","hash":"280e1404fe343a679b6aced7703a10db6e1f560e","modified":1698390519625},{"_id":"public/tags/golang/index.html","hash":"8e424a06575b598ddc85f7c4e73d5677082ba3ac","modified":1698390519625},{"_id":"public/tags/nodejs/index.html","hash":"2b9285433f113a2921ec05ff65357da5c7a9c7c5","modified":1698390519625},{"_id":"public/tags/chrony/index.html","hash":"4873a7b4925092b25526c7ec6990b707d34e10c2","modified":1698390519625},{"_id":"public/tags/deepflow/index.html","hash":"edd9241ccc777740bb073e50b1bff06a1694a5cd","modified":1698390519625},{"_id":"public/tags/logging/index.html","hash":"8554a82eb5d55c031eca694a412aa9e391386af5","modified":1698390519625},{"_id":"public/tags/grafana/index.html","hash":"ab3f3ea050df27aca8d33b4eab8922fa35427153","modified":1698390519625},{"_id":"public/tags/kibana/index.html","hash":"df4c59b0a81a3e15e87229849c30d02d09f73f0a","modified":1698390519625},{"_id":"public/tags/kubevirt/index.html","hash":"ddffd61c3d5d4aca091be4b50f29913efcc826f4","modified":1698390519625},{"_id":"public/tags/kubernetes/index.html","hash":"90515396ddbc5552c8ac16de3929f0087f56c11b","modified":1698390519625},{"_id":"public/tags/containerd/index.html","hash":"a41d2c89f439dc5b2e12ee16320b9d51fdf3e6af","modified":1698390519625},{"_id":"public/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":1698390519625},{"_id":"public/img/favicon.png","hash":"3cf89864b4f6c9b532522a4d260a2e887971c92d","modified":1698390519625},{"_id":"public/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1698390519625},{"_id":"public/img/thumbbig-1221433.jpg","hash":"8c32ca61f09cf449dee0024a21972a3ad9c26eff","modified":1698390519625},{"_id":"public/img/20230818103122.jpg","hash":"690b5dbaea6aff4c293708ec80de2ac601b3495c","modified":1698390519625},{"_id":"public/css/var.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1698390519625},{"_id":"public/js/utils.js","hash":"aaaedc207440095da1ffabcad870fc2641befb0e","modified":1698390519625},{"_id":"public/js/search/algolia.js","hash":"fd86281d4f0f99ce173e49c1a0df3507fe268d37","modified":1698390519625},{"_id":"public/js/search/local-search.js","hash":"8509cbd954ee9e099dcfbbfdafba70893a56e9ae","modified":1698390519625},{"_id":"public/css/index.css","hash":"d2ac9ea2eda7e3436cf544deaafd55ae1e3a81e3","modified":1698390519625},{"_id":"public/js/tw_cn.js","hash":"42b106354d72a0ea1fe62587b313a5b7de3cc393","modified":1698390519625},{"_id":"public/js/main.js","hash":"0227b5bd233a3c66582e0ee820cdb353ce52ece1","modified":1698390519625},{"_id":"public/img/20230822143445.jpg","hash":"3a109901811ca6833fb3223189064fa867653bbf","modified":1698390519625},{"_id":"public/img/20230823160932.png","hash":"9864346b852cb55c5fb3fdd45b80265e0f64bf20","modified":1698390519625}],"Category":[{"name":"docker","_id":"clo89v5e3000ab7jx4evb1cpi"},{"name":"golang","_id":"clo89v5ec000eb7jxcn5q2p89"},{"name":"linux","_id":"clo89v5en000pb7jx3zf9029q"},{"name":"kubernetes","_id":"clo89v5es000vb7jx9ky06m6t"}],"Data":[{"_id":"link","data":[{"class_name":"友情鏈接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、簡單且強大的網誌框架"}]},{"class_name":"網站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}],"Page":[{"title":"about","date":"2023-08-04T03:17:19.000Z","_content":"","source":"about/index.md","raw":"---\ntitle: about\ndate: 2023-08-04 11:17:19\n---\n","updated":"2023-08-04T03:17:19.026Z","path":"about/index.html","comments":1,"layout":"page","_id":"clo89v5cw0000b7jx6abb2wb0","content":"","site":{"data":{"link":[{"class_name":"友情鏈接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、簡單且強大的網誌框架"}]},{"class_name":"網站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":false,"excerpt":"","more":""},{"title":"link","date":"2023-08-18T02:10:46.000Z","type":"link","_content":"","source":"link/index.md","raw":"---\ntitle: link\ndate: 2023-08-18 10:10:46\ntype: \"link\"\n---\n","updated":"2023-08-18T02:11:20.798Z","path":"link/index.html","comments":1,"layout":"page","_id":"clo89v5dg0002b7jxa67ddie4","content":"","site":{"data":{"link":[{"class_name":"友情鏈接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、簡單且強大的網誌框架"}]},{"class_name":"網站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":false,"excerpt":"","more":""},{"title":"categories","date":"2023-08-18T02:10:06.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2023-08-18 10:10:06\ntype: \"categories\"\n---\n","updated":"2023-08-18T02:10:31.370Z","path":"categories/index.html","comments":1,"layout":"page","_id":"clo89v5dq0004b7jx40eg2vax","content":"","site":{"data":{"link":[{"class_name":"友情鏈接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、簡單且強大的網誌框架"}]},{"class_name":"網站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":false,"excerpt":"","more":""},{"title":"tags","date":"2023-08-18T02:08:43.000Z","type":"tags","orderby":"name","order":1,"_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2023-08-18 10:08:43\ntype: \"tags\"\norderby: name\norder: 1\n---\n","updated":"2023-08-18T02:10:02.674Z","path":"tags/index.html","comments":1,"layout":"page","_id":"clo89v5dv0006b7jx3uqoc7c6","content":"","site":{"data":{"link":[{"class_name":"友情鏈接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、簡單且強大的網誌框架"}]},{"class_name":"網站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":false,"excerpt":"","more":""}],"Post":[{"title":"draft","_content":"","source":"_drafts/draft.md","raw":"---\ntitle: draft\ntags:\n---\n","slug":"draft","published":0,"date":"2023-08-18T02:53:22.494Z","updated":"2023-08-18T02:53:22.494Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clo89v5d60001b7jxbk6o7eig","content":"","site":{"data":{"link":[{"class_name":"友情鏈接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、簡單且強大的網誌框架"}]},{"class_name":"網站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":false,"excerpt":"","more":""},{"title":"Hello World","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\ndependencies:\n* node, npm\n* sudo npm install -g hexo-cli\n* sudo npm install hexo\n* npm install hexo-deployer-git --save\n* npm install hexo-generator-search --save\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","source":"_posts/hello-world.md","raw":"---\ntitle: Hello World\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\ndependencies:\n* node, npm\n* sudo npm install -g hexo-cli\n* sudo npm install hexo\n* npm install hexo-deployer-git --save\n* npm install hexo-generator-search --save\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","slug":"hello-world","published":1,"date":"2023-08-04T02:11:25.933Z","updated":"2023-08-23T07:14:10.502Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clo89v5dk0003b7jx03w51xmu","content":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><p>dependencies:</p>\n<ul>\n<li>node, npm</li>\n<li>sudo npm install -g hexo-cli</li>\n<li>sudo npm install hexo</li>\n<li>npm install hexo-deployer-git –save</li>\n<li>npm install hexo-generator-search –save</li>\n</ul>\n<h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n","site":{"data":{"link":[{"class_name":"友情鏈接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、簡單且強大的網誌框架"}]},{"class_name":"網站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":false,"excerpt":"","more":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><p>dependencies:</p>\n<ul>\n<li>node, npm</li>\n<li>sudo npm install -g hexo-cli</li>\n<li>sudo npm install hexo</li>\n<li>npm install hexo-deployer-git –save</li>\n<li>npm install hexo-generator-search –save</li>\n</ul>\n<h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n"},{"title":"uninstall docker","date":"2023-08-23T05:53:22.000Z","comments":1,"_content":"要在CentOS 7上干净地卸载Docker，可以执行以下步骤：\n\n1. 停止Docker服务：\n\n```\nsudo systemctl stop docker\n```\n\n2. 移除所有Docker容器和镜像。这将删除所有相关数据，包括容器、镜像以及存储卷等。请注意，这将不可逆转地删除数据。\n\n```\nsudo rm -rf /var/lib/docker\n```\n\n3. 卸载Docker软件包。可以使用以下命令之一，根据Docker的安装方式选择相应的命令：\n\n- 如果Docker是通过`yum`进行安装的：\n\n```\nsudo yum remove docker-ce docker-ce-cli containerd.io\n```\n\n- 如果Docker是通过`dnf`进行安装的：\n\n```\nsudo dnf remove docker-ce docker-ce-cli containerd.io\n```\n\n- 如果Docker是通过RPM包进行手动安装的，可以使用以下命令之一：\n\n```\nsudo rpm -e docker-ce docker-ce-cli containerd.io\n```\n\n4. 删除相关配置文件：\n\n```\nsudo rm -rf /etc/docker\nsudo rm -rf /etc/systemd/system/docker.service.d\n```\n\n5. 删除用户组和用户（可选）：\n\n```\nsudo groupdel docker\nsudo userdel docker\n```\n\n完成以上步骤后，Docker将被完全卸载。","source":"_posts/docker/uninstall_docker.md","raw":"---\ntitle: uninstall docker\ndate: 2023-08-23 13:53:22\ncategories:\n  - [docker]\ntags: docker\ncomments: true\n---\n要在CentOS 7上干净地卸载Docker，可以执行以下步骤：\n\n1. 停止Docker服务：\n\n```\nsudo systemctl stop docker\n```\n\n2. 移除所有Docker容器和镜像。这将删除所有相关数据，包括容器、镜像以及存储卷等。请注意，这将不可逆转地删除数据。\n\n```\nsudo rm -rf /var/lib/docker\n```\n\n3. 卸载Docker软件包。可以使用以下命令之一，根据Docker的安装方式选择相应的命令：\n\n- 如果Docker是通过`yum`进行安装的：\n\n```\nsudo yum remove docker-ce docker-ce-cli containerd.io\n```\n\n- 如果Docker是通过`dnf`进行安装的：\n\n```\nsudo dnf remove docker-ce docker-ce-cli containerd.io\n```\n\n- 如果Docker是通过RPM包进行手动安装的，可以使用以下命令之一：\n\n```\nsudo rpm -e docker-ce docker-ce-cli containerd.io\n```\n\n4. 删除相关配置文件：\n\n```\nsudo rm -rf /etc/docker\nsudo rm -rf /etc/systemd/system/docker.service.d\n```\n\n5. 删除用户组和用户（可选）：\n\n```\nsudo groupdel docker\nsudo userdel docker\n```\n\n完成以上步骤后，Docker将被完全卸载。","slug":"docker/uninstall_docker","published":1,"updated":"2023-08-24T05:52:19.606Z","layout":"post","photos":[],"link":"","_id":"clo89v5dt0005b7jx62lhbcu4","content":"<p>要在CentOS 7上干净地卸载Docker，可以执行以下步骤：</p>\n<ol>\n<li>停止Docker服务：</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl stop docker</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>移除所有Docker容器和镜像。这将删除所有相关数据，包括容器、镜像以及存储卷等。请注意，这将不可逆转地删除数据。</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo rm -rf /var/lib/docker</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>卸载Docker软件包。可以使用以下命令之一，根据Docker的安装方式选择相应的命令：</li>\n</ol>\n<ul>\n<li>如果Docker是通过<code>yum</code>进行安装的：</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum remove docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>如果Docker是通过<code>dnf</code>进行安装的：</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo dnf remove docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>如果Docker是通过RPM包进行手动安装的，可以使用以下命令之一：</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo rpm -e docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>删除相关配置文件：</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo rm -rf /etc/docker</span><br><span class=\"line\">sudo rm -rf /etc/systemd/system/docker.service.d</span><br></pre></td></tr></table></figure>\n\n<ol start=\"5\">\n<li>删除用户组和用户（可选）：</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo groupdel docker</span><br><span class=\"line\">sudo userdel docker</span><br></pre></td></tr></table></figure>\n\n<p>完成以上步骤后，Docker将被完全卸载。</p>\n","site":{"data":{"link":[{"class_name":"友情鏈接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、簡單且強大的網誌框架"}]},{"class_name":"網站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":false,"excerpt":"","more":"<p>要在CentOS 7上干净地卸载Docker，可以执行以下步骤：</p>\n<ol>\n<li>停止Docker服务：</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl stop docker</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>移除所有Docker容器和镜像。这将删除所有相关数据，包括容器、镜像以及存储卷等。请注意，这将不可逆转地删除数据。</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo rm -rf /var/lib/docker</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>卸载Docker软件包。可以使用以下命令之一，根据Docker的安装方式选择相应的命令：</li>\n</ol>\n<ul>\n<li>如果Docker是通过<code>yum</code>进行安装的：</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum remove docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>如果Docker是通过<code>dnf</code>进行安装的：</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo dnf remove docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>如果Docker是通过RPM包进行手动安装的，可以使用以下命令之一：</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo rpm -e docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>删除相关配置文件：</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo rm -rf /etc/docker</span><br><span class=\"line\">sudo rm -rf /etc/systemd/system/docker.service.d</span><br></pre></td></tr></table></figure>\n\n<ol start=\"5\">\n<li>删除用户组和用户（可选）：</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo groupdel docker</span><br><span class=\"line\">sudo userdel docker</span><br></pre></td></tr></table></figure>\n\n<p>完成以上步骤后，Docker将被完全卸载。</p>\n"},{"title":"golang模板语法及预定义函数","date":"2023-08-23T06:52:39.000Z","_content":"在Go语言中，使用模板可以通过`text/template`或者`html/template`包来实现。这两个包的主要区别是，`html/template`包会自动对输出进行转义，以防止跨站点脚本攻击。\n\n下面是`text/template`和`html/template`包中常用的模板语法和示例：\n\n1. 注释：\n\n   可以使用`{{/* 注释内容 */}}`语法添加注释。注释可以在模板执行时忽略。\n\n   示例：\n   ```\n   {{/* This is a comment */}}\n   ```\n\n2. 输出变量值：\n\n   使用`{{.}}`语法输出当前的上下文变量值。\n\n   示例：\n   ```\n   {{.}}  // 输出当前上下文的变量值\n   ```\n\n3. 条件语句：\n\n   使用`{{if .Condition}} ... {{else}} ... {{end}}`语法进行条件判断。\n\n   示例：\n   ```\n   {{if .Condition}}\n       True Block\n   {{else}}\n       False Block\n   {{end}}\n   ```\n\n4. 循环语句：\n\n   使用`{{range .Slice}} ... {{end}}`语法进行循环迭代。\n\n   示例：\n   ```\n   {{range .Slice}}\n       {{.}}  // .表示当前迭代的元素\n   {{end}}\n   ```\n\n5. 定义和使用变量：\n\n   使用`{{with .Variable}} ... {{end}}`语法定义和使用临时变量。\n\n   示例：\n   ```\n   {{with .Variable}}\n       {{.}}  // 使用临时变量\n   {{end}}\n   ```\n\n6. 函数调用：\n\n   使用`{{函数名 参数1 参数2 ...}}`语法调用内置或自定义函数。\n\n   示例：\n   ```\n   {{len .String}}  // 调用len函数返回字符串的长度\n   ```\n\n7. 嵌套模板：\n\n   使用`{{template \"模板名称\" .数据}}`语法在模板中嵌套另一个模板。\n\n   示例：\n   ```\n   {{template \"header\" .PageTitle}}  // 嵌套名为\"header\"的模板，并传入.PageTitle参数\n   ```\n\n这些是常用的模板语法和示例，通过这些语法可以实现动态生成文本或者HTML代码的功能。具体使用方法可以参考Go语言文档中的模板包说明：https://golang.org/pkg/html/template/\n\n在Go语言的模板中，可以通过在模板中调用预定义的全局函数来进行一些常用的操作。Go语言的模板引擎提供了一些内置函数，这些函数可以在模板中直接使用，而不需要额外的导入。\n\n以下是一些常用的预定义全局函数：\n\n1. `and`：接受任意数量的布尔值作为参数，并返回它们的与运算结果。\n示例：\n```\n{{and true true}}  // true\n{{and true false}} // false\n```\n\n2. `or`：接受任意数量的布尔值作为参数，并返回它们的或运算结果。\n示例：\n```\n{{or true true}}  // true\n{{or true false}} // true\n```\n\n3. `not`：接受布尔值作为参数，并返回它的否定值。\n示例：\n```\n{{not true}}  // false\n{{not false}} // true\n```\n\n4. `eq`：用于比较两个值是否相等。\n示例：\n```\n{{eq 10 10}}   // true\n{{eq \"abc\" \"def\"}} // false\n```\n\n5. `ne`：用于比较两个值是否不相等。\n示例：\n```\n{{ne 10 20}}   // true\n{{ne \"abc\" \"abc\"}} // false\n```\n\n6. `lt`：用于比较两个值是否左边小于右边。\n示例：\n```\n{{lt 10 20}}   // true\n{{lt \"abc\" \"def\"}} // true\n```\n\n7. `le`：用于比较两个值是否左边小于等于右边。\n示例：\n```\n{{le 20 20}}   // true\n{{le \"abc\" \"def\"}} // true\n```\n\n8. `gt`：用于比较两个值是否左边大于右边。\n示例：\n```\n{{gt 20 10}}   // true\n{{gt \"def\" \"abc\"}} // true\n```\n\n9. `ge`：用于比较两个值是否左边大于等于右边。\n示例：\n```\n{{ge 20 20}}   // true\n{{ge \"def\" \"abc\"}} // true\n```\n\n10. `len`：返回一个字符串或数组的长度。\n示例：\n```\n{{len \"hello\"}}  // 5\n{{len .slice}}   // 数组或切片的长度\n```\n\n以上就是一些常用的预定义全局函数的使用方法和示例。使用这些函数可以在模板中进行一些基本的逻辑操作和比较。","source":"_posts/golang/go_template.md","raw":"---\ntitle: golang模板语法及预定义函数\ndate: 2023-08-23 14:52:39\ncategories:\n  - [golang]\ntags: golang\n---\n在Go语言中，使用模板可以通过`text/template`或者`html/template`包来实现。这两个包的主要区别是，`html/template`包会自动对输出进行转义，以防止跨站点脚本攻击。\n\n下面是`text/template`和`html/template`包中常用的模板语法和示例：\n\n1. 注释：\n\n   可以使用`{{/* 注释内容 */}}`语法添加注释。注释可以在模板执行时忽略。\n\n   示例：\n   ```\n   {{/* This is a comment */}}\n   ```\n\n2. 输出变量值：\n\n   使用`{{.}}`语法输出当前的上下文变量值。\n\n   示例：\n   ```\n   {{.}}  // 输出当前上下文的变量值\n   ```\n\n3. 条件语句：\n\n   使用`{{if .Condition}} ... {{else}} ... {{end}}`语法进行条件判断。\n\n   示例：\n   ```\n   {{if .Condition}}\n       True Block\n   {{else}}\n       False Block\n   {{end}}\n   ```\n\n4. 循环语句：\n\n   使用`{{range .Slice}} ... {{end}}`语法进行循环迭代。\n\n   示例：\n   ```\n   {{range .Slice}}\n       {{.}}  // .表示当前迭代的元素\n   {{end}}\n   ```\n\n5. 定义和使用变量：\n\n   使用`{{with .Variable}} ... {{end}}`语法定义和使用临时变量。\n\n   示例：\n   ```\n   {{with .Variable}}\n       {{.}}  // 使用临时变量\n   {{end}}\n   ```\n\n6. 函数调用：\n\n   使用`{{函数名 参数1 参数2 ...}}`语法调用内置或自定义函数。\n\n   示例：\n   ```\n   {{len .String}}  // 调用len函数返回字符串的长度\n   ```\n\n7. 嵌套模板：\n\n   使用`{{template \"模板名称\" .数据}}`语法在模板中嵌套另一个模板。\n\n   示例：\n   ```\n   {{template \"header\" .PageTitle}}  // 嵌套名为\"header\"的模板，并传入.PageTitle参数\n   ```\n\n这些是常用的模板语法和示例，通过这些语法可以实现动态生成文本或者HTML代码的功能。具体使用方法可以参考Go语言文档中的模板包说明：https://golang.org/pkg/html/template/\n\n在Go语言的模板中，可以通过在模板中调用预定义的全局函数来进行一些常用的操作。Go语言的模板引擎提供了一些内置函数，这些函数可以在模板中直接使用，而不需要额外的导入。\n\n以下是一些常用的预定义全局函数：\n\n1. `and`：接受任意数量的布尔值作为参数，并返回它们的与运算结果。\n示例：\n```\n{{and true true}}  // true\n{{and true false}} // false\n```\n\n2. `or`：接受任意数量的布尔值作为参数，并返回它们的或运算结果。\n示例：\n```\n{{or true true}}  // true\n{{or true false}} // true\n```\n\n3. `not`：接受布尔值作为参数，并返回它的否定值。\n示例：\n```\n{{not true}}  // false\n{{not false}} // true\n```\n\n4. `eq`：用于比较两个值是否相等。\n示例：\n```\n{{eq 10 10}}   // true\n{{eq \"abc\" \"def\"}} // false\n```\n\n5. `ne`：用于比较两个值是否不相等。\n示例：\n```\n{{ne 10 20}}   // true\n{{ne \"abc\" \"abc\"}} // false\n```\n\n6. `lt`：用于比较两个值是否左边小于右边。\n示例：\n```\n{{lt 10 20}}   // true\n{{lt \"abc\" \"def\"}} // true\n```\n\n7. `le`：用于比较两个值是否左边小于等于右边。\n示例：\n```\n{{le 20 20}}   // true\n{{le \"abc\" \"def\"}} // true\n```\n\n8. `gt`：用于比较两个值是否左边大于右边。\n示例：\n```\n{{gt 20 10}}   // true\n{{gt \"def\" \"abc\"}} // true\n```\n\n9. `ge`：用于比较两个值是否左边大于等于右边。\n示例：\n```\n{{ge 20 20}}   // true\n{{ge \"def\" \"abc\"}} // true\n```\n\n10. `len`：返回一个字符串或数组的长度。\n示例：\n```\n{{len \"hello\"}}  // 5\n{{len .slice}}   // 数组或切片的长度\n```\n\n以上就是一些常用的预定义全局函数的使用方法和示例。使用这些函数可以在模板中进行一些基本的逻辑操作和比较。","slug":"golang/go_template","published":1,"updated":"2023-08-23T06:55:23.180Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clo89v5dw0007b7jxd4cj1x57","content":"<p>在Go语言中，使用模板可以通过<code>text/template</code>或者<code>html/template</code>包来实现。这两个包的主要区别是，<code>html/template</code>包会自动对输出进行转义，以防止跨站点脚本攻击。</p>\n<p>下面是<code>text/template</code>和<code>html/template</code>包中常用的模板语法和示例：</p>\n<ol>\n<li><p>注释：</p>\n<p>可以使用<code>&#123;&#123;/* 注释内容 */&#125;&#125;</code>语法添加注释。注释可以在模板执行时忽略。</p>\n<p>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;/* This is a comment */&#125;&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>输出变量值：</p>\n<p>使用<code>&#123;&#123;.&#125;&#125;</code>语法输出当前的上下文变量值。</p>\n<p>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;.&#125;&#125;  // 输出当前上下文的变量值</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>条件语句：</p>\n<p>使用<code>&#123;&#123;if .Condition&#125;&#125; ... &#123;&#123;else&#125;&#125; ... &#123;&#123;end&#125;&#125;</code>语法进行条件判断。</p>\n<p>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;if .Condition&#125;&#125;</span><br><span class=\"line\">    True Block</span><br><span class=\"line\">&#123;&#123;else&#125;&#125;</span><br><span class=\"line\">    False Block</span><br><span class=\"line\">&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>循环语句：</p>\n<p>使用<code>&#123;&#123;range .Slice&#125;&#125; ... &#123;&#123;end&#125;&#125;</code>语法进行循环迭代。</p>\n<p>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;range .Slice&#125;&#125;</span><br><span class=\"line\">    &#123;&#123;.&#125;&#125;  // .表示当前迭代的元素</span><br><span class=\"line\">&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>定义和使用变量：</p>\n<p>使用<code>&#123;&#123;with .Variable&#125;&#125; ... &#123;&#123;end&#125;&#125;</code>语法定义和使用临时变量。</p>\n<p>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;with .Variable&#125;&#125;</span><br><span class=\"line\">    &#123;&#123;.&#125;&#125;  // 使用临时变量</span><br><span class=\"line\">&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>函数调用：</p>\n<p>使用<code>&#123;&#123;函数名 参数1 参数2 ...&#125;&#125;</code>语法调用内置或自定义函数。</p>\n<p>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;len .String&#125;&#125;  // 调用len函数返回字符串的长度</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>嵌套模板：</p>\n<p>使用<code>&#123;&#123;template \"模板名称\" .数据&#125;&#125;</code>语法在模板中嵌套另一个模板。</p>\n<p>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;template &quot;header&quot; .PageTitle&#125;&#125;  // 嵌套名为&quot;header&quot;的模板，并传入.PageTitle参数</span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>这些是常用的模板语法和示例，通过这些语法可以实现动态生成文本或者HTML代码的功能。具体使用方法可以参考Go语言文档中的模板包说明：<a href=\"https://golang.org/pkg/html/template/\">https://golang.org/pkg/html/template/</a></p>\n<p>在Go语言的模板中，可以通过在模板中调用预定义的全局函数来进行一些常用的操作。Go语言的模板引擎提供了一些内置函数，这些函数可以在模板中直接使用，而不需要额外的导入。</p>\n<p>以下是一些常用的预定义全局函数：</p>\n<ol>\n<li><p><code>and</code>：接受任意数量的布尔值作为参数，并返回它们的与运算结果。<br>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;and true true&#125;&#125;  // true</span><br><span class=\"line\">&#123;&#123;and true false&#125;&#125; // false</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>or</code>：接受任意数量的布尔值作为参数，并返回它们的或运算结果。<br>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;or true true&#125;&#125;  // true</span><br><span class=\"line\">&#123;&#123;or true false&#125;&#125; // true</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>not</code>：接受布尔值作为参数，并返回它的否定值。<br>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;not true&#125;&#125;  // false</span><br><span class=\"line\">&#123;&#123;not false&#125;&#125; // true</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>eq</code>：用于比较两个值是否相等。<br>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;eq 10 10&#125;&#125;   // true</span><br><span class=\"line\">&#123;&#123;eq &quot;abc&quot; &quot;def&quot;&#125;&#125; // false</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>ne</code>：用于比较两个值是否不相等。<br>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;ne 10 20&#125;&#125;   // true</span><br><span class=\"line\">&#123;&#123;ne &quot;abc&quot; &quot;abc&quot;&#125;&#125; // false</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>lt</code>：用于比较两个值是否左边小于右边。<br>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;lt 10 20&#125;&#125;   // true</span><br><span class=\"line\">&#123;&#123;lt &quot;abc&quot; &quot;def&quot;&#125;&#125; // true</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>le</code>：用于比较两个值是否左边小于等于右边。<br>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;le 20 20&#125;&#125;   // true</span><br><span class=\"line\">&#123;&#123;le &quot;abc&quot; &quot;def&quot;&#125;&#125; // true</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>gt</code>：用于比较两个值是否左边大于右边。<br>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;gt 20 10&#125;&#125;   // true</span><br><span class=\"line\">&#123;&#123;gt &quot;def&quot; &quot;abc&quot;&#125;&#125; // true</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>ge</code>：用于比较两个值是否左边大于等于右边。<br>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;ge 20 20&#125;&#125;   // true</span><br><span class=\"line\">&#123;&#123;ge &quot;def&quot; &quot;abc&quot;&#125;&#125; // true</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>len</code>：返回一个字符串或数组的长度。<br>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;len &quot;hello&quot;&#125;&#125;  // 5</span><br><span class=\"line\">&#123;&#123;len .slice&#125;&#125;   // 数组或切片的长度</span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>以上就是一些常用的预定义全局函数的使用方法和示例。使用这些函数可以在模板中进行一些基本的逻辑操作和比较。</p>\n","site":{"data":{"link":[{"class_name":"友情鏈接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、簡單且強大的網誌框架"}]},{"class_name":"網站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":false,"excerpt":"","more":"<p>在Go语言中，使用模板可以通过<code>text/template</code>或者<code>html/template</code>包来实现。这两个包的主要区别是，<code>html/template</code>包会自动对输出进行转义，以防止跨站点脚本攻击。</p>\n<p>下面是<code>text/template</code>和<code>html/template</code>包中常用的模板语法和示例：</p>\n<ol>\n<li><p>注释：</p>\n<p>可以使用<code>&#123;&#123;/* 注释内容 */&#125;&#125;</code>语法添加注释。注释可以在模板执行时忽略。</p>\n<p>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;/* This is a comment */&#125;&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>输出变量值：</p>\n<p>使用<code>&#123;&#123;.&#125;&#125;</code>语法输出当前的上下文变量值。</p>\n<p>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;.&#125;&#125;  // 输出当前上下文的变量值</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>条件语句：</p>\n<p>使用<code>&#123;&#123;if .Condition&#125;&#125; ... &#123;&#123;else&#125;&#125; ... &#123;&#123;end&#125;&#125;</code>语法进行条件判断。</p>\n<p>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;if .Condition&#125;&#125;</span><br><span class=\"line\">    True Block</span><br><span class=\"line\">&#123;&#123;else&#125;&#125;</span><br><span class=\"line\">    False Block</span><br><span class=\"line\">&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>循环语句：</p>\n<p>使用<code>&#123;&#123;range .Slice&#125;&#125; ... &#123;&#123;end&#125;&#125;</code>语法进行循环迭代。</p>\n<p>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;range .Slice&#125;&#125;</span><br><span class=\"line\">    &#123;&#123;.&#125;&#125;  // .表示当前迭代的元素</span><br><span class=\"line\">&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>定义和使用变量：</p>\n<p>使用<code>&#123;&#123;with .Variable&#125;&#125; ... &#123;&#123;end&#125;&#125;</code>语法定义和使用临时变量。</p>\n<p>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;with .Variable&#125;&#125;</span><br><span class=\"line\">    &#123;&#123;.&#125;&#125;  // 使用临时变量</span><br><span class=\"line\">&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>函数调用：</p>\n<p>使用<code>&#123;&#123;函数名 参数1 参数2 ...&#125;&#125;</code>语法调用内置或自定义函数。</p>\n<p>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;len .String&#125;&#125;  // 调用len函数返回字符串的长度</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>嵌套模板：</p>\n<p>使用<code>&#123;&#123;template \"模板名称\" .数据&#125;&#125;</code>语法在模板中嵌套另一个模板。</p>\n<p>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;template &quot;header&quot; .PageTitle&#125;&#125;  // 嵌套名为&quot;header&quot;的模板，并传入.PageTitle参数</span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>这些是常用的模板语法和示例，通过这些语法可以实现动态生成文本或者HTML代码的功能。具体使用方法可以参考Go语言文档中的模板包说明：<a href=\"https://golang.org/pkg/html/template/\">https://golang.org/pkg/html/template/</a></p>\n<p>在Go语言的模板中，可以通过在模板中调用预定义的全局函数来进行一些常用的操作。Go语言的模板引擎提供了一些内置函数，这些函数可以在模板中直接使用，而不需要额外的导入。</p>\n<p>以下是一些常用的预定义全局函数：</p>\n<ol>\n<li><p><code>and</code>：接受任意数量的布尔值作为参数，并返回它们的与运算结果。<br>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;and true true&#125;&#125;  // true</span><br><span class=\"line\">&#123;&#123;and true false&#125;&#125; // false</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>or</code>：接受任意数量的布尔值作为参数，并返回它们的或运算结果。<br>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;or true true&#125;&#125;  // true</span><br><span class=\"line\">&#123;&#123;or true false&#125;&#125; // true</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>not</code>：接受布尔值作为参数，并返回它的否定值。<br>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;not true&#125;&#125;  // false</span><br><span class=\"line\">&#123;&#123;not false&#125;&#125; // true</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>eq</code>：用于比较两个值是否相等。<br>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;eq 10 10&#125;&#125;   // true</span><br><span class=\"line\">&#123;&#123;eq &quot;abc&quot; &quot;def&quot;&#125;&#125; // false</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>ne</code>：用于比较两个值是否不相等。<br>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;ne 10 20&#125;&#125;   // true</span><br><span class=\"line\">&#123;&#123;ne &quot;abc&quot; &quot;abc&quot;&#125;&#125; // false</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>lt</code>：用于比较两个值是否左边小于右边。<br>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;lt 10 20&#125;&#125;   // true</span><br><span class=\"line\">&#123;&#123;lt &quot;abc&quot; &quot;def&quot;&#125;&#125; // true</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>le</code>：用于比较两个值是否左边小于等于右边。<br>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;le 20 20&#125;&#125;   // true</span><br><span class=\"line\">&#123;&#123;le &quot;abc&quot; &quot;def&quot;&#125;&#125; // true</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>gt</code>：用于比较两个值是否左边大于右边。<br>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;gt 20 10&#125;&#125;   // true</span><br><span class=\"line\">&#123;&#123;gt &quot;def&quot; &quot;abc&quot;&#125;&#125; // true</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>ge</code>：用于比较两个值是否左边大于等于右边。<br>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;ge 20 20&#125;&#125;   // true</span><br><span class=\"line\">&#123;&#123;ge &quot;def&quot; &quot;abc&quot;&#125;&#125; // true</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>len</code>：返回一个字符串或数组的长度。<br>示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;len &quot;hello&quot;&#125;&#125;  // 5</span><br><span class=\"line\">&#123;&#123;len .slice&#125;&#125;   // 数组或切片的长度</span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>以上就是一些常用的预定义全局函数的使用方法和示例。使用这些函数可以在模板中进行一些基本的逻辑操作和比较。</p>\n"},{"title":"go mod使用最新提交","date":"2023-08-18T10:49:14.000Z","_content":"​\n例如一个项目在其中依赖了    github.com/linuxsuren/go-fake-runtime v0.0.1\n\ngo.mod内容：\n\n\tgithub.com/linuxsuren/go-fake-runtime v0.0.1\n\n修改了github.com/linuxsuren/go-fake-runtime代码，存在一个最新的commit hash值为25fa814c6232e545f5bce03bd4db04fc37e10250\n\n修改项目中的go.mod\n```\ngithub.com/linuxsuren/go-fake-runtime 25fa814c6232e545f5bce03bd4db04fc37e10250\n```\n然后执行go mod tidy,会看到go.mod中的依赖会更新为最新的提交\n```\ngithub.com/linuxsuren/go-fake-runtime v0.0.2-0.20230815071200-25fa814c6232\n```\n至此项目依赖的github.com/linuxsuren/go-fake-runtime已由v0.0.1版本更为指定的commit。\n\n​","source":"_posts/golang/last_version_mod.md","raw":"---\ntitle: go mod使用最新提交\ndate: 2023-08-18 18:49:14\ncategories:\n  - [golang]\ntags: golang\n---\n​\n例如一个项目在其中依赖了    github.com/linuxsuren/go-fake-runtime v0.0.1\n\ngo.mod内容：\n\n\tgithub.com/linuxsuren/go-fake-runtime v0.0.1\n\n修改了github.com/linuxsuren/go-fake-runtime代码，存在一个最新的commit hash值为25fa814c6232e545f5bce03bd4db04fc37e10250\n\n修改项目中的go.mod\n```\ngithub.com/linuxsuren/go-fake-runtime 25fa814c6232e545f5bce03bd4db04fc37e10250\n```\n然后执行go mod tidy,会看到go.mod中的依赖会更新为最新的提交\n```\ngithub.com/linuxsuren/go-fake-runtime v0.0.2-0.20230815071200-25fa814c6232\n```\n至此项目依赖的github.com/linuxsuren/go-fake-runtime已由v0.0.1版本更为指定的commit。\n\n​","slug":"golang/last_version_mod","published":1,"updated":"2023-08-23T06:55:29.952Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clo89v5e10009b7jx4hi8c6vn","content":"<p>​<br>例如一个项目在其中依赖了    github.com&#x2F;linuxsuren&#x2F;go-fake-runtime v0.0.1</p>\n<p>go.mod内容：</p>\n<pre><code>github.com/linuxsuren/go-fake-runtime v0.0.1\n</code></pre>\n<p>修改了github.com&#x2F;linuxsuren&#x2F;go-fake-runtime代码，存在一个最新的commit hash值为25fa814c6232e545f5bce03bd4db04fc37e10250</p>\n<p>修改项目中的go.mod</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">github.com/linuxsuren/go-fake-runtime 25fa814c6232e545f5bce03bd4db04fc37e10250</span><br></pre></td></tr></table></figure>\n<p>然后执行go mod tidy,会看到go.mod中的依赖会更新为最新的提交</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">github.com/linuxsuren/go-fake-runtime v0.0.2-0.20230815071200-25fa814c6232</span><br></pre></td></tr></table></figure>\n<p>至此项目依赖的github.com&#x2F;linuxsuren&#x2F;go-fake-runtime已由v0.0.1版本更为指定的commit。</p>\n<p>​</p>\n","site":{"data":{"link":[{"class_name":"友情鏈接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、簡單且強大的網誌框架"}]},{"class_name":"網站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":false,"excerpt":"","more":"<p>​<br>例如一个项目在其中依赖了    github.com&#x2F;linuxsuren&#x2F;go-fake-runtime v0.0.1</p>\n<p>go.mod内容：</p>\n<pre><code>github.com/linuxsuren/go-fake-runtime v0.0.1\n</code></pre>\n<p>修改了github.com&#x2F;linuxsuren&#x2F;go-fake-runtime代码，存在一个最新的commit hash值为25fa814c6232e545f5bce03bd4db04fc37e10250</p>\n<p>修改项目中的go.mod</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">github.com/linuxsuren/go-fake-runtime 25fa814c6232e545f5bce03bd4db04fc37e10250</span><br></pre></td></tr></table></figure>\n<p>然后执行go mod tidy,会看到go.mod中的依赖会更新为最新的提交</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">github.com/linuxsuren/go-fake-runtime v0.0.2-0.20230815071200-25fa814c6232</span><br></pre></td></tr></table></figure>\n<p>至此项目依赖的github.com&#x2F;linuxsuren&#x2F;go-fake-runtime已由v0.0.1版本更为指定的commit。</p>\n<p>​</p>\n"},{"title":"install nodejs","date":"2023-08-22T08:35:17.000Z","_content":"要在Ubuntu上安装Node.js和NPM，你可以按照以下步骤进行操作：\n\n1. 首先，打开终端。\n\n2. 更新系统软件包列表：\n\n   ```\n   sudo apt update\n   ```\n\n3. 安装Node.js：\n\n   ```\n   sudo apt install nodejs\n   ```\n\n   这将安装最新版本的Node.js。\n\n4. 安装npm：\n\n   ```\n   sudo apt install npm\n   ```\n\n   这将安装最新版本的npm。\n\n5. 检查Node.js和npm的安装版本：\n\n   ```\n   nodejs --version\n   npm --version\n   ```\n\n   在命令行上将显示Node.js和npm的版本号。\n\n如果你希望安装特定版本的Node.js和npm，可以使用nvm（Node Version Manager）工具。\n\n1. 安装nvm：\n\n   ```\n   curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash\n   ```\n\n   这将下载并运行nvm的安装脚本。\n\n2. 重新打开终端，或者在当前终端中运行以下命令以启用nvm：\n\n   ```\n   source ~/.bashrc\n   ```\n\n3. 安装所需版本的Node.js：\n\n   ```\n   nvm install 18.17.1\n   ```\n\n   这将安装Node.js v18.17.1。\n\n4. 使用所需版本的Node.js：\n\n   ```\n   nvm use 18.17.1\n   ```\n\n   这将在当前终端会话中使用Node.js v18.17.1。\n\n5. 安装所需版本的npm：\n\n   ```\n   npm install -g npm@9.6.7\n   ```\n\n   这将安装npm v9.6.7。\n\n6. 检查Node.js和npm的安装版本：\n\n   ```\n   node --version\n   npm --version\n   ```\n\n   在命令行上将显示Node.js v18.17.1和npm v9.6.7的版本号。\n\n请注意，使用nvm安装的Node.js版本仅在您的当前终端会话中有效。如果您希望在其他终端会话中使用相同的Node.js版本，您需要运行相应的`nvm use`命令。","source":"_posts/nodejs/install_nodejs.md","raw":"---\ntitle: install nodejs\ndate: 2023-08-22 16:35:17\ntags: nodejs\n---\n要在Ubuntu上安装Node.js和NPM，你可以按照以下步骤进行操作：\n\n1. 首先，打开终端。\n\n2. 更新系统软件包列表：\n\n   ```\n   sudo apt update\n   ```\n\n3. 安装Node.js：\n\n   ```\n   sudo apt install nodejs\n   ```\n\n   这将安装最新版本的Node.js。\n\n4. 安装npm：\n\n   ```\n   sudo apt install npm\n   ```\n\n   这将安装最新版本的npm。\n\n5. 检查Node.js和npm的安装版本：\n\n   ```\n   nodejs --version\n   npm --version\n   ```\n\n   在命令行上将显示Node.js和npm的版本号。\n\n如果你希望安装特定版本的Node.js和npm，可以使用nvm（Node Version Manager）工具。\n\n1. 安装nvm：\n\n   ```\n   curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash\n   ```\n\n   这将下载并运行nvm的安装脚本。\n\n2. 重新打开终端，或者在当前终端中运行以下命令以启用nvm：\n\n   ```\n   source ~/.bashrc\n   ```\n\n3. 安装所需版本的Node.js：\n\n   ```\n   nvm install 18.17.1\n   ```\n\n   这将安装Node.js v18.17.1。\n\n4. 使用所需版本的Node.js：\n\n   ```\n   nvm use 18.17.1\n   ```\n\n   这将在当前终端会话中使用Node.js v18.17.1。\n\n5. 安装所需版本的npm：\n\n   ```\n   npm install -g npm@9.6.7\n   ```\n\n   这将安装npm v9.6.7。\n\n6. 检查Node.js和npm的安装版本：\n\n   ```\n   node --version\n   npm --version\n   ```\n\n   在命令行上将显示Node.js v18.17.1和npm v9.6.7的版本号。\n\n请注意，使用nvm安装的Node.js版本仅在您的当前终端会话中有效。如果您希望在其他终端会话中使用相同的Node.js版本，您需要运行相应的`nvm use`命令。","slug":"nodejs/install_nodejs","published":1,"updated":"2023-08-22T08:36:07.375Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clo89v5e6000bb7jx326d9a3e","content":"<p>要在Ubuntu上安装Node.js和NPM，你可以按照以下步骤进行操作：</p>\n<ol>\n<li><p>首先，打开终端。</p>\n</li>\n<li><p>更新系统软件包列表：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt update</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>安装Node.js：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt install nodejs</span><br></pre></td></tr></table></figure>\n\n<p>这将安装最新版本的Node.js。</p>\n</li>\n<li><p>安装npm：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt install npm</span><br></pre></td></tr></table></figure>\n\n<p>这将安装最新版本的npm。</p>\n</li>\n<li><p>检查Node.js和npm的安装版本：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nodejs --version</span><br><span class=\"line\">npm --version</span><br></pre></td></tr></table></figure>\n\n<p>在命令行上将显示Node.js和npm的版本号。</p>\n</li>\n</ol>\n<p>如果你希望安装特定版本的Node.js和npm，可以使用nvm（Node Version Manager）工具。</p>\n<ol>\n<li><p>安装nvm：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash</span><br></pre></td></tr></table></figure>\n\n<p>这将下载并运行nvm的安装脚本。</p>\n</li>\n<li><p>重新打开终端，或者在当前终端中运行以下命令以启用nvm：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">source ~/.bashrc</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>安装所需版本的Node.js：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nvm install 18.17.1</span><br></pre></td></tr></table></figure>\n\n<p>这将安装Node.js v18.17.1。</p>\n</li>\n<li><p>使用所需版本的Node.js：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nvm use 18.17.1</span><br></pre></td></tr></table></figure>\n\n<p>这将在当前终端会话中使用Node.js v18.17.1。</p>\n</li>\n<li><p>安装所需版本的npm：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g npm@9.6.7</span><br></pre></td></tr></table></figure>\n\n<p>这将安装npm v9.6.7。</p>\n</li>\n<li><p>检查Node.js和npm的安装版本：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">node --version</span><br><span class=\"line\">npm --version</span><br></pre></td></tr></table></figure>\n\n<p>在命令行上将显示Node.js v18.17.1和npm v9.6.7的版本号。</p>\n</li>\n</ol>\n<p>请注意，使用nvm安装的Node.js版本仅在您的当前终端会话中有效。如果您希望在其他终端会话中使用相同的Node.js版本，您需要运行相应的<code>nvm use</code>命令。</p>\n","site":{"data":{"link":[{"class_name":"友情鏈接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、簡單且強大的網誌框架"}]},{"class_name":"網站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":false,"excerpt":"","more":"<p>要在Ubuntu上安装Node.js和NPM，你可以按照以下步骤进行操作：</p>\n<ol>\n<li><p>首先，打开终端。</p>\n</li>\n<li><p>更新系统软件包列表：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt update</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>安装Node.js：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt install nodejs</span><br></pre></td></tr></table></figure>\n\n<p>这将安装最新版本的Node.js。</p>\n</li>\n<li><p>安装npm：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt install npm</span><br></pre></td></tr></table></figure>\n\n<p>这将安装最新版本的npm。</p>\n</li>\n<li><p>检查Node.js和npm的安装版本：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nodejs --version</span><br><span class=\"line\">npm --version</span><br></pre></td></tr></table></figure>\n\n<p>在命令行上将显示Node.js和npm的版本号。</p>\n</li>\n</ol>\n<p>如果你希望安装特定版本的Node.js和npm，可以使用nvm（Node Version Manager）工具。</p>\n<ol>\n<li><p>安装nvm：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash</span><br></pre></td></tr></table></figure>\n\n<p>这将下载并运行nvm的安装脚本。</p>\n</li>\n<li><p>重新打开终端，或者在当前终端中运行以下命令以启用nvm：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">source ~/.bashrc</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>安装所需版本的Node.js：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nvm install 18.17.1</span><br></pre></td></tr></table></figure>\n\n<p>这将安装Node.js v18.17.1。</p>\n</li>\n<li><p>使用所需版本的Node.js：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nvm use 18.17.1</span><br></pre></td></tr></table></figure>\n\n<p>这将在当前终端会话中使用Node.js v18.17.1。</p>\n</li>\n<li><p>安装所需版本的npm：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g npm@9.6.7</span><br></pre></td></tr></table></figure>\n\n<p>这将安装npm v9.6.7。</p>\n</li>\n<li><p>检查Node.js和npm的安装版本：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">node --version</span><br><span class=\"line\">npm --version</span><br></pre></td></tr></table></figure>\n\n<p>在命令行上将显示Node.js v18.17.1和npm v9.6.7的版本号。</p>\n</li>\n</ol>\n<p>请注意，使用nvm安装的Node.js版本仅在您的当前终端会话中有效。如果您希望在其他终端会话中使用相同的Node.js版本，您需要运行相应的<code>nvm use</code>命令。</p>\n"},{"title":"chrony参数及常用命令介绍","date":"2023-10-27T06:38:29.000Z","_content":"​\n# 1. 背景\n在Kubernetes集群中，如果各节点的时间不一致，可能会带来以下影响：\n\n资源调度问题：Kubernetes使用资源调度器来分配任务和计算资源。如果各个节点的时间不一致，可能会导致调度器无法准确判断任务的截止时间，从而影响任务的执行和资源的分配。\n服务一致性问题：对于有状态的服务（如数据库），如果各个节点的时间不一致，可能会导致数据一致性问题。例如，如果在某个节点上写入了一条数据，然后在另一个时间不一致的节点上读取数据，可能会读取到过期的数据。\n日志分析问题：在Kubernetes集群中，所有的日志都是按照时间顺序排列的。如果各个节点的时间不一致，可能会导致日志分析出现问题，如时间戳不匹配、事件顺序错误等。\n容器同步问题：Kubernetes使用容器来运行任务。如果各个节点的时间不一致，可能会导致容器同步出现问题，如容器启动和停止的时间不一致等。\n网络通信问题：Kubernetes集群中的各个节点通过网络进行通信。如果节点之间的时间不一致，可能会导致网络通信出现问题，如消息延迟、丢包等。\n监控和报警问题：如果各个节点的时间不一致，可能会导致监控和报警系统出现问题。例如，报警阈值设置错误、监控数据不准确等。\n采用chrony进行集群节点间时间同步。\n\n#2. chrony配置文件介绍\nubuntu系统下chrony配置文件路径为/etc/chrony/chrony.conf ，内容如下：\n```\n# Welcome to the chrony configuration file. See chrony.conf(5) for more\nserver 192.168.0.206 iburst  #选择集群中一个节点作为服务器，这在集群无法连接外网是保证所有节点时间一直，其余所有节点从该节点获取时间同步。\nserver ntp.aliyun.com iburst #外网ntp server\nserver time1.cloud.tencent.com iburst\n# information about usuable directives.\n\n# This will use (up to):\n# - 4 sources from ntp.ubuntu.com which some are ipv6 enabled\n# - 2 sources from 2.ubuntu.pool.ntp.org which is ipv6 enabled as well\n# - 1 source from [01].ubuntu.pool.ntp.org each (ipv4 only atm)\n# This means by default, up to 6 dual-stack and up to 2 additional IPv4-only\n# sources will be used.\n# At the same time it retains some protection against one of the entries being\n# down (compare to just using one of the lines). See (LP: #1754358) for the\n# discussion.\n#\n# About using servers from the NTP Pool Project in general see (LP: #104525).\n# Approved by Ubuntu Technical Board on 2011-02-08.\n# See http://www.pool.ntp.org/join.html for more information.\npool ntp.ubuntu.com        iburst maxsources 4\npool 0.ubuntu.pool.ntp.org iburst maxsources 1\npool 1.ubuntu.pool.ntp.org iburst maxsources 1\npool 2.ubuntu.pool.ntp.org iburst maxsources 2\n\n# This directive specify the location of the file containing ID/key pairs for\n# NTP authentication.\nkeyfile /etc/chrony/chrony.keys\n\n# This directive specify the file into which chronyd will store the rate\n# information.\ndriftfile /var/lib/chrony/chrony.drift\n\n# Uncomment the following line to turn logging on.\n#log tracking measurements statistics\n\n# Log files location.\nlogdir /var/log/chrony\n\n# Stop bad estimates upsetting machine clock.\nmaxupdateskew 100.0\n\n# This directive enables kernel synchronisation (every 11 minutes) of the\n# real-time clock. Note that it can’t be used along with the 'rtcfile' directive.\nrtcsync\n\n# Step the system clock instead of slewing it if the adjustment is larger than\n# one second, but only in the first three clock updates.\nmakestep 1 3 #此出可以设置为：makestep 3 -1 当误差大于三秒时执行步进调整，而不用等待微调\n\nallow all #允许所有ip访问本时间服务器\n\nlocal stratum 10 #即使自己未能通过网络时间服务器同步到时间，也允许将本地时间作为标准时间授时给其它客户端\n```\n# 3. 常用命令\n\ntimedatectl set-time \"2023-10-27 12:30:50\" ：修改时间\nchronyc tracking： 服务当前同步状态的快照\nchronyc sources -v：查看时间同步源\nchronyc makestep：立即执行步进调整\nsystemctl status chronyd： 查看chronyd服务状态\nsystemctl restart chronyd: 重启chronyd服务\n\n​","source":"_posts/linux/chrony.md","raw":"---\ntitle: chrony参数及常用命令介绍\ndate: 2023-10-27 14:38:29\ncategories:\n  - [linux]\ntags: chrony\n---\n​\n# 1. 背景\n在Kubernetes集群中，如果各节点的时间不一致，可能会带来以下影响：\n\n资源调度问题：Kubernetes使用资源调度器来分配任务和计算资源。如果各个节点的时间不一致，可能会导致调度器无法准确判断任务的截止时间，从而影响任务的执行和资源的分配。\n服务一致性问题：对于有状态的服务（如数据库），如果各个节点的时间不一致，可能会导致数据一致性问题。例如，如果在某个节点上写入了一条数据，然后在另一个时间不一致的节点上读取数据，可能会读取到过期的数据。\n日志分析问题：在Kubernetes集群中，所有的日志都是按照时间顺序排列的。如果各个节点的时间不一致，可能会导致日志分析出现问题，如时间戳不匹配、事件顺序错误等。\n容器同步问题：Kubernetes使用容器来运行任务。如果各个节点的时间不一致，可能会导致容器同步出现问题，如容器启动和停止的时间不一致等。\n网络通信问题：Kubernetes集群中的各个节点通过网络进行通信。如果节点之间的时间不一致，可能会导致网络通信出现问题，如消息延迟、丢包等。\n监控和报警问题：如果各个节点的时间不一致，可能会导致监控和报警系统出现问题。例如，报警阈值设置错误、监控数据不准确等。\n采用chrony进行集群节点间时间同步。\n\n#2. chrony配置文件介绍\nubuntu系统下chrony配置文件路径为/etc/chrony/chrony.conf ，内容如下：\n```\n# Welcome to the chrony configuration file. See chrony.conf(5) for more\nserver 192.168.0.206 iburst  #选择集群中一个节点作为服务器，这在集群无法连接外网是保证所有节点时间一直，其余所有节点从该节点获取时间同步。\nserver ntp.aliyun.com iburst #外网ntp server\nserver time1.cloud.tencent.com iburst\n# information about usuable directives.\n\n# This will use (up to):\n# - 4 sources from ntp.ubuntu.com which some are ipv6 enabled\n# - 2 sources from 2.ubuntu.pool.ntp.org which is ipv6 enabled as well\n# - 1 source from [01].ubuntu.pool.ntp.org each (ipv4 only atm)\n# This means by default, up to 6 dual-stack and up to 2 additional IPv4-only\n# sources will be used.\n# At the same time it retains some protection against one of the entries being\n# down (compare to just using one of the lines). See (LP: #1754358) for the\n# discussion.\n#\n# About using servers from the NTP Pool Project in general see (LP: #104525).\n# Approved by Ubuntu Technical Board on 2011-02-08.\n# See http://www.pool.ntp.org/join.html for more information.\npool ntp.ubuntu.com        iburst maxsources 4\npool 0.ubuntu.pool.ntp.org iburst maxsources 1\npool 1.ubuntu.pool.ntp.org iburst maxsources 1\npool 2.ubuntu.pool.ntp.org iburst maxsources 2\n\n# This directive specify the location of the file containing ID/key pairs for\n# NTP authentication.\nkeyfile /etc/chrony/chrony.keys\n\n# This directive specify the file into which chronyd will store the rate\n# information.\ndriftfile /var/lib/chrony/chrony.drift\n\n# Uncomment the following line to turn logging on.\n#log tracking measurements statistics\n\n# Log files location.\nlogdir /var/log/chrony\n\n# Stop bad estimates upsetting machine clock.\nmaxupdateskew 100.0\n\n# This directive enables kernel synchronisation (every 11 minutes) of the\n# real-time clock. Note that it can’t be used along with the 'rtcfile' directive.\nrtcsync\n\n# Step the system clock instead of slewing it if the adjustment is larger than\n# one second, but only in the first three clock updates.\nmakestep 1 3 #此出可以设置为：makestep 3 -1 当误差大于三秒时执行步进调整，而不用等待微调\n\nallow all #允许所有ip访问本时间服务器\n\nlocal stratum 10 #即使自己未能通过网络时间服务器同步到时间，也允许将本地时间作为标准时间授时给其它客户端\n```\n# 3. 常用命令\n\ntimedatectl set-time \"2023-10-27 12:30:50\" ：修改时间\nchronyc tracking： 服务当前同步状态的快照\nchronyc sources -v：查看时间同步源\nchronyc makestep：立即执行步进调整\nsystemctl status chronyd： 查看chronyd服务状态\nsystemctl restart chronyd: 重启chronyd服务\n\n​","slug":"linux/chrony","published":1,"updated":"2023-10-27T07:08:31.967Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clo89v5e8000cb7jx9hd810tn","content":"<p>​</p>\n<h1 id=\"1-背景\"><a href=\"#1-背景\" class=\"headerlink\" title=\"1. 背景\"></a>1. 背景</h1><p>在Kubernetes集群中，如果各节点的时间不一致，可能会带来以下影响：</p>\n<p>资源调度问题：Kubernetes使用资源调度器来分配任务和计算资源。如果各个节点的时间不一致，可能会导致调度器无法准确判断任务的截止时间，从而影响任务的执行和资源的分配。<br>服务一致性问题：对于有状态的服务（如数据库），如果各个节点的时间不一致，可能会导致数据一致性问题。例如，如果在某个节点上写入了一条数据，然后在另一个时间不一致的节点上读取数据，可能会读取到过期的数据。<br>日志分析问题：在Kubernetes集群中，所有的日志都是按照时间顺序排列的。如果各个节点的时间不一致，可能会导致日志分析出现问题，如时间戳不匹配、事件顺序错误等。<br>容器同步问题：Kubernetes使用容器来运行任务。如果各个节点的时间不一致，可能会导致容器同步出现问题，如容器启动和停止的时间不一致等。<br>网络通信问题：Kubernetes集群中的各个节点通过网络进行通信。如果节点之间的时间不一致，可能会导致网络通信出现问题，如消息延迟、丢包等。<br>监控和报警问题：如果各个节点的时间不一致，可能会导致监控和报警系统出现问题。例如，报警阈值设置错误、监控数据不准确等。<br>采用chrony进行集群节点间时间同步。</p>\n<p>#2. chrony配置文件介绍<br>ubuntu系统下chrony配置文件路径为&#x2F;etc&#x2F;chrony&#x2F;chrony.conf ，内容如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Welcome to the chrony configuration file. See chrony.conf(5) for more</span><br><span class=\"line\">server 192.168.0.206 iburst  #选择集群中一个节点作为服务器，这在集群无法连接外网是保证所有节点时间一直，其余所有节点从该节点获取时间同步。</span><br><span class=\"line\">server ntp.aliyun.com iburst #外网ntp server</span><br><span class=\"line\">server time1.cloud.tencent.com iburst</span><br><span class=\"line\"># information about usuable directives.</span><br><span class=\"line\"></span><br><span class=\"line\"># This will use (up to):</span><br><span class=\"line\"># - 4 sources from ntp.ubuntu.com which some are ipv6 enabled</span><br><span class=\"line\"># - 2 sources from 2.ubuntu.pool.ntp.org which is ipv6 enabled as well</span><br><span class=\"line\"># - 1 source from [01].ubuntu.pool.ntp.org each (ipv4 only atm)</span><br><span class=\"line\"># This means by default, up to 6 dual-stack and up to 2 additional IPv4-only</span><br><span class=\"line\"># sources will be used.</span><br><span class=\"line\"># At the same time it retains some protection against one of the entries being</span><br><span class=\"line\"># down (compare to just using one of the lines). See (LP: #1754358) for the</span><br><span class=\"line\"># discussion.</span><br><span class=\"line\">#</span><br><span class=\"line\"># About using servers from the NTP Pool Project in general see (LP: #104525).</span><br><span class=\"line\"># Approved by Ubuntu Technical Board on 2011-02-08.</span><br><span class=\"line\"># See http://www.pool.ntp.org/join.html for more information.</span><br><span class=\"line\">pool ntp.ubuntu.com        iburst maxsources 4</span><br><span class=\"line\">pool 0.ubuntu.pool.ntp.org iburst maxsources 1</span><br><span class=\"line\">pool 1.ubuntu.pool.ntp.org iburst maxsources 1</span><br><span class=\"line\">pool 2.ubuntu.pool.ntp.org iburst maxsources 2</span><br><span class=\"line\"></span><br><span class=\"line\"># This directive specify the location of the file containing ID/key pairs for</span><br><span class=\"line\"># NTP authentication.</span><br><span class=\"line\">keyfile /etc/chrony/chrony.keys</span><br><span class=\"line\"></span><br><span class=\"line\"># This directive specify the file into which chronyd will store the rate</span><br><span class=\"line\"># information.</span><br><span class=\"line\">driftfile /var/lib/chrony/chrony.drift</span><br><span class=\"line\"></span><br><span class=\"line\"># Uncomment the following line to turn logging on.</span><br><span class=\"line\">#log tracking measurements statistics</span><br><span class=\"line\"></span><br><span class=\"line\"># Log files location.</span><br><span class=\"line\">logdir /var/log/chrony</span><br><span class=\"line\"></span><br><span class=\"line\"># Stop bad estimates upsetting machine clock.</span><br><span class=\"line\">maxupdateskew 100.0</span><br><span class=\"line\"></span><br><span class=\"line\"># This directive enables kernel synchronisation (every 11 minutes) of the</span><br><span class=\"line\"># real-time clock. Note that it can’t be used along with the &#x27;rtcfile&#x27; directive.</span><br><span class=\"line\">rtcsync</span><br><span class=\"line\"></span><br><span class=\"line\"># Step the system clock instead of slewing it if the adjustment is larger than</span><br><span class=\"line\"># one second, but only in the first three clock updates.</span><br><span class=\"line\">makestep 1 3 #此出可以设置为：makestep 3 -1 当误差大于三秒时执行步进调整，而不用等待微调</span><br><span class=\"line\"></span><br><span class=\"line\">allow all #允许所有ip访问本时间服务器</span><br><span class=\"line\"></span><br><span class=\"line\">local stratum 10 #即使自己未能通过网络时间服务器同步到时间，也允许将本地时间作为标准时间授时给其它客户端</span><br></pre></td></tr></table></figure>\n<h1 id=\"3-常用命令\"><a href=\"#3-常用命令\" class=\"headerlink\" title=\"3. 常用命令\"></a>3. 常用命令</h1><p>timedatectl set-time “2023-10-27 12:30:50” ：修改时间<br>chronyc tracking： 服务当前同步状态的快照<br>chronyc sources -v：查看时间同步源<br>chronyc makestep：立即执行步进调整<br>systemctl status chronyd： 查看chronyd服务状态<br>systemctl restart chronyd: 重启chronyd服务</p>\n<p>​</p>\n","site":{"data":{"link":[{"class_name":"友情鏈接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、簡單且強大的網誌框架"}]},{"class_name":"網站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":false,"excerpt":"","more":"<p>​</p>\n<h1 id=\"1-背景\"><a href=\"#1-背景\" class=\"headerlink\" title=\"1. 背景\"></a>1. 背景</h1><p>在Kubernetes集群中，如果各节点的时间不一致，可能会带来以下影响：</p>\n<p>资源调度问题：Kubernetes使用资源调度器来分配任务和计算资源。如果各个节点的时间不一致，可能会导致调度器无法准确判断任务的截止时间，从而影响任务的执行和资源的分配。<br>服务一致性问题：对于有状态的服务（如数据库），如果各个节点的时间不一致，可能会导致数据一致性问题。例如，如果在某个节点上写入了一条数据，然后在另一个时间不一致的节点上读取数据，可能会读取到过期的数据。<br>日志分析问题：在Kubernetes集群中，所有的日志都是按照时间顺序排列的。如果各个节点的时间不一致，可能会导致日志分析出现问题，如时间戳不匹配、事件顺序错误等。<br>容器同步问题：Kubernetes使用容器来运行任务。如果各个节点的时间不一致，可能会导致容器同步出现问题，如容器启动和停止的时间不一致等。<br>网络通信问题：Kubernetes集群中的各个节点通过网络进行通信。如果节点之间的时间不一致，可能会导致网络通信出现问题，如消息延迟、丢包等。<br>监控和报警问题：如果各个节点的时间不一致，可能会导致监控和报警系统出现问题。例如，报警阈值设置错误、监控数据不准确等。<br>采用chrony进行集群节点间时间同步。</p>\n<p>#2. chrony配置文件介绍<br>ubuntu系统下chrony配置文件路径为&#x2F;etc&#x2F;chrony&#x2F;chrony.conf ，内容如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Welcome to the chrony configuration file. See chrony.conf(5) for more</span><br><span class=\"line\">server 192.168.0.206 iburst  #选择集群中一个节点作为服务器，这在集群无法连接外网是保证所有节点时间一直，其余所有节点从该节点获取时间同步。</span><br><span class=\"line\">server ntp.aliyun.com iburst #外网ntp server</span><br><span class=\"line\">server time1.cloud.tencent.com iburst</span><br><span class=\"line\"># information about usuable directives.</span><br><span class=\"line\"></span><br><span class=\"line\"># This will use (up to):</span><br><span class=\"line\"># - 4 sources from ntp.ubuntu.com which some are ipv6 enabled</span><br><span class=\"line\"># - 2 sources from 2.ubuntu.pool.ntp.org which is ipv6 enabled as well</span><br><span class=\"line\"># - 1 source from [01].ubuntu.pool.ntp.org each (ipv4 only atm)</span><br><span class=\"line\"># This means by default, up to 6 dual-stack and up to 2 additional IPv4-only</span><br><span class=\"line\"># sources will be used.</span><br><span class=\"line\"># At the same time it retains some protection against one of the entries being</span><br><span class=\"line\"># down (compare to just using one of the lines). See (LP: #1754358) for the</span><br><span class=\"line\"># discussion.</span><br><span class=\"line\">#</span><br><span class=\"line\"># About using servers from the NTP Pool Project in general see (LP: #104525).</span><br><span class=\"line\"># Approved by Ubuntu Technical Board on 2011-02-08.</span><br><span class=\"line\"># See http://www.pool.ntp.org/join.html for more information.</span><br><span class=\"line\">pool ntp.ubuntu.com        iburst maxsources 4</span><br><span class=\"line\">pool 0.ubuntu.pool.ntp.org iburst maxsources 1</span><br><span class=\"line\">pool 1.ubuntu.pool.ntp.org iburst maxsources 1</span><br><span class=\"line\">pool 2.ubuntu.pool.ntp.org iburst maxsources 2</span><br><span class=\"line\"></span><br><span class=\"line\"># This directive specify the location of the file containing ID/key pairs for</span><br><span class=\"line\"># NTP authentication.</span><br><span class=\"line\">keyfile /etc/chrony/chrony.keys</span><br><span class=\"line\"></span><br><span class=\"line\"># This directive specify the file into which chronyd will store the rate</span><br><span class=\"line\"># information.</span><br><span class=\"line\">driftfile /var/lib/chrony/chrony.drift</span><br><span class=\"line\"></span><br><span class=\"line\"># Uncomment the following line to turn logging on.</span><br><span class=\"line\">#log tracking measurements statistics</span><br><span class=\"line\"></span><br><span class=\"line\"># Log files location.</span><br><span class=\"line\">logdir /var/log/chrony</span><br><span class=\"line\"></span><br><span class=\"line\"># Stop bad estimates upsetting machine clock.</span><br><span class=\"line\">maxupdateskew 100.0</span><br><span class=\"line\"></span><br><span class=\"line\"># This directive enables kernel synchronisation (every 11 minutes) of the</span><br><span class=\"line\"># real-time clock. Note that it can’t be used along with the &#x27;rtcfile&#x27; directive.</span><br><span class=\"line\">rtcsync</span><br><span class=\"line\"></span><br><span class=\"line\"># Step the system clock instead of slewing it if the adjustment is larger than</span><br><span class=\"line\"># one second, but only in the first three clock updates.</span><br><span class=\"line\">makestep 1 3 #此出可以设置为：makestep 3 -1 当误差大于三秒时执行步进调整，而不用等待微调</span><br><span class=\"line\"></span><br><span class=\"line\">allow all #允许所有ip访问本时间服务器</span><br><span class=\"line\"></span><br><span class=\"line\">local stratum 10 #即使自己未能通过网络时间服务器同步到时间，也允许将本地时间作为标准时间授时给其它客户端</span><br></pre></td></tr></table></figure>\n<h1 id=\"3-常用命令\"><a href=\"#3-常用命令\" class=\"headerlink\" title=\"3. 常用命令\"></a>3. 常用命令</h1><p>timedatectl set-time “2023-10-27 12:30:50” ：修改时间<br>chronyc tracking： 服务当前同步状态的快照<br>chronyc sources -v：查看时间同步源<br>chronyc makestep：立即执行步进调整<br>systemctl status chronyd： 查看chronyd服务状态<br>systemctl restart chronyd: 重启chronyd服务</p>\n<p>​</p>\n"},{"title":"deepflow dashboard","date":"2023-10-18T08:54:51.000Z","_content":"1. Application-Service List\n此dashboard包含两个部分，分别是Service List和EndPoint List。展示了服务时延，请求速率，成功率等信息。\n1.2 Service List\n![Alt text](image.png)\n● Data Source： 数据源为DeepFlow\n● auto_service： 筛选指定的service\n● app_service:  筛选app_service\n● signal_source: 筛选信号源\nAuto Service\nApp Service\nSignal Source\nRequest Rate\nDelay Avg\nDelay P75\nClient Error Ratio\nServer Error Ratio\n对应k8s中service name\n\n分为三种类型信号源：\nPacket (cBPF)、eBPF、OTel来自不同信号源数据有细微差距。\n请求速率 \n平均时延\n75%的请求时延时间段\n客户端异常比例，通过客户端异常 / 响应计算得，即 client_error / response\n服务端异常比例，通过服务端异常 / 响应计算得，即 server_error / response\n1.3 Endpoint List\n![Alt text](image-1.png)\n服务端点时延信息。\n2. Application - Cloud Host\n此dashboard主要以kubernetes节点的角度展示了请求成功率时延等信息。\n![Alt text](image-2.png)\n● vm: 筛选指定节点\n● protocol: 筛选指定协议\nchost\nProtocol\nRequest\nClient error\nServer error\nLatency\n云节点名\n网络协议类型\n请求速率\n客户端错误百分比\n服务端错误百分比\n平均时延\n3. Application - Cloud Host Map\n此dashboard主要通过Map展示，当节点作为server，和当节点作为client两种角色情况下，请求时延，请求速率，客户端错误百分比，服务端百分比等信息。\n3.1 当节点上服务作为服务端时：\n![Alt text](image-3.png)\n3.2 当节点上服务作为客户端时：\n![Alt text](image-4.png)\n4. Application - DNS Monitoring\n该dashbord主要展示了dns协议请求信息，包括请求总数，客户端错误率，客户端错误数量，服务端错误率，服务段错误数量，DNS Topo，请求时延等等信息，可用于分析DNS解析相关错误。\n\n4.1 Total Request、DNS Topo、Delay Distribution、Error\n![Alt text](image-5.png)\n这部分面板展示了DNS请求总数，客户端及服务端错误数量和错误率，DNS亲求拓扑，在Client Error(by client)面板中展示了客户端错误数量列表。\n4.2 Server Error Ratio、Time Out、Delay\n![Alt text](image-6.png)\n这部分面板展示了DNS服务端错误百分比，服务端超时数量及按客户端统计列表；服务端时延，客户端时延等信息。\n4.3 Request、Log Analysis、Request log Delay Distribution、Request Log\n![Alt text](image-7.png)\n● Request: 展示DNS服务请求速率、客户端请求数量和所占百分比。\n● Log Analysis: 展示请求日志数量列表，可按服务端、客户端、成功或错误进行筛选。如图展示了失败的DNS请求客户端和请求域名列表及对应数量，通过Request Log（by response desc）可以看出错误都是Non-Existent Domain。通过Request Log Delay Distribution可看出请求日志时延。Reqeust Log展示例如请求日志列表。\n5. Dubbo Monitoring - K8S\n![Alt text](image-8.png)\n\nDubbo微服务监控。展示请求总数，服务连接，时延、错误、请求日志分析等内容。\n6. Application - K8s Ingress\n![Alt text](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/MAeqxYPPLZoQO8j9/img/31b5dcc3-e80c-44df-b008-63f844c2fba3.png)\n\nIngress服务监控。展示请求、时延、错误、吞吐量等内容。\n7. Application - K8s Pod\n此dashboard展示了各个pod作为客户端和服务端发送请求的速率，错误率，时延等信息。\n![Alt text](image-10.png)\n我们以部署的测试服务deepflow-ebpf-spring-demo为例：\n● namespace: 筛选namespace为：deepflow-ebpf-spring-demo。\n● workload：筛选工作负载。\n● protocol：筛选网络协议。\n7.1 Request面板\n以redis-master-0 Redis为例，在此面板中可以看到名为redis-master-0的pod，网络协议Redis的最小请求速率（Min）为0.667 req/s, 平均请求速率（Mean）为1.26 req/s，最大请求速率1.33 req/s。\n7.2 Server error面板\n展示了各pod指定网络协议的服务端错误百分比。\n7.3 Latency面板\n展示了各pod指定协议时延信息。\n7.4 Pod List面板\n指定pod,指定协议的请求速率，客户端错误百分比，服务端错误百分比，平均时延列表。\n8. Application - K8s Pod Map\n此dashboard展示了pod请求map,请求速率，服务段错误百分比，客户端错误百分比，时延等信息。\n我们以部署的测试服务deepflow-ebpf-spring-demo为例：\n● namespace: 筛选namespace为：deepflow-ebpf-spring-demo。\n● workload：筛选工作负载。\n● protocol：筛选网络协议。\n8.1 Show client\n![Alt text](image-11.png)\n此时展示指定namespace中所有pod作为服务端时，相关client和server相关请求信息，包括请求速率，服务端错误率，请求时延。\n8.2 Show server\n![Alt text](image-12.png)\n此时展示指定namespace中所有pod作为客户端时，相关client和server相关请求信息，包括请求速率，服务端错误率，请求时延。\n9. Application - Redis Monitoring - Cloud\n此dashboard展示了集群redis的监控数据。包括同请求数量，客户端、服务端错误数量错误百分比，吞吐量，时延，服务拓扑、请求速率，客户端请求量列表、请求日志分析，TOP N 执行的redis命令等。\n![Alt text](image-13.png)\n● Cloud Host: 按节点筛选redis服务\n● IP: 按IP筛选redis服务\n10. Application - Redis Monitoring - K8S\n此dashboard展示了集群redis的监控数据。包括同请求数量，客户端、服务端错误数量错误百分比，吞吐量，时延，服务拓扑、请求速率，客户端请求量列表、请求日志分析，TOP N 执行的redis命令等。\n![Alt text](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/MAeqxYPPLZoQO8j9/img/7a2ab804-36f5-4ef2-a9fc-dc4a477851c7.png)\n● cluster： 筛选指定集群\n● Redis Service: 筛选指定redis服务\n● redis willdCard：通配符匹配\n● Tap Side： 可选择不同的数据采集点，获取不同的指标，例如查看客户端网卡吞吐量，服务端网卡吞吐量等。\n1.  Application - Request Log\n此dashboard展示了请求日志相关数据。\n![Alt text](image-15.png)\n● 筛选条件：可根据cluster（集群名）、namespace（命名空间）、workload（工作负载名）、protocol（网络协议）、request_type（请求类型）、reqeust_resource（请求资源）、status（响应状态）进行数据筛选。\n● Summary count: 请求数量摘要。以一分钟区间统计请求数量。\n● Error Count: 请求错误数量。\n● Latency histogram: 请求时延直方图。\n● Request log: 请求日志，包括Start time(请求开始时间)，Client(客户端)、Server(服务端)、Tap Side(数据采集点)、Protocol(网络协议)、App Protocol(应用协议)、Request type(请求类型)、Request domain(请求域名)、Request resource(请求资源)、Response Status(响应状态)、Response Code(响应码)、Response Delay(响应时延)。\n1.  Application - Request Log - Cloud\n\n![Alt text](image-16.png)\n此dashborad也是展示请求日志，与Application - Request Log展示内容相同，筛选条件不同：\n● vm: 根据节点筛选\n● protocol: 根据网络协议筛选\n● request_type: 根据请求类型筛选\n● reqeust_resource：根据请求资源筛选\n● status：根据响应状态筛选\n13. Application - SQL Monitoring - Cloud\n![Alt text](image-18.png)\n此dashboar展示了mysql相关数据库监控信息。\n● 筛选条件：可根据client(客户端)、DB Host(数据库所在节点)、DB IP(数据库IP)、Client For SQL Analysis（需要SQL分析的客户端匹配.\n● 展示内容：请求总数、客户端列表、topo概览、客户端服务端错误百分比及错误数及列表、连接数、平均活跃连接数、时延、时延客户端列表、SQL执行分析（SQL Statement、Request Type、响应状态、时延、AffectedRows、执行数量）、吞吐量、分布式追踪、SQL语句时延列表。\n14. Application - SQL Monitoring - K8S\n![Alt text](image-19.png)\n此dashboar也是展示了mysql相关数据库监控信息。展示数据内容与SQL Monitoring - Cloud相同，筛选角度不同：\n● client: 根据客户端筛选\n● DB Cluster: 根据数据库所在集群筛选\n● DB Service:  根据数据可服务筛选\n● DB Wildcard: 根据数据库通配符筛选\n● Tap Side: 根据数据采集点筛选\n● Client For SQL Analysis：根据需要SQL分析的客户端匹配筛选\n15. Distributed Tracing\n![Alt text](image-20.png)\n此dashboard展示了分布式调用追踪，可选择一个调用进行例如点击Request中的_id，就会显示其调用的Flame Graph(火焰图)。Service List展示了调用在各个Service所花费的时间和百分比。Request Log展示了请求体制数据，Related Data展示了相关数据。\n● N： 通过 BPF 从网络流量中提取的 Span\n● S:  通过 eBPF 从系统或应用函数调用中提取的 Span\nSpan 是分布式跟踪的基本构建块。分布式跟踪中的单个跟踪由一系列标记的时间间隔组成,称为跨度。跨度表示完成用户请求或事务的逻辑工作单元。在分布式链路跟踪中有两个重要的概念：跟踪（trace）和 跨度（ span）。trace 是请求在分布式系统中的整个链路视图，span 则代表整个链路中不同服务内部的视图，span 组合在一起就是整个 trace 的视图。\n16. Distributed Tracing - Cloud\n![Alt text](image-21.png)\n此dashboard也展示了分布式调用追踪，与Distributed Tracing展示内容相同，筛选条件不同：\n● vm: 根据节点筛选\n● trace_id： 根据tarceID进行筛选，traceID是一个唯一标识符，用于跟踪整个分布式系统中的请求。它可以帮助我们追踪请求在整个系统中所经过的所有服务和操作，并且可以帮助我们在出现问题时快速定位问题。\n● span_id：根据SpanID进行筛选，traceid 在请求的整个调用链中始终保持不变，所以在日志中可以通过 traceid 查询到整个请求期间系统记录下来的所有日志。请求到达每个服务后，服务都会为请求生成spanid，而随请求一起从上游传过来的上游服务的 spanid 会被记录成parent-spanid或者叫 pspanid。当前服务生成的 spanid 随着请求一起再传到下游服务时，这个spanid 又会被下游服务当做 pspanid 记录。\n● request_resource：请求资源。\n17. Network - Cloud Host\n![Alt text](image-22.png)\n此dashboard展示了各节点网络性能指标。可根据Vm(节点)进行筛选。\n● Throught(bps): 展示了节点吞吐量，包括最小值、平均值、最大值。\n● Retrans rate: 展示包重传率，包括最小值、平均值、最大值。\n● TCP conn. establishment fail rate: TCP连接建立失败率，包括最小值、平均值、最大值。\n● TCP conn. establishment latency：TCP连接建立延迟指的是从客户端向服务器发起TCP连接请求，到服务器成功响应这个请求并建立起TCP连接所需的时间。这个延迟时间通常由网络延迟、服务器处理能力和其他因素决定。在高性能网络和服务器环境中，TCP连接建立延迟应该尽可能低。如果延迟时间过长，可能会导致用户体验不佳或者网络应用程序性能下降。\n● Cloud Host List：展示节点网络性能详情列表。\nchost\nThroughput(bps)\nThroughput(pps)\nTCP new conn.\nTCP retrans rate\nTCP conn. establishment fail rate\nTCP conn. establishment latency\nTCP/UDP data latency\n节点名\n是吞吐量的单位，表示每秒传输的比特数（bits per second）\n是网络吞吐量的一种单位，表示每秒发送的分组数据包数量\nTCP新建连接数\n包重传率\nTCP连接建立失败率\nTCP连接建立延迟\nTCP或UDP协议下数据传输的延迟时间。\nTCP/UDP data latency指的是TCP或UDP协议下数据传输的延迟时间。这是从数据发送端到接收端的时间，包括在网络中传输以及在发送和接收端的处理时间。这个延迟可能会受到网络拥堵、硬件性能、协议效率等因素的影响。一般来说，低延迟的通信对于实时性要求高的应用非常重要。\n18. Network - Cloud Host Map\n此dashboard展示了各节点，网络性能拓扑图。可根据VM(节点)，进行筛选。\n18.1 Show Client\n![](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/MAeqxYPPLZoQO8j9/img/f5dfef4b-f7e9-4182-86b4-7dcd565b362c.png)\n展示了指定节点作为服务短时，网络性能指标，通过拓扑图可以点至查看指定客户端服务端之间的数据传输速率。\n在Cloud Host Path列表中展示的数据与Network - Cloud Host相比多了以下数据：\n● CLient: 客户端名。\n● Server: 服务端。\n● Tap side: 数据采样点。\n● Protocol: 网络协议。\n● Server port: 服务端口。\n18.2 Show Server\n![](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/MAeqxYPPLZoQO8j9/img/8fa5d9e2-859d-42c7-9d3d-a1e1edabcb96.png)\n与show client展示内容相同，角度不同，此时展示当指定节点作为客户端时相关网络性能指标。\n19.  Network - Flow Log\n![Alt text](image-25.png)\n此dashboard展示了网络流日志内容。\n可根据cluster(集群)、namespace(命名空间)、workload(工作负载)进行筛选。\n● Summary count: 日志总量摘要。\n● Error count: 错误数量。\n● TCP est.conn latency distribution：连接建立（establishment）延迟时间分布。\n● TCP data latency distribution： 指的是在TCP协议下，数据传输延迟时间分布。\n● Flow log：网络流日志列表，内容包括 start time(开始时间)、client(客户端)、server(服务端)、tap side(数据才采集点)、protocol(网络协议)、client port(客户端端口)、server port(服务端端口)、status(状态，由 close_type（流结束类型）与 protocol（协议）决定：正常结束/周期性上报/非TCP超时=正常，客户端XX=客户端异常，服务端XX/TCP超时=服务端异常，其他结束方式=未知。)、Byte TX(发送字节数)、Byte RX(接收字节数)、TCP Client Retransmission(TCP客户端重传)、TCP Server Retransmission(TCP服务端重传)、Avg TCP Est. Delay(连接建立平均时延)、Avg Data Delay（数据传输平均时延）。\n20. Network - Flow Log - Cloud\n![Alt text](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/MAeqxYPPLZoQO8j9/img/cbf20764-c8a8-48b3-a0c2-a023923ef515.png)\n此dashboard展示的网络流日志内容与Flow Log相同，区别是筛选条件不同，此dashboard提供根据VM(节点)进行筛选，查看各节点上工作流日志。\n21. Network - K8s Pod\n![](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/MAeqxYPPLZoQO8j9/img/334e9637-7366-4397-a79c-c61ec162c7f3.png)\n此dashboard展示了pod的网络性能相关指标，可根据cluster、namespace、workload进行筛选。\n● Throught(bps): 展示了pod网络吞吐量，包括最小值、平均值、最大值。\n● Retrans rate: 展示pod包重传率，包括最小值、平均值、最大值。\n● TCP conn. establishment fail rate: TCP连接建立失败率，包括最小值、平均值、最大值。\n● TCP conn. establishment latency：TCP连接建立延迟。\n● Pod List： pod网络性能列表。\n22.  Network - K8s Pod Map\n![](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/MAeqxYPPLZoQO8j9/img/85fd8ca0-bea9-43e3-8a12-1a9b82cac676.png)\n网络性能全景图，点击路径可查看相关指标，包括bps、retrans_ratio(TCP 重传比例：TCP 重传比例，通过TCP 重传 / 所有的包计算得，即 retrans / packet)、tcp_establish_fail_ratio（建连-失败比例：建连-失败比例，通过 TCP 建连-失败次数 / 所有的关闭连接计算得，即 tcp_establish_fail / close_flow）、rtt(平均 TCP 建连时延,统计周期内，所有 TCP 建连时延的平均值)、art(平均数据时延:统计周期内，所有数据时延的平均值，数据时延包含 TCP/UDP)等。","source":"_posts/kubernetes/deepflow-dashboard.md","raw":"---\ntitle: deepflow dashboard\ndate: 2023-10-18 16:54:51\ncategories:\n  - [kubernetes]\ntags: deepflow\n---\n1. Application-Service List\n此dashboard包含两个部分，分别是Service List和EndPoint List。展示了服务时延，请求速率，成功率等信息。\n1.2 Service List\n![Alt text](image.png)\n● Data Source： 数据源为DeepFlow\n● auto_service： 筛选指定的service\n● app_service:  筛选app_service\n● signal_source: 筛选信号源\nAuto Service\nApp Service\nSignal Source\nRequest Rate\nDelay Avg\nDelay P75\nClient Error Ratio\nServer Error Ratio\n对应k8s中service name\n\n分为三种类型信号源：\nPacket (cBPF)、eBPF、OTel来自不同信号源数据有细微差距。\n请求速率 \n平均时延\n75%的请求时延时间段\n客户端异常比例，通过客户端异常 / 响应计算得，即 client_error / response\n服务端异常比例，通过服务端异常 / 响应计算得，即 server_error / response\n1.3 Endpoint List\n![Alt text](image-1.png)\n服务端点时延信息。\n2. Application - Cloud Host\n此dashboard主要以kubernetes节点的角度展示了请求成功率时延等信息。\n![Alt text](image-2.png)\n● vm: 筛选指定节点\n● protocol: 筛选指定协议\nchost\nProtocol\nRequest\nClient error\nServer error\nLatency\n云节点名\n网络协议类型\n请求速率\n客户端错误百分比\n服务端错误百分比\n平均时延\n3. Application - Cloud Host Map\n此dashboard主要通过Map展示，当节点作为server，和当节点作为client两种角色情况下，请求时延，请求速率，客户端错误百分比，服务端百分比等信息。\n3.1 当节点上服务作为服务端时：\n![Alt text](image-3.png)\n3.2 当节点上服务作为客户端时：\n![Alt text](image-4.png)\n4. Application - DNS Monitoring\n该dashbord主要展示了dns协议请求信息，包括请求总数，客户端错误率，客户端错误数量，服务端错误率，服务段错误数量，DNS Topo，请求时延等等信息，可用于分析DNS解析相关错误。\n\n4.1 Total Request、DNS Topo、Delay Distribution、Error\n![Alt text](image-5.png)\n这部分面板展示了DNS请求总数，客户端及服务端错误数量和错误率，DNS亲求拓扑，在Client Error(by client)面板中展示了客户端错误数量列表。\n4.2 Server Error Ratio、Time Out、Delay\n![Alt text](image-6.png)\n这部分面板展示了DNS服务端错误百分比，服务端超时数量及按客户端统计列表；服务端时延，客户端时延等信息。\n4.3 Request、Log Analysis、Request log Delay Distribution、Request Log\n![Alt text](image-7.png)\n● Request: 展示DNS服务请求速率、客户端请求数量和所占百分比。\n● Log Analysis: 展示请求日志数量列表，可按服务端、客户端、成功或错误进行筛选。如图展示了失败的DNS请求客户端和请求域名列表及对应数量，通过Request Log（by response desc）可以看出错误都是Non-Existent Domain。通过Request Log Delay Distribution可看出请求日志时延。Reqeust Log展示例如请求日志列表。\n5. Dubbo Monitoring - K8S\n![Alt text](image-8.png)\n\nDubbo微服务监控。展示请求总数，服务连接，时延、错误、请求日志分析等内容。\n6. Application - K8s Ingress\n![Alt text](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/MAeqxYPPLZoQO8j9/img/31b5dcc3-e80c-44df-b008-63f844c2fba3.png)\n\nIngress服务监控。展示请求、时延、错误、吞吐量等内容。\n7. Application - K8s Pod\n此dashboard展示了各个pod作为客户端和服务端发送请求的速率，错误率，时延等信息。\n![Alt text](image-10.png)\n我们以部署的测试服务deepflow-ebpf-spring-demo为例：\n● namespace: 筛选namespace为：deepflow-ebpf-spring-demo。\n● workload：筛选工作负载。\n● protocol：筛选网络协议。\n7.1 Request面板\n以redis-master-0 Redis为例，在此面板中可以看到名为redis-master-0的pod，网络协议Redis的最小请求速率（Min）为0.667 req/s, 平均请求速率（Mean）为1.26 req/s，最大请求速率1.33 req/s。\n7.2 Server error面板\n展示了各pod指定网络协议的服务端错误百分比。\n7.3 Latency面板\n展示了各pod指定协议时延信息。\n7.4 Pod List面板\n指定pod,指定协议的请求速率，客户端错误百分比，服务端错误百分比，平均时延列表。\n8. Application - K8s Pod Map\n此dashboard展示了pod请求map,请求速率，服务段错误百分比，客户端错误百分比，时延等信息。\n我们以部署的测试服务deepflow-ebpf-spring-demo为例：\n● namespace: 筛选namespace为：deepflow-ebpf-spring-demo。\n● workload：筛选工作负载。\n● protocol：筛选网络协议。\n8.1 Show client\n![Alt text](image-11.png)\n此时展示指定namespace中所有pod作为服务端时，相关client和server相关请求信息，包括请求速率，服务端错误率，请求时延。\n8.2 Show server\n![Alt text](image-12.png)\n此时展示指定namespace中所有pod作为客户端时，相关client和server相关请求信息，包括请求速率，服务端错误率，请求时延。\n9. Application - Redis Monitoring - Cloud\n此dashboard展示了集群redis的监控数据。包括同请求数量，客户端、服务端错误数量错误百分比，吞吐量，时延，服务拓扑、请求速率，客户端请求量列表、请求日志分析，TOP N 执行的redis命令等。\n![Alt text](image-13.png)\n● Cloud Host: 按节点筛选redis服务\n● IP: 按IP筛选redis服务\n10. Application - Redis Monitoring - K8S\n此dashboard展示了集群redis的监控数据。包括同请求数量，客户端、服务端错误数量错误百分比，吞吐量，时延，服务拓扑、请求速率，客户端请求量列表、请求日志分析，TOP N 执行的redis命令等。\n![Alt text](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/MAeqxYPPLZoQO8j9/img/7a2ab804-36f5-4ef2-a9fc-dc4a477851c7.png)\n● cluster： 筛选指定集群\n● Redis Service: 筛选指定redis服务\n● redis willdCard：通配符匹配\n● Tap Side： 可选择不同的数据采集点，获取不同的指标，例如查看客户端网卡吞吐量，服务端网卡吞吐量等。\n1.  Application - Request Log\n此dashboard展示了请求日志相关数据。\n![Alt text](image-15.png)\n● 筛选条件：可根据cluster（集群名）、namespace（命名空间）、workload（工作负载名）、protocol（网络协议）、request_type（请求类型）、reqeust_resource（请求资源）、status（响应状态）进行数据筛选。\n● Summary count: 请求数量摘要。以一分钟区间统计请求数量。\n● Error Count: 请求错误数量。\n● Latency histogram: 请求时延直方图。\n● Request log: 请求日志，包括Start time(请求开始时间)，Client(客户端)、Server(服务端)、Tap Side(数据采集点)、Protocol(网络协议)、App Protocol(应用协议)、Request type(请求类型)、Request domain(请求域名)、Request resource(请求资源)、Response Status(响应状态)、Response Code(响应码)、Response Delay(响应时延)。\n1.  Application - Request Log - Cloud\n\n![Alt text](image-16.png)\n此dashborad也是展示请求日志，与Application - Request Log展示内容相同，筛选条件不同：\n● vm: 根据节点筛选\n● protocol: 根据网络协议筛选\n● request_type: 根据请求类型筛选\n● reqeust_resource：根据请求资源筛选\n● status：根据响应状态筛选\n13. Application - SQL Monitoring - Cloud\n![Alt text](image-18.png)\n此dashboar展示了mysql相关数据库监控信息。\n● 筛选条件：可根据client(客户端)、DB Host(数据库所在节点)、DB IP(数据库IP)、Client For SQL Analysis（需要SQL分析的客户端匹配.\n● 展示内容：请求总数、客户端列表、topo概览、客户端服务端错误百分比及错误数及列表、连接数、平均活跃连接数、时延、时延客户端列表、SQL执行分析（SQL Statement、Request Type、响应状态、时延、AffectedRows、执行数量）、吞吐量、分布式追踪、SQL语句时延列表。\n14. Application - SQL Monitoring - K8S\n![Alt text](image-19.png)\n此dashboar也是展示了mysql相关数据库监控信息。展示数据内容与SQL Monitoring - Cloud相同，筛选角度不同：\n● client: 根据客户端筛选\n● DB Cluster: 根据数据库所在集群筛选\n● DB Service:  根据数据可服务筛选\n● DB Wildcard: 根据数据库通配符筛选\n● Tap Side: 根据数据采集点筛选\n● Client For SQL Analysis：根据需要SQL分析的客户端匹配筛选\n15. Distributed Tracing\n![Alt text](image-20.png)\n此dashboard展示了分布式调用追踪，可选择一个调用进行例如点击Request中的_id，就会显示其调用的Flame Graph(火焰图)。Service List展示了调用在各个Service所花费的时间和百分比。Request Log展示了请求体制数据，Related Data展示了相关数据。\n● N： 通过 BPF 从网络流量中提取的 Span\n● S:  通过 eBPF 从系统或应用函数调用中提取的 Span\nSpan 是分布式跟踪的基本构建块。分布式跟踪中的单个跟踪由一系列标记的时间间隔组成,称为跨度。跨度表示完成用户请求或事务的逻辑工作单元。在分布式链路跟踪中有两个重要的概念：跟踪（trace）和 跨度（ span）。trace 是请求在分布式系统中的整个链路视图，span 则代表整个链路中不同服务内部的视图，span 组合在一起就是整个 trace 的视图。\n16. Distributed Tracing - Cloud\n![Alt text](image-21.png)\n此dashboard也展示了分布式调用追踪，与Distributed Tracing展示内容相同，筛选条件不同：\n● vm: 根据节点筛选\n● trace_id： 根据tarceID进行筛选，traceID是一个唯一标识符，用于跟踪整个分布式系统中的请求。它可以帮助我们追踪请求在整个系统中所经过的所有服务和操作，并且可以帮助我们在出现问题时快速定位问题。\n● span_id：根据SpanID进行筛选，traceid 在请求的整个调用链中始终保持不变，所以在日志中可以通过 traceid 查询到整个请求期间系统记录下来的所有日志。请求到达每个服务后，服务都会为请求生成spanid，而随请求一起从上游传过来的上游服务的 spanid 会被记录成parent-spanid或者叫 pspanid。当前服务生成的 spanid 随着请求一起再传到下游服务时，这个spanid 又会被下游服务当做 pspanid 记录。\n● request_resource：请求资源。\n17. Network - Cloud Host\n![Alt text](image-22.png)\n此dashboard展示了各节点网络性能指标。可根据Vm(节点)进行筛选。\n● Throught(bps): 展示了节点吞吐量，包括最小值、平均值、最大值。\n● Retrans rate: 展示包重传率，包括最小值、平均值、最大值。\n● TCP conn. establishment fail rate: TCP连接建立失败率，包括最小值、平均值、最大值。\n● TCP conn. establishment latency：TCP连接建立延迟指的是从客户端向服务器发起TCP连接请求，到服务器成功响应这个请求并建立起TCP连接所需的时间。这个延迟时间通常由网络延迟、服务器处理能力和其他因素决定。在高性能网络和服务器环境中，TCP连接建立延迟应该尽可能低。如果延迟时间过长，可能会导致用户体验不佳或者网络应用程序性能下降。\n● Cloud Host List：展示节点网络性能详情列表。\nchost\nThroughput(bps)\nThroughput(pps)\nTCP new conn.\nTCP retrans rate\nTCP conn. establishment fail rate\nTCP conn. establishment latency\nTCP/UDP data latency\n节点名\n是吞吐量的单位，表示每秒传输的比特数（bits per second）\n是网络吞吐量的一种单位，表示每秒发送的分组数据包数量\nTCP新建连接数\n包重传率\nTCP连接建立失败率\nTCP连接建立延迟\nTCP或UDP协议下数据传输的延迟时间。\nTCP/UDP data latency指的是TCP或UDP协议下数据传输的延迟时间。这是从数据发送端到接收端的时间，包括在网络中传输以及在发送和接收端的处理时间。这个延迟可能会受到网络拥堵、硬件性能、协议效率等因素的影响。一般来说，低延迟的通信对于实时性要求高的应用非常重要。\n18. Network - Cloud Host Map\n此dashboard展示了各节点，网络性能拓扑图。可根据VM(节点)，进行筛选。\n18.1 Show Client\n![](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/MAeqxYPPLZoQO8j9/img/f5dfef4b-f7e9-4182-86b4-7dcd565b362c.png)\n展示了指定节点作为服务短时，网络性能指标，通过拓扑图可以点至查看指定客户端服务端之间的数据传输速率。\n在Cloud Host Path列表中展示的数据与Network - Cloud Host相比多了以下数据：\n● CLient: 客户端名。\n● Server: 服务端。\n● Tap side: 数据采样点。\n● Protocol: 网络协议。\n● Server port: 服务端口。\n18.2 Show Server\n![](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/MAeqxYPPLZoQO8j9/img/8fa5d9e2-859d-42c7-9d3d-a1e1edabcb96.png)\n与show client展示内容相同，角度不同，此时展示当指定节点作为客户端时相关网络性能指标。\n19.  Network - Flow Log\n![Alt text](image-25.png)\n此dashboard展示了网络流日志内容。\n可根据cluster(集群)、namespace(命名空间)、workload(工作负载)进行筛选。\n● Summary count: 日志总量摘要。\n● Error count: 错误数量。\n● TCP est.conn latency distribution：连接建立（establishment）延迟时间分布。\n● TCP data latency distribution： 指的是在TCP协议下，数据传输延迟时间分布。\n● Flow log：网络流日志列表，内容包括 start time(开始时间)、client(客户端)、server(服务端)、tap side(数据才采集点)、protocol(网络协议)、client port(客户端端口)、server port(服务端端口)、status(状态，由 close_type（流结束类型）与 protocol（协议）决定：正常结束/周期性上报/非TCP超时=正常，客户端XX=客户端异常，服务端XX/TCP超时=服务端异常，其他结束方式=未知。)、Byte TX(发送字节数)、Byte RX(接收字节数)、TCP Client Retransmission(TCP客户端重传)、TCP Server Retransmission(TCP服务端重传)、Avg TCP Est. Delay(连接建立平均时延)、Avg Data Delay（数据传输平均时延）。\n20. Network - Flow Log - Cloud\n![Alt text](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/MAeqxYPPLZoQO8j9/img/cbf20764-c8a8-48b3-a0c2-a023923ef515.png)\n此dashboard展示的网络流日志内容与Flow Log相同，区别是筛选条件不同，此dashboard提供根据VM(节点)进行筛选，查看各节点上工作流日志。\n21. Network - K8s Pod\n![](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/MAeqxYPPLZoQO8j9/img/334e9637-7366-4397-a79c-c61ec162c7f3.png)\n此dashboard展示了pod的网络性能相关指标，可根据cluster、namespace、workload进行筛选。\n● Throught(bps): 展示了pod网络吞吐量，包括最小值、平均值、最大值。\n● Retrans rate: 展示pod包重传率，包括最小值、平均值、最大值。\n● TCP conn. establishment fail rate: TCP连接建立失败率，包括最小值、平均值、最大值。\n● TCP conn. establishment latency：TCP连接建立延迟。\n● Pod List： pod网络性能列表。\n22.  Network - K8s Pod Map\n![](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/MAeqxYPPLZoQO8j9/img/85fd8ca0-bea9-43e3-8a12-1a9b82cac676.png)\n网络性能全景图，点击路径可查看相关指标，包括bps、retrans_ratio(TCP 重传比例：TCP 重传比例，通过TCP 重传 / 所有的包计算得，即 retrans / packet)、tcp_establish_fail_ratio（建连-失败比例：建连-失败比例，通过 TCP 建连-失败次数 / 所有的关闭连接计算得，即 tcp_establish_fail / close_flow）、rtt(平均 TCP 建连时延,统计周期内，所有 TCP 建连时延的平均值)、art(平均数据时延:统计周期内，所有数据时延的平均值，数据时延包含 TCP/UDP)等。","slug":"kubernetes/deepflow-dashboard","published":1,"updated":"2023-10-18T09:18:27.736Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clo89v5ed000gb7jx1z7x2s6d","content":"<ol>\n<li>Application-Service List<br>此dashboard包含两个部分，分别是Service List和EndPoint List。展示了服务时延，请求速率，成功率等信息。<br>1.2 Service List<br><img src=\"/image.png\" alt=\"Alt text\"><br>● Data Source： 数据源为DeepFlow<br>● auto_service： 筛选指定的service<br>● app_service:  筛选app_service<br>● signal_source: 筛选信号源<br>Auto Service<br>App Service<br>Signal Source<br>Request Rate<br>Delay Avg<br>Delay P75<br>Client Error Ratio<br>Server Error Ratio<br>对应k8s中service name</li>\n</ol>\n<p>分为三种类型信号源：<br>Packet (cBPF)、eBPF、OTel来自不同信号源数据有细微差距。<br>请求速率<br>平均时延<br>75%的请求时延时间段<br>客户端异常比例，通过客户端异常 &#x2F; 响应计算得，即 client_error &#x2F; response<br>服务端异常比例，通过服务端异常 &#x2F; 响应计算得，即 server_error &#x2F; response<br>1.3 Endpoint List<br><img src=\"/image-1.png\" alt=\"Alt text\"><br>服务端点时延信息。<br>2. Application - Cloud Host<br>此dashboard主要以kubernetes节点的角度展示了请求成功率时延等信息。<br><img src=\"/image-2.png\" alt=\"Alt text\"><br>● vm: 筛选指定节点<br>● protocol: 筛选指定协议<br>chost<br>Protocol<br>Request<br>Client error<br>Server error<br>Latency<br>云节点名<br>网络协议类型<br>请求速率<br>客户端错误百分比<br>服务端错误百分比<br>平均时延<br>3. Application - Cloud Host Map<br>此dashboard主要通过Map展示，当节点作为server，和当节点作为client两种角色情况下，请求时延，请求速率，客户端错误百分比，服务端百分比等信息。<br>3.1 当节点上服务作为服务端时：<br><img src=\"/image-3.png\" alt=\"Alt text\"><br>3.2 当节点上服务作为客户端时：<br><img src=\"/image-4.png\" alt=\"Alt text\"><br>4. Application - DNS Monitoring<br>该dashbord主要展示了dns协议请求信息，包括请求总数，客户端错误率，客户端错误数量，服务端错误率，服务段错误数量，DNS Topo，请求时延等等信息，可用于分析DNS解析相关错误。</p>\n<p>4.1 Total Request、DNS Topo、Delay Distribution、Error<br><img src=\"/image-5.png\" alt=\"Alt text\"><br>这部分面板展示了DNS请求总数，客户端及服务端错误数量和错误率，DNS亲求拓扑，在Client Error(by client)面板中展示了客户端错误数量列表。<br>4.2 Server Error Ratio、Time Out、Delay<br><img src=\"/image-6.png\" alt=\"Alt text\"><br>这部分面板展示了DNS服务端错误百分比，服务端超时数量及按客户端统计列表；服务端时延，客户端时延等信息。<br>4.3 Request、Log Analysis、Request log Delay Distribution、Request Log<br><img src=\"/image-7.png\" alt=\"Alt text\"><br>● Request: 展示DNS服务请求速率、客户端请求数量和所占百分比。<br>● Log Analysis: 展示请求日志数量列表，可按服务端、客户端、成功或错误进行筛选。如图展示了失败的DNS请求客户端和请求域名列表及对应数量，通过Request Log（by response desc）可以看出错误都是Non-Existent Domain。通过Request Log Delay Distribution可看出请求日志时延。Reqeust Log展示例如请求日志列表。<br>5. Dubbo Monitoring - K8S<br><img src=\"/image-8.png\" alt=\"Alt text\"></p>\n<p>Dubbo微服务监控。展示请求总数，服务连接，时延、错误、请求日志分析等内容。<br>6. Application - K8s Ingress<br><img src=\"https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/MAeqxYPPLZoQO8j9/img/31b5dcc3-e80c-44df-b008-63f844c2fba3.png\" alt=\"Alt text\"></p>\n<p>Ingress服务监控。展示请求、时延、错误、吞吐量等内容。<br>7. Application - K8s Pod<br>此dashboard展示了各个pod作为客户端和服务端发送请求的速率，错误率，时延等信息。<br><img src=\"/image-10.png\" alt=\"Alt text\"><br>我们以部署的测试服务deepflow-ebpf-spring-demo为例：<br>● namespace: 筛选namespace为：deepflow-ebpf-spring-demo。<br>● workload：筛选工作负载。<br>● protocol：筛选网络协议。<br>7.1 Request面板<br>以redis-master-0 Redis为例，在此面板中可以看到名为redis-master-0的pod，网络协议Redis的最小请求速率（Min）为0.667 req&#x2F;s, 平均请求速率（Mean）为1.26 req&#x2F;s，最大请求速率1.33 req&#x2F;s。<br>7.2 Server error面板<br>展示了各pod指定网络协议的服务端错误百分比。<br>7.3 Latency面板<br>展示了各pod指定协议时延信息。<br>7.4 Pod List面板<br>指定pod,指定协议的请求速率，客户端错误百分比，服务端错误百分比，平均时延列表。<br>8. Application - K8s Pod Map<br>此dashboard展示了pod请求map,请求速率，服务段错误百分比，客户端错误百分比，时延等信息。<br>我们以部署的测试服务deepflow-ebpf-spring-demo为例：<br>● namespace: 筛选namespace为：deepflow-ebpf-spring-demo。<br>● workload：筛选工作负载。<br>● protocol：筛选网络协议。<br>8.1 Show client<br><img src=\"/image-11.png\" alt=\"Alt text\"><br>此时展示指定namespace中所有pod作为服务端时，相关client和server相关请求信息，包括请求速率，服务端错误率，请求时延。<br>8.2 Show server<br><img src=\"/image-12.png\" alt=\"Alt text\"><br>此时展示指定namespace中所有pod作为客户端时，相关client和server相关请求信息，包括请求速率，服务端错误率，请求时延。<br>9. Application - Redis Monitoring - Cloud<br>此dashboard展示了集群redis的监控数据。包括同请求数量，客户端、服务端错误数量错误百分比，吞吐量，时延，服务拓扑、请求速率，客户端请求量列表、请求日志分析，TOP N 执行的redis命令等。<br><img src=\"/image-13.png\" alt=\"Alt text\"><br>● Cloud Host: 按节点筛选redis服务<br>● IP: 按IP筛选redis服务<br>10. Application - Redis Monitoring - K8S<br>此dashboard展示了集群redis的监控数据。包括同请求数量，客户端、服务端错误数量错误百分比，吞吐量，时延，服务拓扑、请求速率，客户端请求量列表、请求日志分析，TOP N 执行的redis命令等。<br><img src=\"https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/MAeqxYPPLZoQO8j9/img/7a2ab804-36f5-4ef2-a9fc-dc4a477851c7.png\" alt=\"Alt text\"><br>● cluster： 筛选指定集群<br>● Redis Service: 筛选指定redis服务<br>● redis willdCard：通配符匹配<br>● Tap Side： 可选择不同的数据采集点，获取不同的指标，例如查看客户端网卡吞吐量，服务端网卡吞吐量等。</p>\n<ol>\n<li>Application - Request Log<br>此dashboard展示了请求日志相关数据。<br><img src=\"/image-15.png\" alt=\"Alt text\"><br>● 筛选条件：可根据cluster（集群名）、namespace（命名空间）、workload（工作负载名）、protocol（网络协议）、request_type（请求类型）、reqeust_resource（请求资源）、status（响应状态）进行数据筛选。<br>● Summary count: 请求数量摘要。以一分钟区间统计请求数量。<br>● Error Count: 请求错误数量。<br>● Latency histogram: 请求时延直方图。<br>● Request log: 请求日志，包括Start time(请求开始时间)，Client(客户端)、Server(服务端)、Tap Side(数据采集点)、Protocol(网络协议)、App Protocol(应用协议)、Request type(请求类型)、Request domain(请求域名)、Request resource(请求资源)、Response Status(响应状态)、Response Code(响应码)、Response Delay(响应时延)。</li>\n<li>Application - Request Log - Cloud</li>\n</ol>\n<p><img src=\"/image-16.png\" alt=\"Alt text\"><br>此dashborad也是展示请求日志，与Application - Request Log展示内容相同，筛选条件不同：<br>● vm: 根据节点筛选<br>● protocol: 根据网络协议筛选<br>● request_type: 根据请求类型筛选<br>● reqeust_resource：根据请求资源筛选<br>● status：根据响应状态筛选<br>13. Application - SQL Monitoring - Cloud<br><img src=\"/image-18.png\" alt=\"Alt text\"><br>此dashboar展示了mysql相关数据库监控信息。<br>● 筛选条件：可根据client(客户端)、DB Host(数据库所在节点)、DB IP(数据库IP)、Client For SQL Analysis（需要SQL分析的客户端匹配.<br>● 展示内容：请求总数、客户端列表、topo概览、客户端服务端错误百分比及错误数及列表、连接数、平均活跃连接数、时延、时延客户端列表、SQL执行分析（SQL Statement、Request Type、响应状态、时延、AffectedRows、执行数量）、吞吐量、分布式追踪、SQL语句时延列表。<br>14. Application - SQL Monitoring - K8S<br><img src=\"/image-19.png\" alt=\"Alt text\"><br>此dashboar也是展示了mysql相关数据库监控信息。展示数据内容与SQL Monitoring - Cloud相同，筛选角度不同：<br>● client: 根据客户端筛选<br>● DB Cluster: 根据数据库所在集群筛选<br>● DB Service:  根据数据可服务筛选<br>● DB Wildcard: 根据数据库通配符筛选<br>● Tap Side: 根据数据采集点筛选<br>● Client For SQL Analysis：根据需要SQL分析的客户端匹配筛选<br>15. Distributed Tracing<br><img src=\"/image-20.png\" alt=\"Alt text\"><br>此dashboard展示了分布式调用追踪，可选择一个调用进行例如点击Request中的_id，就会显示其调用的Flame Graph(火焰图)。Service List展示了调用在各个Service所花费的时间和百分比。Request Log展示了请求体制数据，Related Data展示了相关数据。<br>● N： 通过 BPF 从网络流量中提取的 Span<br>● S:  通过 eBPF 从系统或应用函数调用中提取的 Span<br>Span 是分布式跟踪的基本构建块。分布式跟踪中的单个跟踪由一系列标记的时间间隔组成,称为跨度。跨度表示完成用户请求或事务的逻辑工作单元。在分布式链路跟踪中有两个重要的概念：跟踪（trace）和 跨度（ span）。trace 是请求在分布式系统中的整个链路视图，span 则代表整个链路中不同服务内部的视图，span 组合在一起就是整个 trace 的视图。<br>16. Distributed Tracing - Cloud<br><img src=\"/image-21.png\" alt=\"Alt text\"><br>此dashboard也展示了分布式调用追踪，与Distributed Tracing展示内容相同，筛选条件不同：<br>● vm: 根据节点筛选<br>● trace_id： 根据tarceID进行筛选，traceID是一个唯一标识符，用于跟踪整个分布式系统中的请求。它可以帮助我们追踪请求在整个系统中所经过的所有服务和操作，并且可以帮助我们在出现问题时快速定位问题。<br>● span_id：根据SpanID进行筛选，traceid 在请求的整个调用链中始终保持不变，所以在日志中可以通过 traceid 查询到整个请求期间系统记录下来的所有日志。请求到达每个服务后，服务都会为请求生成spanid，而随请求一起从上游传过来的上游服务的 spanid 会被记录成parent-spanid或者叫 pspanid。当前服务生成的 spanid 随着请求一起再传到下游服务时，这个spanid 又会被下游服务当做 pspanid 记录。<br>● request_resource：请求资源。<br>17. Network - Cloud Host<br><img src=\"/image-22.png\" alt=\"Alt text\"><br>此dashboard展示了各节点网络性能指标。可根据Vm(节点)进行筛选。<br>● Throught(bps): 展示了节点吞吐量，包括最小值、平均值、最大值。<br>● Retrans rate: 展示包重传率，包括最小值、平均值、最大值。<br>● TCP conn. establishment fail rate: TCP连接建立失败率，包括最小值、平均值、最大值。<br>● TCP conn. establishment latency：TCP连接建立延迟指的是从客户端向服务器发起TCP连接请求，到服务器成功响应这个请求并建立起TCP连接所需的时间。这个延迟时间通常由网络延迟、服务器处理能力和其他因素决定。在高性能网络和服务器环境中，TCP连接建立延迟应该尽可能低。如果延迟时间过长，可能会导致用户体验不佳或者网络应用程序性能下降。<br>● Cloud Host List：展示节点网络性能详情列表。<br>chost<br>Throughput(bps)<br>Throughput(pps)<br>TCP new conn.<br>TCP retrans rate<br>TCP conn. establishment fail rate<br>TCP conn. establishment latency<br>TCP&#x2F;UDP data latency<br>节点名<br>是吞吐量的单位，表示每秒传输的比特数（bits per second）<br>是网络吞吐量的一种单位，表示每秒发送的分组数据包数量<br>TCP新建连接数<br>包重传率<br>TCP连接建立失败率<br>TCP连接建立延迟<br>TCP或UDP协议下数据传输的延迟时间。<br>TCP&#x2F;UDP data latency指的是TCP或UDP协议下数据传输的延迟时间。这是从数据发送端到接收端的时间，包括在网络中传输以及在发送和接收端的处理时间。这个延迟可能会受到网络拥堵、硬件性能、协议效率等因素的影响。一般来说，低延迟的通信对于实时性要求高的应用非常重要。<br>18. Network - Cloud Host Map<br>此dashboard展示了各节点，网络性能拓扑图。可根据VM(节点)，进行筛选。<br>18.1 Show Client<br><img src=\"https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/MAeqxYPPLZoQO8j9/img/f5dfef4b-f7e9-4182-86b4-7dcd565b362c.png\"><br>展示了指定节点作为服务短时，网络性能指标，通过拓扑图可以点至查看指定客户端服务端之间的数据传输速率。<br>在Cloud Host Path列表中展示的数据与Network - Cloud Host相比多了以下数据：<br>● CLient: 客户端名。<br>● Server: 服务端。<br>● Tap side: 数据采样点。<br>● Protocol: 网络协议。<br>● Server port: 服务端口。<br>18.2 Show Server<br><img src=\"https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/MAeqxYPPLZoQO8j9/img/8fa5d9e2-859d-42c7-9d3d-a1e1edabcb96.png\"><br>与show client展示内容相同，角度不同，此时展示当指定节点作为客户端时相关网络性能指标。<br>19.  Network - Flow Log<br><img src=\"/image-25.png\" alt=\"Alt text\"><br>此dashboard展示了网络流日志内容。<br>可根据cluster(集群)、namespace(命名空间)、workload(工作负载)进行筛选。<br>● Summary count: 日志总量摘要。<br>● Error count: 错误数量。<br>● TCP est.conn latency distribution：连接建立（establishment）延迟时间分布。<br>● TCP data latency distribution： 指的是在TCP协议下，数据传输延迟时间分布。<br>● Flow log：网络流日志列表，内容包括 start time(开始时间)、client(客户端)、server(服务端)、tap side(数据才采集点)、protocol(网络协议)、client port(客户端端口)、server port(服务端端口)、status(状态，由 close_type（流结束类型）与 protocol（协议）决定：正常结束&#x2F;周期性上报&#x2F;非TCP超时&#x3D;正常，客户端XX&#x3D;客户端异常，服务端XX&#x2F;TCP超时&#x3D;服务端异常，其他结束方式&#x3D;未知。)、Byte TX(发送字节数)、Byte RX(接收字节数)、TCP Client Retransmission(TCP客户端重传)、TCP Server Retransmission(TCP服务端重传)、Avg TCP Est. Delay(连接建立平均时延)、Avg Data Delay（数据传输平均时延）。<br>20. Network - Flow Log - Cloud<br><img src=\"https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/MAeqxYPPLZoQO8j9/img/cbf20764-c8a8-48b3-a0c2-a023923ef515.png\" alt=\"Alt text\"><br>此dashboard展示的网络流日志内容与Flow Log相同，区别是筛选条件不同，此dashboard提供根据VM(节点)进行筛选，查看各节点上工作流日志。<br>21. Network - K8s Pod<br><img src=\"https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/MAeqxYPPLZoQO8j9/img/334e9637-7366-4397-a79c-c61ec162c7f3.png\"><br>此dashboard展示了pod的网络性能相关指标，可根据cluster、namespace、workload进行筛选。<br>● Throught(bps): 展示了pod网络吞吐量，包括最小值、平均值、最大值。<br>● Retrans rate: 展示pod包重传率，包括最小值、平均值、最大值。<br>● TCP conn. establishment fail rate: TCP连接建立失败率，包括最小值、平均值、最大值。<br>● TCP conn. establishment latency：TCP连接建立延迟。<br>● Pod List： pod网络性能列表。<br>22.  Network - K8s Pod Map<br><img src=\"https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/MAeqxYPPLZoQO8j9/img/85fd8ca0-bea9-43e3-8a12-1a9b82cac676.png\"><br>网络性能全景图，点击路径可查看相关指标，包括bps、retrans_ratio(TCP 重传比例：TCP 重传比例，通过TCP 重传 &#x2F; 所有的包计算得，即 retrans &#x2F; packet)、tcp_establish_fail_ratio（建连-失败比例：建连-失败比例，通过 TCP 建连-失败次数 &#x2F; 所有的关闭连接计算得，即 tcp_establish_fail &#x2F; close_flow）、rtt(平均 TCP 建连时延,统计周期内，所有 TCP 建连时延的平均值)、art(平均数据时延:统计周期内，所有数据时延的平均值，数据时延包含 TCP&#x2F;UDP)等。</p>\n","site":{"data":{"link":[{"class_name":"友情鏈接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、簡單且強大的網誌框架"}]},{"class_name":"網站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":false,"excerpt":"","more":"<ol>\n<li>Application-Service List<br>此dashboard包含两个部分，分别是Service List和EndPoint List。展示了服务时延，请求速率，成功率等信息。<br>1.2 Service List<br><img src=\"/image.png\" alt=\"Alt text\"><br>● Data Source： 数据源为DeepFlow<br>● auto_service： 筛选指定的service<br>● app_service:  筛选app_service<br>● signal_source: 筛选信号源<br>Auto Service<br>App Service<br>Signal Source<br>Request Rate<br>Delay Avg<br>Delay P75<br>Client Error Ratio<br>Server Error Ratio<br>对应k8s中service name</li>\n</ol>\n<p>分为三种类型信号源：<br>Packet (cBPF)、eBPF、OTel来自不同信号源数据有细微差距。<br>请求速率<br>平均时延<br>75%的请求时延时间段<br>客户端异常比例，通过客户端异常 &#x2F; 响应计算得，即 client_error &#x2F; response<br>服务端异常比例，通过服务端异常 &#x2F; 响应计算得，即 server_error &#x2F; response<br>1.3 Endpoint List<br><img src=\"/image-1.png\" alt=\"Alt text\"><br>服务端点时延信息。<br>2. Application - Cloud Host<br>此dashboard主要以kubernetes节点的角度展示了请求成功率时延等信息。<br><img src=\"/image-2.png\" alt=\"Alt text\"><br>● vm: 筛选指定节点<br>● protocol: 筛选指定协议<br>chost<br>Protocol<br>Request<br>Client error<br>Server error<br>Latency<br>云节点名<br>网络协议类型<br>请求速率<br>客户端错误百分比<br>服务端错误百分比<br>平均时延<br>3. Application - Cloud Host Map<br>此dashboard主要通过Map展示，当节点作为server，和当节点作为client两种角色情况下，请求时延，请求速率，客户端错误百分比，服务端百分比等信息。<br>3.1 当节点上服务作为服务端时：<br><img src=\"/image-3.png\" alt=\"Alt text\"><br>3.2 当节点上服务作为客户端时：<br><img src=\"/image-4.png\" alt=\"Alt text\"><br>4. Application - DNS Monitoring<br>该dashbord主要展示了dns协议请求信息，包括请求总数，客户端错误率，客户端错误数量，服务端错误率，服务段错误数量，DNS Topo，请求时延等等信息，可用于分析DNS解析相关错误。</p>\n<p>4.1 Total Request、DNS Topo、Delay Distribution、Error<br><img src=\"/image-5.png\" alt=\"Alt text\"><br>这部分面板展示了DNS请求总数，客户端及服务端错误数量和错误率，DNS亲求拓扑，在Client Error(by client)面板中展示了客户端错误数量列表。<br>4.2 Server Error Ratio、Time Out、Delay<br><img src=\"/image-6.png\" alt=\"Alt text\"><br>这部分面板展示了DNS服务端错误百分比，服务端超时数量及按客户端统计列表；服务端时延，客户端时延等信息。<br>4.3 Request、Log Analysis、Request log Delay Distribution、Request Log<br><img src=\"/image-7.png\" alt=\"Alt text\"><br>● Request: 展示DNS服务请求速率、客户端请求数量和所占百分比。<br>● Log Analysis: 展示请求日志数量列表，可按服务端、客户端、成功或错误进行筛选。如图展示了失败的DNS请求客户端和请求域名列表及对应数量，通过Request Log（by response desc）可以看出错误都是Non-Existent Domain。通过Request Log Delay Distribution可看出请求日志时延。Reqeust Log展示例如请求日志列表。<br>5. Dubbo Monitoring - K8S<br><img src=\"/image-8.png\" alt=\"Alt text\"></p>\n<p>Dubbo微服务监控。展示请求总数，服务连接，时延、错误、请求日志分析等内容。<br>6. Application - K8s Ingress<br><img src=\"https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/MAeqxYPPLZoQO8j9/img/31b5dcc3-e80c-44df-b008-63f844c2fba3.png\" alt=\"Alt text\"></p>\n<p>Ingress服务监控。展示请求、时延、错误、吞吐量等内容。<br>7. Application - K8s Pod<br>此dashboard展示了各个pod作为客户端和服务端发送请求的速率，错误率，时延等信息。<br><img src=\"/image-10.png\" alt=\"Alt text\"><br>我们以部署的测试服务deepflow-ebpf-spring-demo为例：<br>● namespace: 筛选namespace为：deepflow-ebpf-spring-demo。<br>● workload：筛选工作负载。<br>● protocol：筛选网络协议。<br>7.1 Request面板<br>以redis-master-0 Redis为例，在此面板中可以看到名为redis-master-0的pod，网络协议Redis的最小请求速率（Min）为0.667 req&#x2F;s, 平均请求速率（Mean）为1.26 req&#x2F;s，最大请求速率1.33 req&#x2F;s。<br>7.2 Server error面板<br>展示了各pod指定网络协议的服务端错误百分比。<br>7.3 Latency面板<br>展示了各pod指定协议时延信息。<br>7.4 Pod List面板<br>指定pod,指定协议的请求速率，客户端错误百分比，服务端错误百分比，平均时延列表。<br>8. Application - K8s Pod Map<br>此dashboard展示了pod请求map,请求速率，服务段错误百分比，客户端错误百分比，时延等信息。<br>我们以部署的测试服务deepflow-ebpf-spring-demo为例：<br>● namespace: 筛选namespace为：deepflow-ebpf-spring-demo。<br>● workload：筛选工作负载。<br>● protocol：筛选网络协议。<br>8.1 Show client<br><img src=\"/image-11.png\" alt=\"Alt text\"><br>此时展示指定namespace中所有pod作为服务端时，相关client和server相关请求信息，包括请求速率，服务端错误率，请求时延。<br>8.2 Show server<br><img src=\"/image-12.png\" alt=\"Alt text\"><br>此时展示指定namespace中所有pod作为客户端时，相关client和server相关请求信息，包括请求速率，服务端错误率，请求时延。<br>9. Application - Redis Monitoring - Cloud<br>此dashboard展示了集群redis的监控数据。包括同请求数量，客户端、服务端错误数量错误百分比，吞吐量，时延，服务拓扑、请求速率，客户端请求量列表、请求日志分析，TOP N 执行的redis命令等。<br><img src=\"/image-13.png\" alt=\"Alt text\"><br>● Cloud Host: 按节点筛选redis服务<br>● IP: 按IP筛选redis服务<br>10. Application - Redis Monitoring - K8S<br>此dashboard展示了集群redis的监控数据。包括同请求数量，客户端、服务端错误数量错误百分比，吞吐量，时延，服务拓扑、请求速率，客户端请求量列表、请求日志分析，TOP N 执行的redis命令等。<br><img src=\"https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/MAeqxYPPLZoQO8j9/img/7a2ab804-36f5-4ef2-a9fc-dc4a477851c7.png\" alt=\"Alt text\"><br>● cluster： 筛选指定集群<br>● Redis Service: 筛选指定redis服务<br>● redis willdCard：通配符匹配<br>● Tap Side： 可选择不同的数据采集点，获取不同的指标，例如查看客户端网卡吞吐量，服务端网卡吞吐量等。</p>\n<ol>\n<li>Application - Request Log<br>此dashboard展示了请求日志相关数据。<br><img src=\"/image-15.png\" alt=\"Alt text\"><br>● 筛选条件：可根据cluster（集群名）、namespace（命名空间）、workload（工作负载名）、protocol（网络协议）、request_type（请求类型）、reqeust_resource（请求资源）、status（响应状态）进行数据筛选。<br>● Summary count: 请求数量摘要。以一分钟区间统计请求数量。<br>● Error Count: 请求错误数量。<br>● Latency histogram: 请求时延直方图。<br>● Request log: 请求日志，包括Start time(请求开始时间)，Client(客户端)、Server(服务端)、Tap Side(数据采集点)、Protocol(网络协议)、App Protocol(应用协议)、Request type(请求类型)、Request domain(请求域名)、Request resource(请求资源)、Response Status(响应状态)、Response Code(响应码)、Response Delay(响应时延)。</li>\n<li>Application - Request Log - Cloud</li>\n</ol>\n<p><img src=\"/image-16.png\" alt=\"Alt text\"><br>此dashborad也是展示请求日志，与Application - Request Log展示内容相同，筛选条件不同：<br>● vm: 根据节点筛选<br>● protocol: 根据网络协议筛选<br>● request_type: 根据请求类型筛选<br>● reqeust_resource：根据请求资源筛选<br>● status：根据响应状态筛选<br>13. Application - SQL Monitoring - Cloud<br><img src=\"/image-18.png\" alt=\"Alt text\"><br>此dashboar展示了mysql相关数据库监控信息。<br>● 筛选条件：可根据client(客户端)、DB Host(数据库所在节点)、DB IP(数据库IP)、Client For SQL Analysis（需要SQL分析的客户端匹配.<br>● 展示内容：请求总数、客户端列表、topo概览、客户端服务端错误百分比及错误数及列表、连接数、平均活跃连接数、时延、时延客户端列表、SQL执行分析（SQL Statement、Request Type、响应状态、时延、AffectedRows、执行数量）、吞吐量、分布式追踪、SQL语句时延列表。<br>14. Application - SQL Monitoring - K8S<br><img src=\"/image-19.png\" alt=\"Alt text\"><br>此dashboar也是展示了mysql相关数据库监控信息。展示数据内容与SQL Monitoring - Cloud相同，筛选角度不同：<br>● client: 根据客户端筛选<br>● DB Cluster: 根据数据库所在集群筛选<br>● DB Service:  根据数据可服务筛选<br>● DB Wildcard: 根据数据库通配符筛选<br>● Tap Side: 根据数据采集点筛选<br>● Client For SQL Analysis：根据需要SQL分析的客户端匹配筛选<br>15. Distributed Tracing<br><img src=\"/image-20.png\" alt=\"Alt text\"><br>此dashboard展示了分布式调用追踪，可选择一个调用进行例如点击Request中的_id，就会显示其调用的Flame Graph(火焰图)。Service List展示了调用在各个Service所花费的时间和百分比。Request Log展示了请求体制数据，Related Data展示了相关数据。<br>● N： 通过 BPF 从网络流量中提取的 Span<br>● S:  通过 eBPF 从系统或应用函数调用中提取的 Span<br>Span 是分布式跟踪的基本构建块。分布式跟踪中的单个跟踪由一系列标记的时间间隔组成,称为跨度。跨度表示完成用户请求或事务的逻辑工作单元。在分布式链路跟踪中有两个重要的概念：跟踪（trace）和 跨度（ span）。trace 是请求在分布式系统中的整个链路视图，span 则代表整个链路中不同服务内部的视图，span 组合在一起就是整个 trace 的视图。<br>16. Distributed Tracing - Cloud<br><img src=\"/image-21.png\" alt=\"Alt text\"><br>此dashboard也展示了分布式调用追踪，与Distributed Tracing展示内容相同，筛选条件不同：<br>● vm: 根据节点筛选<br>● trace_id： 根据tarceID进行筛选，traceID是一个唯一标识符，用于跟踪整个分布式系统中的请求。它可以帮助我们追踪请求在整个系统中所经过的所有服务和操作，并且可以帮助我们在出现问题时快速定位问题。<br>● span_id：根据SpanID进行筛选，traceid 在请求的整个调用链中始终保持不变，所以在日志中可以通过 traceid 查询到整个请求期间系统记录下来的所有日志。请求到达每个服务后，服务都会为请求生成spanid，而随请求一起从上游传过来的上游服务的 spanid 会被记录成parent-spanid或者叫 pspanid。当前服务生成的 spanid 随着请求一起再传到下游服务时，这个spanid 又会被下游服务当做 pspanid 记录。<br>● request_resource：请求资源。<br>17. Network - Cloud Host<br><img src=\"/image-22.png\" alt=\"Alt text\"><br>此dashboard展示了各节点网络性能指标。可根据Vm(节点)进行筛选。<br>● Throught(bps): 展示了节点吞吐量，包括最小值、平均值、最大值。<br>● Retrans rate: 展示包重传率，包括最小值、平均值、最大值。<br>● TCP conn. establishment fail rate: TCP连接建立失败率，包括最小值、平均值、最大值。<br>● TCP conn. establishment latency：TCP连接建立延迟指的是从客户端向服务器发起TCP连接请求，到服务器成功响应这个请求并建立起TCP连接所需的时间。这个延迟时间通常由网络延迟、服务器处理能力和其他因素决定。在高性能网络和服务器环境中，TCP连接建立延迟应该尽可能低。如果延迟时间过长，可能会导致用户体验不佳或者网络应用程序性能下降。<br>● Cloud Host List：展示节点网络性能详情列表。<br>chost<br>Throughput(bps)<br>Throughput(pps)<br>TCP new conn.<br>TCP retrans rate<br>TCP conn. establishment fail rate<br>TCP conn. establishment latency<br>TCP&#x2F;UDP data latency<br>节点名<br>是吞吐量的单位，表示每秒传输的比特数（bits per second）<br>是网络吞吐量的一种单位，表示每秒发送的分组数据包数量<br>TCP新建连接数<br>包重传率<br>TCP连接建立失败率<br>TCP连接建立延迟<br>TCP或UDP协议下数据传输的延迟时间。<br>TCP&#x2F;UDP data latency指的是TCP或UDP协议下数据传输的延迟时间。这是从数据发送端到接收端的时间，包括在网络中传输以及在发送和接收端的处理时间。这个延迟可能会受到网络拥堵、硬件性能、协议效率等因素的影响。一般来说，低延迟的通信对于实时性要求高的应用非常重要。<br>18. Network - Cloud Host Map<br>此dashboard展示了各节点，网络性能拓扑图。可根据VM(节点)，进行筛选。<br>18.1 Show Client<br><img src=\"https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/MAeqxYPPLZoQO8j9/img/f5dfef4b-f7e9-4182-86b4-7dcd565b362c.png\"><br>展示了指定节点作为服务短时，网络性能指标，通过拓扑图可以点至查看指定客户端服务端之间的数据传输速率。<br>在Cloud Host Path列表中展示的数据与Network - Cloud Host相比多了以下数据：<br>● CLient: 客户端名。<br>● Server: 服务端。<br>● Tap side: 数据采样点。<br>● Protocol: 网络协议。<br>● Server port: 服务端口。<br>18.2 Show Server<br><img src=\"https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/MAeqxYPPLZoQO8j9/img/8fa5d9e2-859d-42c7-9d3d-a1e1edabcb96.png\"><br>与show client展示内容相同，角度不同，此时展示当指定节点作为客户端时相关网络性能指标。<br>19.  Network - Flow Log<br><img src=\"/image-25.png\" alt=\"Alt text\"><br>此dashboard展示了网络流日志内容。<br>可根据cluster(集群)、namespace(命名空间)、workload(工作负载)进行筛选。<br>● Summary count: 日志总量摘要。<br>● Error count: 错误数量。<br>● TCP est.conn latency distribution：连接建立（establishment）延迟时间分布。<br>● TCP data latency distribution： 指的是在TCP协议下，数据传输延迟时间分布。<br>● Flow log：网络流日志列表，内容包括 start time(开始时间)、client(客户端)、server(服务端)、tap side(数据才采集点)、protocol(网络协议)、client port(客户端端口)、server port(服务端端口)、status(状态，由 close_type（流结束类型）与 protocol（协议）决定：正常结束&#x2F;周期性上报&#x2F;非TCP超时&#x3D;正常，客户端XX&#x3D;客户端异常，服务端XX&#x2F;TCP超时&#x3D;服务端异常，其他结束方式&#x3D;未知。)、Byte TX(发送字节数)、Byte RX(接收字节数)、TCP Client Retransmission(TCP客户端重传)、TCP Server Retransmission(TCP服务端重传)、Avg TCP Est. Delay(连接建立平均时延)、Avg Data Delay（数据传输平均时延）。<br>20. Network - Flow Log - Cloud<br><img src=\"https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/MAeqxYPPLZoQO8j9/img/cbf20764-c8a8-48b3-a0c2-a023923ef515.png\" alt=\"Alt text\"><br>此dashboard展示的网络流日志内容与Flow Log相同，区别是筛选条件不同，此dashboard提供根据VM(节点)进行筛选，查看各节点上工作流日志。<br>21. Network - K8s Pod<br><img src=\"https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/MAeqxYPPLZoQO8j9/img/334e9637-7366-4397-a79c-c61ec162c7f3.png\"><br>此dashboard展示了pod的网络性能相关指标，可根据cluster、namespace、workload进行筛选。<br>● Throught(bps): 展示了pod网络吞吐量，包括最小值、平均值、最大值。<br>● Retrans rate: 展示pod包重传率，包括最小值、平均值、最大值。<br>● TCP conn. establishment fail rate: TCP连接建立失败率，包括最小值、平均值、最大值。<br>● TCP conn. establishment latency：TCP连接建立延迟。<br>● Pod List： pod网络性能列表。<br>22.  Network - K8s Pod Map<br><img src=\"https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/MAeqxYPPLZoQO8j9/img/85fd8ca0-bea9-43e3-8a12-1a9b82cac676.png\"><br>网络性能全景图，点击路径可查看相关指标，包括bps、retrans_ratio(TCP 重传比例：TCP 重传比例，通过TCP 重传 &#x2F; 所有的包计算得，即 retrans &#x2F; packet)、tcp_establish_fail_ratio（建连-失败比例：建连-失败比例，通过 TCP 建连-失败次数 &#x2F; 所有的关闭连接计算得，即 tcp_establish_fail &#x2F; close_flow）、rtt(平均 TCP 建连时延,统计周期内，所有 TCP 建连时延的平均值)、art(平均数据时延:统计周期内，所有数据时延的平均值，数据时延包含 TCP&#x2F;UDP)等。</p>\n"},{"title":"EFK","date":"2023-08-24T08:34:28.000Z","_content":"要在Kubernetes中部署Filebeat、Elasticsearch和Kibana来采集容器日志，可以按照以下步骤进行:\n\n1. 部署Elasticsearch:\n   在Kubernetes集群上创建一个Elasticsearch的Deployment，这个Deployment将用于存储和索引日志数据。可以使用以下示例配置文件创建Deployment:\n\n   ```yaml\n   apiVersion: apps/v1\n   kind: Deployment\n   metadata:\n     name: elasticsearch\n   spec:\n     replicas: 1\n     selector:\n       matchLabels:\n         app: elasticsearch\n     template:\n       metadata:\n         labels:\n           app: elasticsearch\n       spec:\n         containers:\n         - name: elasticsearch\n           image: elasticsearch:7.12.1\n           resources:\n             requests:\n               memory: 2Gi\n               cpu: 1\n           ports:\n           - containerPort: 9200\n   ```\n\n   运行`kubectl apply -f elasticsearch.yaml`命令来创建Deployment。\n\n2. 部署Kibana:\n   在Kubernetes集群上创建一个Kibana的Deployment，这个Deployment将用于可视化和查询日志数据。可以使用以下示例配置文件创建Deployment:\n\n   ```yaml\n   apiVersion: apps/v1\n   kind: Deployment\n   metadata:\n     name: kibana\n   spec:\n     replicas: 1\n     selector:\n       matchLabels:\n         app: kibana\n     template:\n       metadata:\n         labels:\n           app: kibana\n       spec:\n         containers:\n         - name: kibana\n           image: kibana:7.12.1\n           resources:\n             requests:\n               memory: 1Gi\n               cpu: 0.5\n           ports:\n           - containerPort: 5601\n   ```\n\n   运行`kubectl apply -f kibana.yaml`命令来创建Deployment。\n\n3. 部署Filebeat:\n   在Kubernetes集群上创建一个Filebeat DaemonSet，这个DaemonSet将在每个节点上运行一个Filebeat实例来收集容器日志。可以使用以下示例配置文件创建DaemonSet:\n\n   ```yaml\n   apiVersion: apps/v1\n   kind: DaemonSet\n   metadata:\n     name: filebeat\n     labels:\n       app: filebeat\n   spec:\n     selector:\n       matchLabels:\n         app: filebeat\n     template:\n       metadata:\n         labels:\n           app: filebeat\n       spec:\n         containers:\n         - name: filebeat\n           image: docker.elastic.co/beats/filebeat:7.12.1\n           volumeMounts:\n           - name: varlibdockercontainers\n             mountPath: /var/lib/docker/containers\n             readOnly: true\n           - name: varlog\n             mountPath: /var/log\n             readOnly: true\n           - name: varlogpod\n             mountPath: /var/log/pods\n             readOnly: true\n           - name: varrun\n             mountPath: /var/run\n           - name: varlibkubelet\n             mountPath: /var/lib/kubelet\n           - name: varlognode\n             mountPath: /var/log/node\n             readOnly: true\n           - name: varlogcontainersnew\n             mountPath: /var/log/containersnew\n             readOnly: true\n           - name: dockersocket\n             mountPath: /var/run/docker.sock\n           - name: config\n             mountPath: /usr/share/filebeat/filebeat.yml\n             subPath: filebeat.yml\n             readOnly: true\n           env:\n           - name: K8S_NODE_NAME\n             valueFrom:\n               fieldRef:\n                 fieldPath: spec.nodeName\n           - name: NODE_NAME\n             valueFrom:\n               fieldRef:\n                 fieldPath: spec.nodeName\n           - name: FILEBEAT_HOST\n             valueFrom:\n               fieldRef:\n                 fieldPath: status.hostIP\n           - name: FILEBEAT_CONFIG_CHECK_FREQUENCY\n             value: \"5s\"\n           - name: OUTPUT_TYPE\n             value: elasticsearch\n           - name: ELASTICSEARCH_HOST\n             value: elasticsearch:9200\n           - name: ELASTICSEARCH_USERNAME\n             value: \"<ELASTICSEARCH_USERNAME>\"\n           - name: ELASTICSEARCH_PASSWORD\n             value: \"<ELASTICSEARCH_PASSWORD>\"\n           - name: ELASTICSEARCH_INDEX\n             value: \"filebeat-%{[agent.version]}-%{+yyyy.MM.dd}\"\n           - name: ELASTICSEARCH_PIPELINE\n             value: \"<ELASTICSEARCH_PIPELINE>\"\n           resources:\n             limits:\n               memory: 200Mi\n             requests:\n               cpu: 100m\n               memory: 100Mi\n           terminationGracePeriodSeconds: 30\n           dnsPolicy: ClusterFirstWithHostNet\n           restartPolicy: Always\n           hostNetwork: true\n           volumes:\n           - name: varlibdockercontainers\n             hostPath:\n               path: /var/lib/docker/containers\n           - name: varlog\n             hostPath:\n               path: /var/log\n           - name: varlogpod\n             hostPath:\n               path: /var/log/pods\n           - name: varrun\n             hostPath:\n               path: /var/run\n           - name: varlibkubelet\n             hostPath:\n               path: /var/lib/kubelet\n           - name: varlognode\n             hostPath:\n               path: /var/log/node\n           - name: varlogcontainersnew\n             hostPath:\n               path: /var/log/containersnew\n           - name: dockersocket\n             hostPath:\n               path: /var/run/docker.sock\n           - name: config\n             configMap:\n               name: filebeat-config\n       updateStrategy:\n         type: RollingUpdate\n        rollingUpdate:\n           maxUnavailable: 1\n   ```\n\n   创建一个ConfigMap来存储Filebeat的配置文件(filebeat.yml)，示例配置文件可以参考以下内容:\n\n   ```yaml\n   filebeat.config:\n     modules:\n       path: ${path.config}/modules.d/*.yml\n       reload.enabled: false\n\n   filebeat.modules:\n   - module: system\n     syslog:\n       enabled: true\n     auth:\n       enabled: true\n     package:\n       enabled: true\n     coredns:\n       enabled: true\n\n   output.elasticsearch:\n     hosts: ['elasticsearch:9200']\n     username: '<ELASTICSEARCH_USERNAME>'\n     password: '<ELASTICSEARCH_PASSWORD>'\n     pipeline: '<ELASTICSEARCH_PIPELINE>'\n   ```\n\n   运行`kubectl create configmap filebeat-config --from-file=filebeat.yml`命令来创建ConfigMap。\n\n   然后，运行`kubectl apply -f filebeat.yaml`命令来创建DaemonSet。\n\n4. 日志采集:\n   当Filebeat启动后，它将开始采集Kubernetes集群中所有容器的日志数据，并将其发送到Elasticsearch进行存储和索引。您可以使用Kibana来可视化和查询这些日志数据。\n\n这是一个简单的部署Filebeat、Elasticsearch和Kibana来采集Kubernetes集群中容器日志的示例配置。根据您的实际需求，可能还需要进行一些其他的配置和调整。","source":"_posts/kubernetes/efk.md","raw":"---\ntitle: EFK\ndate: 2023-08-24 16:34:28\ncategories:\n  - [kubernetes]\ntags: logging\n---\n要在Kubernetes中部署Filebeat、Elasticsearch和Kibana来采集容器日志，可以按照以下步骤进行:\n\n1. 部署Elasticsearch:\n   在Kubernetes集群上创建一个Elasticsearch的Deployment，这个Deployment将用于存储和索引日志数据。可以使用以下示例配置文件创建Deployment:\n\n   ```yaml\n   apiVersion: apps/v1\n   kind: Deployment\n   metadata:\n     name: elasticsearch\n   spec:\n     replicas: 1\n     selector:\n       matchLabels:\n         app: elasticsearch\n     template:\n       metadata:\n         labels:\n           app: elasticsearch\n       spec:\n         containers:\n         - name: elasticsearch\n           image: elasticsearch:7.12.1\n           resources:\n             requests:\n               memory: 2Gi\n               cpu: 1\n           ports:\n           - containerPort: 9200\n   ```\n\n   运行`kubectl apply -f elasticsearch.yaml`命令来创建Deployment。\n\n2. 部署Kibana:\n   在Kubernetes集群上创建一个Kibana的Deployment，这个Deployment将用于可视化和查询日志数据。可以使用以下示例配置文件创建Deployment:\n\n   ```yaml\n   apiVersion: apps/v1\n   kind: Deployment\n   metadata:\n     name: kibana\n   spec:\n     replicas: 1\n     selector:\n       matchLabels:\n         app: kibana\n     template:\n       metadata:\n         labels:\n           app: kibana\n       spec:\n         containers:\n         - name: kibana\n           image: kibana:7.12.1\n           resources:\n             requests:\n               memory: 1Gi\n               cpu: 0.5\n           ports:\n           - containerPort: 5601\n   ```\n\n   运行`kubectl apply -f kibana.yaml`命令来创建Deployment。\n\n3. 部署Filebeat:\n   在Kubernetes集群上创建一个Filebeat DaemonSet，这个DaemonSet将在每个节点上运行一个Filebeat实例来收集容器日志。可以使用以下示例配置文件创建DaemonSet:\n\n   ```yaml\n   apiVersion: apps/v1\n   kind: DaemonSet\n   metadata:\n     name: filebeat\n     labels:\n       app: filebeat\n   spec:\n     selector:\n       matchLabels:\n         app: filebeat\n     template:\n       metadata:\n         labels:\n           app: filebeat\n       spec:\n         containers:\n         - name: filebeat\n           image: docker.elastic.co/beats/filebeat:7.12.1\n           volumeMounts:\n           - name: varlibdockercontainers\n             mountPath: /var/lib/docker/containers\n             readOnly: true\n           - name: varlog\n             mountPath: /var/log\n             readOnly: true\n           - name: varlogpod\n             mountPath: /var/log/pods\n             readOnly: true\n           - name: varrun\n             mountPath: /var/run\n           - name: varlibkubelet\n             mountPath: /var/lib/kubelet\n           - name: varlognode\n             mountPath: /var/log/node\n             readOnly: true\n           - name: varlogcontainersnew\n             mountPath: /var/log/containersnew\n             readOnly: true\n           - name: dockersocket\n             mountPath: /var/run/docker.sock\n           - name: config\n             mountPath: /usr/share/filebeat/filebeat.yml\n             subPath: filebeat.yml\n             readOnly: true\n           env:\n           - name: K8S_NODE_NAME\n             valueFrom:\n               fieldRef:\n                 fieldPath: spec.nodeName\n           - name: NODE_NAME\n             valueFrom:\n               fieldRef:\n                 fieldPath: spec.nodeName\n           - name: FILEBEAT_HOST\n             valueFrom:\n               fieldRef:\n                 fieldPath: status.hostIP\n           - name: FILEBEAT_CONFIG_CHECK_FREQUENCY\n             value: \"5s\"\n           - name: OUTPUT_TYPE\n             value: elasticsearch\n           - name: ELASTICSEARCH_HOST\n             value: elasticsearch:9200\n           - name: ELASTICSEARCH_USERNAME\n             value: \"<ELASTICSEARCH_USERNAME>\"\n           - name: ELASTICSEARCH_PASSWORD\n             value: \"<ELASTICSEARCH_PASSWORD>\"\n           - name: ELASTICSEARCH_INDEX\n             value: \"filebeat-%{[agent.version]}-%{+yyyy.MM.dd}\"\n           - name: ELASTICSEARCH_PIPELINE\n             value: \"<ELASTICSEARCH_PIPELINE>\"\n           resources:\n             limits:\n               memory: 200Mi\n             requests:\n               cpu: 100m\n               memory: 100Mi\n           terminationGracePeriodSeconds: 30\n           dnsPolicy: ClusterFirstWithHostNet\n           restartPolicy: Always\n           hostNetwork: true\n           volumes:\n           - name: varlibdockercontainers\n             hostPath:\n               path: /var/lib/docker/containers\n           - name: varlog\n             hostPath:\n               path: /var/log\n           - name: varlogpod\n             hostPath:\n               path: /var/log/pods\n           - name: varrun\n             hostPath:\n               path: /var/run\n           - name: varlibkubelet\n             hostPath:\n               path: /var/lib/kubelet\n           - name: varlognode\n             hostPath:\n               path: /var/log/node\n           - name: varlogcontainersnew\n             hostPath:\n               path: /var/log/containersnew\n           - name: dockersocket\n             hostPath:\n               path: /var/run/docker.sock\n           - name: config\n             configMap:\n               name: filebeat-config\n       updateStrategy:\n         type: RollingUpdate\n        rollingUpdate:\n           maxUnavailable: 1\n   ```\n\n   创建一个ConfigMap来存储Filebeat的配置文件(filebeat.yml)，示例配置文件可以参考以下内容:\n\n   ```yaml\n   filebeat.config:\n     modules:\n       path: ${path.config}/modules.d/*.yml\n       reload.enabled: false\n\n   filebeat.modules:\n   - module: system\n     syslog:\n       enabled: true\n     auth:\n       enabled: true\n     package:\n       enabled: true\n     coredns:\n       enabled: true\n\n   output.elasticsearch:\n     hosts: ['elasticsearch:9200']\n     username: '<ELASTICSEARCH_USERNAME>'\n     password: '<ELASTICSEARCH_PASSWORD>'\n     pipeline: '<ELASTICSEARCH_PIPELINE>'\n   ```\n\n   运行`kubectl create configmap filebeat-config --from-file=filebeat.yml`命令来创建ConfigMap。\n\n   然后，运行`kubectl apply -f filebeat.yaml`命令来创建DaemonSet。\n\n4. 日志采集:\n   当Filebeat启动后，它将开始采集Kubernetes集群中所有容器的日志数据，并将其发送到Elasticsearch进行存储和索引。您可以使用Kibana来可视化和查询这些日志数据。\n\n这是一个简单的部署Filebeat、Elasticsearch和Kibana来采集Kubernetes集群中容器日志的示例配置。根据您的实际需求，可能还需要进行一些其他的配置和调整。","slug":"kubernetes/efk","published":1,"updated":"2023-08-24T08:35:02.494Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clo89v5ef000hb7jx2q5e6ql3","content":"<p>要在Kubernetes中部署Filebeat、Elasticsearch和Kibana来采集容器日志，可以按照以下步骤进行:</p>\n<ol>\n<li><p>部署Elasticsearch:<br>在Kubernetes集群上创建一个Elasticsearch的Deployment，这个Deployment将用于存储和索引日志数据。可以使用以下示例配置文件创建Deployment:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">elasticsearch:7.12.1</span></span><br><span class=\"line\">        <span class=\"attr\">resources:</span></span><br><span class=\"line\">          <span class=\"attr\">requests:</span></span><br><span class=\"line\">            <span class=\"attr\">memory:</span> <span class=\"string\">2Gi</span></span><br><span class=\"line\">            <span class=\"attr\">cpu:</span> <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">9200</span></span><br></pre></td></tr></table></figure>\n\n<p>运行<code>kubectl apply -f elasticsearch.yaml</code>命令来创建Deployment。</p>\n</li>\n<li><p>部署Kibana:<br>在Kubernetes集群上创建一个Kibana的Deployment，这个Deployment将用于可视化和查询日志数据。可以使用以下示例配置文件创建Deployment:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">kibana</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">kibana</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">kibana</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">kibana</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">kibana:7.12.1</span></span><br><span class=\"line\">        <span class=\"attr\">resources:</span></span><br><span class=\"line\">          <span class=\"attr\">requests:</span></span><br><span class=\"line\">            <span class=\"attr\">memory:</span> <span class=\"string\">1Gi</span></span><br><span class=\"line\">            <span class=\"attr\">cpu:</span> <span class=\"number\">0.5</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">5601</span></span><br></pre></td></tr></table></figure>\n\n<p>运行<code>kubectl apply -f kibana.yaml</code>命令来创建Deployment。</p>\n</li>\n<li><p>部署Filebeat:<br>在Kubernetes集群上创建一个Filebeat DaemonSet，这个DaemonSet将在每个节点上运行一个Filebeat实例来收集容器日志。可以使用以下示例配置文件创建DaemonSet:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">DaemonSet</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">filebeat</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">filebeat</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">filebeat</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">filebeat</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">filebeat</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">docker.elastic.co/beats/filebeat:7.12.1</span></span><br><span class=\"line\">        <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">varlibdockercontainers</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/var/lib/docker/containers</span></span><br><span class=\"line\">          <span class=\"attr\">readOnly:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">varlog</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/var/log</span></span><br><span class=\"line\">          <span class=\"attr\">readOnly:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">varlogpod</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/var/log/pods</span></span><br><span class=\"line\">          <span class=\"attr\">readOnly:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">varrun</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/var/run</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">varlibkubelet</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/var/lib/kubelet</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">varlognode</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/var/log/node</span></span><br><span class=\"line\">          <span class=\"attr\">readOnly:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">varlogcontainersnew</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/var/log/containersnew</span></span><br><span class=\"line\">          <span class=\"attr\">readOnly:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">dockersocket</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/var/run/docker.sock</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/usr/share/filebeat/filebeat.yml</span></span><br><span class=\"line\">          <span class=\"attr\">subPath:</span> <span class=\"string\">filebeat.yml</span></span><br><span class=\"line\">          <span class=\"attr\">readOnly:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"attr\">env:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">K8S_NODE_NAME</span></span><br><span class=\"line\">          <span class=\"attr\">valueFrom:</span></span><br><span class=\"line\">            <span class=\"attr\">fieldRef:</span></span><br><span class=\"line\">              <span class=\"attr\">fieldPath:</span> <span class=\"string\">spec.nodeName</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">NODE_NAME</span></span><br><span class=\"line\">          <span class=\"attr\">valueFrom:</span></span><br><span class=\"line\">            <span class=\"attr\">fieldRef:</span></span><br><span class=\"line\">              <span class=\"attr\">fieldPath:</span> <span class=\"string\">spec.nodeName</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">FILEBEAT_HOST</span></span><br><span class=\"line\">          <span class=\"attr\">valueFrom:</span></span><br><span class=\"line\">            <span class=\"attr\">fieldRef:</span></span><br><span class=\"line\">              <span class=\"attr\">fieldPath:</span> <span class=\"string\">status.hostIP</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">FILEBEAT_CONFIG_CHECK_FREQUENCY</span></span><br><span class=\"line\">          <span class=\"attr\">value:</span> <span class=\"string\">&quot;5s&quot;</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">OUTPUT_TYPE</span></span><br><span class=\"line\">          <span class=\"attr\">value:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">ELASTICSEARCH_HOST</span></span><br><span class=\"line\">          <span class=\"attr\">value:</span> <span class=\"string\">elasticsearch:9200</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">ELASTICSEARCH_USERNAME</span></span><br><span class=\"line\">          <span class=\"attr\">value:</span> <span class=\"string\">&quot;&lt;ELASTICSEARCH_USERNAME&gt;&quot;</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">ELASTICSEARCH_PASSWORD</span></span><br><span class=\"line\">          <span class=\"attr\">value:</span> <span class=\"string\">&quot;&lt;ELASTICSEARCH_PASSWORD&gt;&quot;</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">ELASTICSEARCH_INDEX</span></span><br><span class=\"line\">          <span class=\"attr\">value:</span> <span class=\"string\">&quot;filebeat-<span class=\"template-variable\">%&#123;[agent.version]&#125;</span>-<span class=\"template-variable\">%&#123;+yyyy.MM.dd&#125;</span>&quot;</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">ELASTICSEARCH_PIPELINE</span></span><br><span class=\"line\">          <span class=\"attr\">value:</span> <span class=\"string\">&quot;&lt;ELASTICSEARCH_PIPELINE&gt;&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">resources:</span></span><br><span class=\"line\">          <span class=\"attr\">limits:</span></span><br><span class=\"line\">            <span class=\"attr\">memory:</span> <span class=\"string\">200Mi</span></span><br><span class=\"line\">          <span class=\"attr\">requests:</span></span><br><span class=\"line\">            <span class=\"attr\">cpu:</span> <span class=\"string\">100m</span></span><br><span class=\"line\">            <span class=\"attr\">memory:</span> <span class=\"string\">100Mi</span></span><br><span class=\"line\">        <span class=\"attr\">terminationGracePeriodSeconds:</span> <span class=\"number\">30</span></span><br><span class=\"line\">        <span class=\"attr\">dnsPolicy:</span> <span class=\"string\">ClusterFirstWithHostNet</span></span><br><span class=\"line\">        <span class=\"attr\">restartPolicy:</span> <span class=\"string\">Always</span></span><br><span class=\"line\">        <span class=\"attr\">hostNetwork:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"attr\">volumes:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">varlibdockercontainers</span></span><br><span class=\"line\">          <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">            <span class=\"attr\">path:</span> <span class=\"string\">/var/lib/docker/containers</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">varlog</span></span><br><span class=\"line\">          <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">            <span class=\"attr\">path:</span> <span class=\"string\">/var/log</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">varlogpod</span></span><br><span class=\"line\">          <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">            <span class=\"attr\">path:</span> <span class=\"string\">/var/log/pods</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">varrun</span></span><br><span class=\"line\">          <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">            <span class=\"attr\">path:</span> <span class=\"string\">/var/run</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">varlibkubelet</span></span><br><span class=\"line\">          <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">            <span class=\"attr\">path:</span> <span class=\"string\">/var/lib/kubelet</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">varlognode</span></span><br><span class=\"line\">          <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">            <span class=\"attr\">path:</span> <span class=\"string\">/var/log/node</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">varlogcontainersnew</span></span><br><span class=\"line\">          <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">            <span class=\"attr\">path:</span> <span class=\"string\">/var/log/containersnew</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">dockersocket</span></span><br><span class=\"line\">          <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">            <span class=\"attr\">path:</span> <span class=\"string\">/var/run/docker.sock</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config</span></span><br><span class=\"line\">          <span class=\"attr\">configMap:</span></span><br><span class=\"line\">            <span class=\"attr\">name:</span> <span class=\"string\">filebeat-config</span></span><br><span class=\"line\">    <span class=\"attr\">updateStrategy:</span></span><br><span class=\"line\">      <span class=\"attr\">type:</span> <span class=\"string\">RollingUpdate</span></span><br><span class=\"line\">     <span class=\"attr\">rollingUpdate:</span></span><br><span class=\"line\">        <span class=\"attr\">maxUnavailable:</span> <span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n\n<p>创建一个ConfigMap来存储Filebeat的配置文件(filebeat.yml)，示例配置文件可以参考以下内容:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">filebeat.config:</span></span><br><span class=\"line\">  <span class=\"attr\">modules:</span></span><br><span class=\"line\">    <span class=\"attr\">path:</span> <span class=\"string\">$&#123;path.config&#125;/modules.d/*.yml</span></span><br><span class=\"line\">    <span class=\"attr\">reload.enabled:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">filebeat.modules:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">module:</span> <span class=\"string\">system</span></span><br><span class=\"line\">  <span class=\"attr\">syslog:</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">auth:</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">package:</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">coredns:</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">output.elasticsearch:</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> [<span class=\"string\">&#x27;elasticsearch:9200&#x27;</span>]</span><br><span class=\"line\">  <span class=\"attr\">username:</span> <span class=\"string\">&#x27;&lt;ELASTICSEARCH_USERNAME&gt;&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">password:</span> <span class=\"string\">&#x27;&lt;ELASTICSEARCH_PASSWORD&gt;&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">pipeline:</span> <span class=\"string\">&#x27;&lt;ELASTICSEARCH_PIPELINE&gt;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>运行<code>kubectl create configmap filebeat-config --from-file=filebeat.yml</code>命令来创建ConfigMap。</p>\n<p>然后，运行<code>kubectl apply -f filebeat.yaml</code>命令来创建DaemonSet。</p>\n</li>\n<li><p>日志采集:<br>当Filebeat启动后，它将开始采集Kubernetes集群中所有容器的日志数据，并将其发送到Elasticsearch进行存储和索引。您可以使用Kibana来可视化和查询这些日志数据。</p>\n</li>\n</ol>\n<p>这是一个简单的部署Filebeat、Elasticsearch和Kibana来采集Kubernetes集群中容器日志的示例配置。根据您的实际需求，可能还需要进行一些其他的配置和调整。</p>\n","site":{"data":{"link":[{"class_name":"友情鏈接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、簡單且強大的網誌框架"}]},{"class_name":"網站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":false,"excerpt":"","more":"<p>要在Kubernetes中部署Filebeat、Elasticsearch和Kibana来采集容器日志，可以按照以下步骤进行:</p>\n<ol>\n<li><p>部署Elasticsearch:<br>在Kubernetes集群上创建一个Elasticsearch的Deployment，这个Deployment将用于存储和索引日志数据。可以使用以下示例配置文件创建Deployment:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">elasticsearch:7.12.1</span></span><br><span class=\"line\">        <span class=\"attr\">resources:</span></span><br><span class=\"line\">          <span class=\"attr\">requests:</span></span><br><span class=\"line\">            <span class=\"attr\">memory:</span> <span class=\"string\">2Gi</span></span><br><span class=\"line\">            <span class=\"attr\">cpu:</span> <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">9200</span></span><br></pre></td></tr></table></figure>\n\n<p>运行<code>kubectl apply -f elasticsearch.yaml</code>命令来创建Deployment。</p>\n</li>\n<li><p>部署Kibana:<br>在Kubernetes集群上创建一个Kibana的Deployment，这个Deployment将用于可视化和查询日志数据。可以使用以下示例配置文件创建Deployment:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">kibana</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">kibana</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">kibana</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">kibana</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">kibana:7.12.1</span></span><br><span class=\"line\">        <span class=\"attr\">resources:</span></span><br><span class=\"line\">          <span class=\"attr\">requests:</span></span><br><span class=\"line\">            <span class=\"attr\">memory:</span> <span class=\"string\">1Gi</span></span><br><span class=\"line\">            <span class=\"attr\">cpu:</span> <span class=\"number\">0.5</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">5601</span></span><br></pre></td></tr></table></figure>\n\n<p>运行<code>kubectl apply -f kibana.yaml</code>命令来创建Deployment。</p>\n</li>\n<li><p>部署Filebeat:<br>在Kubernetes集群上创建一个Filebeat DaemonSet，这个DaemonSet将在每个节点上运行一个Filebeat实例来收集容器日志。可以使用以下示例配置文件创建DaemonSet:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">DaemonSet</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">filebeat</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">filebeat</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">filebeat</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">filebeat</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">filebeat</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">docker.elastic.co/beats/filebeat:7.12.1</span></span><br><span class=\"line\">        <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">varlibdockercontainers</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/var/lib/docker/containers</span></span><br><span class=\"line\">          <span class=\"attr\">readOnly:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">varlog</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/var/log</span></span><br><span class=\"line\">          <span class=\"attr\">readOnly:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">varlogpod</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/var/log/pods</span></span><br><span class=\"line\">          <span class=\"attr\">readOnly:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">varrun</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/var/run</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">varlibkubelet</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/var/lib/kubelet</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">varlognode</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/var/log/node</span></span><br><span class=\"line\">          <span class=\"attr\">readOnly:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">varlogcontainersnew</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/var/log/containersnew</span></span><br><span class=\"line\">          <span class=\"attr\">readOnly:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">dockersocket</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/var/run/docker.sock</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/usr/share/filebeat/filebeat.yml</span></span><br><span class=\"line\">          <span class=\"attr\">subPath:</span> <span class=\"string\">filebeat.yml</span></span><br><span class=\"line\">          <span class=\"attr\">readOnly:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"attr\">env:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">K8S_NODE_NAME</span></span><br><span class=\"line\">          <span class=\"attr\">valueFrom:</span></span><br><span class=\"line\">            <span class=\"attr\">fieldRef:</span></span><br><span class=\"line\">              <span class=\"attr\">fieldPath:</span> <span class=\"string\">spec.nodeName</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">NODE_NAME</span></span><br><span class=\"line\">          <span class=\"attr\">valueFrom:</span></span><br><span class=\"line\">            <span class=\"attr\">fieldRef:</span></span><br><span class=\"line\">              <span class=\"attr\">fieldPath:</span> <span class=\"string\">spec.nodeName</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">FILEBEAT_HOST</span></span><br><span class=\"line\">          <span class=\"attr\">valueFrom:</span></span><br><span class=\"line\">            <span class=\"attr\">fieldRef:</span></span><br><span class=\"line\">              <span class=\"attr\">fieldPath:</span> <span class=\"string\">status.hostIP</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">FILEBEAT_CONFIG_CHECK_FREQUENCY</span></span><br><span class=\"line\">          <span class=\"attr\">value:</span> <span class=\"string\">&quot;5s&quot;</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">OUTPUT_TYPE</span></span><br><span class=\"line\">          <span class=\"attr\">value:</span> <span class=\"string\">elasticsearch</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">ELASTICSEARCH_HOST</span></span><br><span class=\"line\">          <span class=\"attr\">value:</span> <span class=\"string\">elasticsearch:9200</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">ELASTICSEARCH_USERNAME</span></span><br><span class=\"line\">          <span class=\"attr\">value:</span> <span class=\"string\">&quot;&lt;ELASTICSEARCH_USERNAME&gt;&quot;</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">ELASTICSEARCH_PASSWORD</span></span><br><span class=\"line\">          <span class=\"attr\">value:</span> <span class=\"string\">&quot;&lt;ELASTICSEARCH_PASSWORD&gt;&quot;</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">ELASTICSEARCH_INDEX</span></span><br><span class=\"line\">          <span class=\"attr\">value:</span> <span class=\"string\">&quot;filebeat-<span class=\"template-variable\">%&#123;[agent.version]&#125;</span>-<span class=\"template-variable\">%&#123;+yyyy.MM.dd&#125;</span>&quot;</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">ELASTICSEARCH_PIPELINE</span></span><br><span class=\"line\">          <span class=\"attr\">value:</span> <span class=\"string\">&quot;&lt;ELASTICSEARCH_PIPELINE&gt;&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">resources:</span></span><br><span class=\"line\">          <span class=\"attr\">limits:</span></span><br><span class=\"line\">            <span class=\"attr\">memory:</span> <span class=\"string\">200Mi</span></span><br><span class=\"line\">          <span class=\"attr\">requests:</span></span><br><span class=\"line\">            <span class=\"attr\">cpu:</span> <span class=\"string\">100m</span></span><br><span class=\"line\">            <span class=\"attr\">memory:</span> <span class=\"string\">100Mi</span></span><br><span class=\"line\">        <span class=\"attr\">terminationGracePeriodSeconds:</span> <span class=\"number\">30</span></span><br><span class=\"line\">        <span class=\"attr\">dnsPolicy:</span> <span class=\"string\">ClusterFirstWithHostNet</span></span><br><span class=\"line\">        <span class=\"attr\">restartPolicy:</span> <span class=\"string\">Always</span></span><br><span class=\"line\">        <span class=\"attr\">hostNetwork:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"attr\">volumes:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">varlibdockercontainers</span></span><br><span class=\"line\">          <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">            <span class=\"attr\">path:</span> <span class=\"string\">/var/lib/docker/containers</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">varlog</span></span><br><span class=\"line\">          <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">            <span class=\"attr\">path:</span> <span class=\"string\">/var/log</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">varlogpod</span></span><br><span class=\"line\">          <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">            <span class=\"attr\">path:</span> <span class=\"string\">/var/log/pods</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">varrun</span></span><br><span class=\"line\">          <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">            <span class=\"attr\">path:</span> <span class=\"string\">/var/run</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">varlibkubelet</span></span><br><span class=\"line\">          <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">            <span class=\"attr\">path:</span> <span class=\"string\">/var/lib/kubelet</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">varlognode</span></span><br><span class=\"line\">          <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">            <span class=\"attr\">path:</span> <span class=\"string\">/var/log/node</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">varlogcontainersnew</span></span><br><span class=\"line\">          <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">            <span class=\"attr\">path:</span> <span class=\"string\">/var/log/containersnew</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">dockersocket</span></span><br><span class=\"line\">          <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">            <span class=\"attr\">path:</span> <span class=\"string\">/var/run/docker.sock</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config</span></span><br><span class=\"line\">          <span class=\"attr\">configMap:</span></span><br><span class=\"line\">            <span class=\"attr\">name:</span> <span class=\"string\">filebeat-config</span></span><br><span class=\"line\">    <span class=\"attr\">updateStrategy:</span></span><br><span class=\"line\">      <span class=\"attr\">type:</span> <span class=\"string\">RollingUpdate</span></span><br><span class=\"line\">     <span class=\"attr\">rollingUpdate:</span></span><br><span class=\"line\">        <span class=\"attr\">maxUnavailable:</span> <span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n\n<p>创建一个ConfigMap来存储Filebeat的配置文件(filebeat.yml)，示例配置文件可以参考以下内容:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">filebeat.config:</span></span><br><span class=\"line\">  <span class=\"attr\">modules:</span></span><br><span class=\"line\">    <span class=\"attr\">path:</span> <span class=\"string\">$&#123;path.config&#125;/modules.d/*.yml</span></span><br><span class=\"line\">    <span class=\"attr\">reload.enabled:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">filebeat.modules:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">module:</span> <span class=\"string\">system</span></span><br><span class=\"line\">  <span class=\"attr\">syslog:</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">auth:</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">package:</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">coredns:</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">output.elasticsearch:</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> [<span class=\"string\">&#x27;elasticsearch:9200&#x27;</span>]</span><br><span class=\"line\">  <span class=\"attr\">username:</span> <span class=\"string\">&#x27;&lt;ELASTICSEARCH_USERNAME&gt;&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">password:</span> <span class=\"string\">&#x27;&lt;ELASTICSEARCH_PASSWORD&gt;&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">pipeline:</span> <span class=\"string\">&#x27;&lt;ELASTICSEARCH_PIPELINE&gt;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>运行<code>kubectl create configmap filebeat-config --from-file=filebeat.yml</code>命令来创建ConfigMap。</p>\n<p>然后，运行<code>kubectl apply -f filebeat.yaml</code>命令来创建DaemonSet。</p>\n</li>\n<li><p>日志采集:<br>当Filebeat启动后，它将开始采集Kubernetes集群中所有容器的日志数据，并将其发送到Elasticsearch进行存储和索引。您可以使用Kibana来可视化和查询这些日志数据。</p>\n</li>\n</ol>\n<p>这是一个简单的部署Filebeat、Elasticsearch和Kibana来采集Kubernetes集群中容器日志的示例配置。根据您的实际需求，可能还需要进行一些其他的配置和调整。</p>\n"},{"title":"Fluent Bit和Fluentd之间的联系及区别","date":"2023-08-24T08:13:26.000Z","_content":"Fluent Bit和Fluentd是两个流行的开源日志收集工具，并且它们有一些共同的设计目标，但也有一些区别。\n\n1. Fluent Bit（轻量型的日志收集器）\nFluent Bit是一个轻量级和高性能的日志收集器，由Treasure Data公司开发。它专注于收集、过滤和转发日志，具有低内存占用和低性能开销的特点。Fluent Bit设计用于嵌入式系统和容器环境中，可以作为提供日志数据的终端。\n\n使用场景：\n- IoT设备：Fluent Bit作为嵌入式日志收集器，适用于在资源有限的物联网设备上收集日志数据。\n- 容器环境：Fluent Bit能够与Docker等容器平台无缝集成，并快速收集、聚合和转发容器日志。\n- 边缘计算：部署在边缘节点的Fluent Bit能够实时收集和传输边缘设备上的日志数据。\n\n使用方式：\n- 配置管理：通过配置文件定义输入源、过滤规则和输出目标。\n- 轻量级部署：由于其低资源消耗，Fluent Bit适合在嵌入式设备和容器中部署。\n- 插件支持：提供多种插件，如输入、过滤和输出插件，可根据需求扩展功能。\n\n2. Fluentd（全能型的日志收集引擎）\nFluentd是一个功能强大的开源日志收集和流数据处理引擎，也是由Treasure Data公司开发。它设计用于处理大规模和复杂的数据流，提供了更丰富的功能和灵活性。\n\n使用场景：\n- 日志聚合：收集来自多个源（文件、系统日志、应用程序日志等）的日志数据，并将其聚合到一处进行分析和存储。\n- 实时大数据处理：通过Fluentd的插件生态系统，可以将数据发送到Hadoop、Elasticsearch等数据处理和存储平台。\n- 日志路由和转换：Fluentd支持对日志数据进行过滤、标准化和转换，以便在不同目标之间进行路由。\n\n使用方式：\n- 插件生态系统：拥有丰富的插件生态系统，可用于收集、处理和转发各种类型的数据。\n- 高度可配置：通过配置文件进行配置，可以定义输入源、过滤器和输出目标，并自定义数据流的处理逻辑。\n- 部署灵活：Fluentd可以以独立进程或守护进程的形式部署，也可以在容器中运行。\n\n联系与区别：\n- 它们都是由Treasure Data公司开发的开源日志收集工具，具有类似的设计目标。\n- Fluent Bit更注重轻量级和高性能，适用于嵌入式和容器环境中的日志收集，而Fluentd则更适合处理大规模和复杂的数据流。\n- Fluent Bit的功能相对较少，专注于基本的日志收集、过滤和转发，而Fluentd具有更丰富的功能和插件生态系统。\n- Fluent Bit和Fluentd可以在同一系统中共存，实现多层次的日志收集和处理。\n\n总结：\nFluent Bit和Fluentd都是用于日志收集的工具，但根据应用场景和需求的不同，可以选择适合的工具。如果你需要一个轻量级的解决方案，以及在嵌入式设备和容器中高效收集和转发日志，可以选择Fluent Bit。而如果你面对复杂的数据流和需要更多功能和灵活性的场景，可以选择Fluentd。","source":"_posts/kubernetes/fluent_Bit_Fluentd.md","raw":"---\ntitle: Fluent Bit和Fluentd之间的联系及区别\ndate: 2023-08-24 16:13:26\ncategories:\n  - [kubernetes]\ntags: logging\n---\nFluent Bit和Fluentd是两个流行的开源日志收集工具，并且它们有一些共同的设计目标，但也有一些区别。\n\n1. Fluent Bit（轻量型的日志收集器）\nFluent Bit是一个轻量级和高性能的日志收集器，由Treasure Data公司开发。它专注于收集、过滤和转发日志，具有低内存占用和低性能开销的特点。Fluent Bit设计用于嵌入式系统和容器环境中，可以作为提供日志数据的终端。\n\n使用场景：\n- IoT设备：Fluent Bit作为嵌入式日志收集器，适用于在资源有限的物联网设备上收集日志数据。\n- 容器环境：Fluent Bit能够与Docker等容器平台无缝集成，并快速收集、聚合和转发容器日志。\n- 边缘计算：部署在边缘节点的Fluent Bit能够实时收集和传输边缘设备上的日志数据。\n\n使用方式：\n- 配置管理：通过配置文件定义输入源、过滤规则和输出目标。\n- 轻量级部署：由于其低资源消耗，Fluent Bit适合在嵌入式设备和容器中部署。\n- 插件支持：提供多种插件，如输入、过滤和输出插件，可根据需求扩展功能。\n\n2. Fluentd（全能型的日志收集引擎）\nFluentd是一个功能强大的开源日志收集和流数据处理引擎，也是由Treasure Data公司开发。它设计用于处理大规模和复杂的数据流，提供了更丰富的功能和灵活性。\n\n使用场景：\n- 日志聚合：收集来自多个源（文件、系统日志、应用程序日志等）的日志数据，并将其聚合到一处进行分析和存储。\n- 实时大数据处理：通过Fluentd的插件生态系统，可以将数据发送到Hadoop、Elasticsearch等数据处理和存储平台。\n- 日志路由和转换：Fluentd支持对日志数据进行过滤、标准化和转换，以便在不同目标之间进行路由。\n\n使用方式：\n- 插件生态系统：拥有丰富的插件生态系统，可用于收集、处理和转发各种类型的数据。\n- 高度可配置：通过配置文件进行配置，可以定义输入源、过滤器和输出目标，并自定义数据流的处理逻辑。\n- 部署灵活：Fluentd可以以独立进程或守护进程的形式部署，也可以在容器中运行。\n\n联系与区别：\n- 它们都是由Treasure Data公司开发的开源日志收集工具，具有类似的设计目标。\n- Fluent Bit更注重轻量级和高性能，适用于嵌入式和容器环境中的日志收集，而Fluentd则更适合处理大规模和复杂的数据流。\n- Fluent Bit的功能相对较少，专注于基本的日志收集、过滤和转发，而Fluentd具有更丰富的功能和插件生态系统。\n- Fluent Bit和Fluentd可以在同一系统中共存，实现多层次的日志收集和处理。\n\n总结：\nFluent Bit和Fluentd都是用于日志收集的工具，但根据应用场景和需求的不同，可以选择适合的工具。如果你需要一个轻量级的解决方案，以及在嵌入式设备和容器中高效收集和转发日志，可以选择Fluent Bit。而如果你面对复杂的数据流和需要更多功能和灵活性的场景，可以选择Fluentd。","slug":"kubernetes/fluent_Bit_Fluentd","published":1,"updated":"2023-08-24T08:14:42.291Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clo89v5ek000kb7jxcqw0313i","content":"<p>Fluent Bit和Fluentd是两个流行的开源日志收集工具，并且它们有一些共同的设计目标，但也有一些区别。</p>\n<ol>\n<li>Fluent Bit（轻量型的日志收集器）<br>Fluent Bit是一个轻量级和高性能的日志收集器，由Treasure Data公司开发。它专注于收集、过滤和转发日志，具有低内存占用和低性能开销的特点。Fluent Bit设计用于嵌入式系统和容器环境中，可以作为提供日志数据的终端。</li>\n</ol>\n<p>使用场景：</p>\n<ul>\n<li>IoT设备：Fluent Bit作为嵌入式日志收集器，适用于在资源有限的物联网设备上收集日志数据。</li>\n<li>容器环境：Fluent Bit能够与Docker等容器平台无缝集成，并快速收集、聚合和转发容器日志。</li>\n<li>边缘计算：部署在边缘节点的Fluent Bit能够实时收集和传输边缘设备上的日志数据。</li>\n</ul>\n<p>使用方式：</p>\n<ul>\n<li>配置管理：通过配置文件定义输入源、过滤规则和输出目标。</li>\n<li>轻量级部署：由于其低资源消耗，Fluent Bit适合在嵌入式设备和容器中部署。</li>\n<li>插件支持：提供多种插件，如输入、过滤和输出插件，可根据需求扩展功能。</li>\n</ul>\n<ol start=\"2\">\n<li>Fluentd（全能型的日志收集引擎）<br>Fluentd是一个功能强大的开源日志收集和流数据处理引擎，也是由Treasure Data公司开发。它设计用于处理大规模和复杂的数据流，提供了更丰富的功能和灵活性。</li>\n</ol>\n<p>使用场景：</p>\n<ul>\n<li>日志聚合：收集来自多个源（文件、系统日志、应用程序日志等）的日志数据，并将其聚合到一处进行分析和存储。</li>\n<li>实时大数据处理：通过Fluentd的插件生态系统，可以将数据发送到Hadoop、Elasticsearch等数据处理和存储平台。</li>\n<li>日志路由和转换：Fluentd支持对日志数据进行过滤、标准化和转换，以便在不同目标之间进行路由。</li>\n</ul>\n<p>使用方式：</p>\n<ul>\n<li>插件生态系统：拥有丰富的插件生态系统，可用于收集、处理和转发各种类型的数据。</li>\n<li>高度可配置：通过配置文件进行配置，可以定义输入源、过滤器和输出目标，并自定义数据流的处理逻辑。</li>\n<li>部署灵活：Fluentd可以以独立进程或守护进程的形式部署，也可以在容器中运行。</li>\n</ul>\n<p>联系与区别：</p>\n<ul>\n<li>它们都是由Treasure Data公司开发的开源日志收集工具，具有类似的设计目标。</li>\n<li>Fluent Bit更注重轻量级和高性能，适用于嵌入式和容器环境中的日志收集，而Fluentd则更适合处理大规模和复杂的数据流。</li>\n<li>Fluent Bit的功能相对较少，专注于基本的日志收集、过滤和转发，而Fluentd具有更丰富的功能和插件生态系统。</li>\n<li>Fluent Bit和Fluentd可以在同一系统中共存，实现多层次的日志收集和处理。</li>\n</ul>\n<p>总结：<br>Fluent Bit和Fluentd都是用于日志收集的工具，但根据应用场景和需求的不同，可以选择适合的工具。如果你需要一个轻量级的解决方案，以及在嵌入式设备和容器中高效收集和转发日志，可以选择Fluent Bit。而如果你面对复杂的数据流和需要更多功能和灵活性的场景，可以选择Fluentd。</p>\n","site":{"data":{"link":[{"class_name":"友情鏈接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、簡單且強大的網誌框架"}]},{"class_name":"網站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":false,"excerpt":"","more":"<p>Fluent Bit和Fluentd是两个流行的开源日志收集工具，并且它们有一些共同的设计目标，但也有一些区别。</p>\n<ol>\n<li>Fluent Bit（轻量型的日志收集器）<br>Fluent Bit是一个轻量级和高性能的日志收集器，由Treasure Data公司开发。它专注于收集、过滤和转发日志，具有低内存占用和低性能开销的特点。Fluent Bit设计用于嵌入式系统和容器环境中，可以作为提供日志数据的终端。</li>\n</ol>\n<p>使用场景：</p>\n<ul>\n<li>IoT设备：Fluent Bit作为嵌入式日志收集器，适用于在资源有限的物联网设备上收集日志数据。</li>\n<li>容器环境：Fluent Bit能够与Docker等容器平台无缝集成，并快速收集、聚合和转发容器日志。</li>\n<li>边缘计算：部署在边缘节点的Fluent Bit能够实时收集和传输边缘设备上的日志数据。</li>\n</ul>\n<p>使用方式：</p>\n<ul>\n<li>配置管理：通过配置文件定义输入源、过滤规则和输出目标。</li>\n<li>轻量级部署：由于其低资源消耗，Fluent Bit适合在嵌入式设备和容器中部署。</li>\n<li>插件支持：提供多种插件，如输入、过滤和输出插件，可根据需求扩展功能。</li>\n</ul>\n<ol start=\"2\">\n<li>Fluentd（全能型的日志收集引擎）<br>Fluentd是一个功能强大的开源日志收集和流数据处理引擎，也是由Treasure Data公司开发。它设计用于处理大规模和复杂的数据流，提供了更丰富的功能和灵活性。</li>\n</ol>\n<p>使用场景：</p>\n<ul>\n<li>日志聚合：收集来自多个源（文件、系统日志、应用程序日志等）的日志数据，并将其聚合到一处进行分析和存储。</li>\n<li>实时大数据处理：通过Fluentd的插件生态系统，可以将数据发送到Hadoop、Elasticsearch等数据处理和存储平台。</li>\n<li>日志路由和转换：Fluentd支持对日志数据进行过滤、标准化和转换，以便在不同目标之间进行路由。</li>\n</ul>\n<p>使用方式：</p>\n<ul>\n<li>插件生态系统：拥有丰富的插件生态系统，可用于收集、处理和转发各种类型的数据。</li>\n<li>高度可配置：通过配置文件进行配置，可以定义输入源、过滤器和输出目标，并自定义数据流的处理逻辑。</li>\n<li>部署灵活：Fluentd可以以独立进程或守护进程的形式部署，也可以在容器中运行。</li>\n</ul>\n<p>联系与区别：</p>\n<ul>\n<li>它们都是由Treasure Data公司开发的开源日志收集工具，具有类似的设计目标。</li>\n<li>Fluent Bit更注重轻量级和高性能，适用于嵌入式和容器环境中的日志收集，而Fluentd则更适合处理大规模和复杂的数据流。</li>\n<li>Fluent Bit的功能相对较少，专注于基本的日志收集、过滤和转发，而Fluentd具有更丰富的功能和插件生态系统。</li>\n<li>Fluent Bit和Fluentd可以在同一系统中共存，实现多层次的日志收集和处理。</li>\n</ul>\n<p>总结：<br>Fluent Bit和Fluentd都是用于日志收集的工具，但根据应用场景和需求的不同，可以选择适合的工具。如果你需要一个轻量级的解决方案，以及在嵌入式设备和容器中高效收集和转发日志，可以选择Fluent Bit。而如果你面对复杂的数据流和需要更多功能和灵活性的场景，可以选择Fluentd。</p>\n"},{"title":"grafana how to create alert rule","date":"2023-08-31T09:08:54.000Z","_content":"# 1. 部署grafana的配置文件修改\n\n因为要采用发送邮件的方式通知告警内容所以，在部署grafana时要先配置好SMTP / Emailing的内容：\n\n```\n    [smtp]\n    enabled = true # 开启smtp\n    host = smtp.mxhichina.com:465  #设置邮箱服务器地址\n    user = test@test.com  #设置邮箱用户\n    password = test123456 #设置邮箱密码或授权码\n    from_address = test@test.com #设置邮箱发送方地址\n    from_name = Grafana #设置邮箱发送name\n```\n\n# 2. 配置contact points(告警通道)\n\n使用contact points定义在告警发生时如何通知联系人。包括创建message template和contact points。\n\n## 2.1 创建message template(消息模板)\n\ngrafana的消息模板基于go语言的模板系统。如下模板数据表列出了可用于模板的变量\n\n| Name | Type | Notes |\n| --- | --- | --- |\n| Receiver | string | Name of the contact point that the notification is being sent to. |\n| Status | string | `firing` if at least one alert is firing, otherwise `resolved`. |\n| Alerts | Alert | List of alert objects that are included in this notification (see below). |\n| GroupLabels | KeyValue | Labels these alerts were grouped by. |\n| CommonLabels | KeyValue | Labels common to all the alerts included in this notification. |\n| CommonAnnotations | KeyValue | Annotations common to all the alerts included in this notification. |\n| ExternalURL | string | Back link to the Grafana that sent the notification. If using external Alertmanager, back link to this Alertmanager. |\n\nAlerts类型是一个过滤告警的函数：\n\n- `Alerts.Firing` returns a list of firing alerts.\n- `Alerts.Resolved` returns a list of resolved alerts.\n\n![template](https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/grafana/create-message-template.png)\n\ndefine用来设置模板名，是可选的，如果不设置默认采用Template name,最佳实践时与Template name 保持一致。\n\n## 2.2 创建 contact point\n\n![point](https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/grafana/create-contact-point.png)\n\n创建name和不同类型的contact，包括邮箱，钉钉等，同一个name下可以添加多个contact。详细说一下邮箱类型的tact：\n\n- Addresses: 接收通知的邮件地址，可以写多个，用英文分号（;)隔开。\n  \n- Single email: 勾选表示发送一个邮件给所有的接受者。\n  \n- message: 可以通过模板变量引用前面创建的模板：\n  \n  ```\n  {{template \"alert message\" .}}\n  ```\n  \n- Disable resloved message: 是否关闭告警解决通知。\n  \n\n# 3. 创建通知策略（Notification policies）\n\n通知策略通过label配置告警，通知指定 contact point设置接收告警通知的对象。\n\n![np](https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/grafana/n-p.png)\n\n- matching labels： 添加指定的匹配label用于匹配alerts。\n  \n- contact point: 设置创建好的指定的contact point.\n  \n- Continue matching subsequent sibling nodes: 是否继续匹配嵌套策略。\n  \n- Override grouping：是一种告警策略设置，可用于覆盖默认的告警分组工作方式。默认情况下，Grafana根据告警规则的标签对告警进行分组。但是，对于某些特殊情况，用户可能希望以不同的方式进行告警分组，这时就可以使用Override grouping来实现。\n  \n  使用Override grouping，用户可以通过自定义指标和筛选条件来定义告警的分组方式。这样可以根据特定的业务需求，将相关的告警归为一组，便于在仪表盘中统一管理和查看。\n  \n  Override grouping的设置涉及以下几个重要的概念：\n  \n  1. 可聚合的字段：定义用于分组的字段，可以是任意的标签或指标。\n  2. 聚合器：确定了要使用哪种方法来聚合分组，如平均值、最大值、最小值等。\n  3. 时间范围：告警分组的时间范围，可以是一个固定的时间段或相对于当前时间的一段时间。\n  \n  用户可以根据具体情况选择合适的聚合字段、聚合器和时间范围来定义告警的分组方式。通过Override grouping，用户可以更加灵活地管理和控制告警的分组行为，从而更好地满足业务需求。\n  \n- Override general timings（覆盖一般定时）：用来覆盖通用的重复和间隔定时。\n  \n  具体来说，Grafana的告警策略中，可以设置一个重复间隔时间（Repeat interval），用于确定告警规则检查条件的重复间隔。默认情况下，这个间隔会使用Grafana的全局设置。\n  \n  然而，有时候我们希望针对特定的告警规则使用不同的重复间隔时间，这就可以使用Override general timings（覆盖一般定时）来实现。通过勾选此选项，并设置相应的重复间隔时间，可以覆盖全局设置，使特定的告警规则使用不同的重复间隔时间。\n  \n  这样做的好处是，可以根据特定的告警规则的需求，灵活地定义重复间隔时间，以更加精确和准确地监控和警告系统的状态变化。这对于保证系统的稳定性、性能和安全性非常有帮助。\n  \n  1. Group wait: 为传入警报创建的新组发送初始通知之前的等待时间。\n    \n  2. Group interval: 发送第一个通知后为该组发送一批新警报的等待时间。\n    \n  3. Repeat interval: 成功发送警报后重新发送警报的等待时间。\n    \n\n# 4. 创建告警规则（rule)\n\nrule有三种类型：\n\n- Cortex or Loki managed alerting rule：创建由Cortex或者Loki管理的rule；需要对Prometheus或者其他数据源有读写权限。\n  \n  Cortex和Loki都是与Grafana密切相关的工具。\n  \n  Cortex是一个可扩展、多租户、分布式的时间序列数据库。它能够接收和存储大规模的指标数据，并提供高速查询、聚合和处理数据的能力。Cortex的设计目标是能够处理海量的时间序列数据，并且具有可水平扩展性和高可用性。Cortex允许用户通过内置的查询语言PromQL来查询和分析指标数据，并支持数据的可视化和报表功能。Cortex还提供了横向扩展的能力，可以轻松地增加存储容量和查询吞吐量。因此，Cortex适用于大规模监控系统中需要存储和查询大量指标数据的场景。\n  \n  Loki是一个用于日志聚合和存储的系统。它可以接收多个来源的日志数据，并将它们存储为可搜索和可查询的格式。与传统的日志存储系统相比，Loki采用了一种高效的存储和索引方法，可以充分利用现代存储技术和硬件，以提供更高的性能和可扩展性。Loki支持使用标准的日志查询语言PromQL来查询和分析日志数据，并且与Cortex集成，可以实现和指标数据的混合查询和分析。此外，Loki还提供了强大的数据可视化和报表功能，可以方便地展示和监控系统的日志信息。\n  \n  综上所述，Cortex和Loki是Grafana监控和可视化平台的两个重要组成部分。Cortex用于存储和查询大规模的指标数据，而Loki则用于存储和查询系统的日志数据。它们都具有高性能、可扩展性和易于使用的特点，能够满足大规模监控系统中对指标和日志数据的存储、查询和分析需求。\n  \n- Cortex or Loki managed recording rule：创建recording类型的rule。\n  \n- Grafana managed alerting rule：创建grafana管理的告警规则，我们主要介绍这个类型的规则。\n  \n\n## 4.2 Grafana managed alerting rule\n\n![](https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/grafana/create-rule-1.png)\n\n- rule name: 告警规则名。\n  \n- rule type: 告警规则类型。\n  \n- Folder: 选择所属的Folder。\n  \n- 创建告警规则语句：\n  \n  1. 选择数据源为Prometheus\n    \n  2. 查询展示的最近10分钟的数据。\n    \n  3. Metrics browser: 设定数据查询的语句使用PromQL语法。\n    \n  4. Legend: 根据查询出的数据变量设置显示指标名。\n    \n  5. Min step: 最小步长表示图形里每两个点的最小数据间隔是多少，例如：这里我设置了 200，那表示图形上每隔 200 个单位才会有一个点。\n    \n  6. Resolution： 这表示其数据精度是怎样的，是 1 比 1 的精度，还是原有的 1/2，还是 1/3 等等。如果是 1/2 的话，那么就是原本 1 个单位显示一个点，现在 2 个单位合并起来显示成一个点了，那么其精度就变低了。\n    \n  7. Format： 表示你的数据格式是什么，这里有：Time series、Table、Heap Map 三个选项。Time series 表示是时间序列数据，即随着时间的流动有源源不断的数据。Table 表示是一个表格数据。Heap Map 表示是热力图数据。\n    \n    1. instant: 勾选时查询只在指定的单个时间点上执行，这对于需要聚合或对单个时间点数据感兴趣的场景非常有用。面板的时间选择器将被禁用，因为查询仅在一个固定时间点上执行。不勾选时：查询将返回一个时间范围内的数据，这对于需要在一段时间内进行数据分析或比较的情况非常有用。面板的时间选择器将启用，可以选择查询的时间范围。\n\n    ![](https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/grafana/create-rule-2.png)\n      \n    \n    创建Expression（表达式）：\n      \n    - classic condition:\n        \n        1. `avg()`: 用于计算一段时间内的平均值。适用于告警需要基于平均值的场景。例如，如果需要在CPU平均负载超过阈值时触发告警，可以使用`avg()`函数。\n          \n        2. `last()`: 用于获取时间段内最后一个数据点的值。适用于告警需要基于最后一个数据点的场景。例如，如果需要在最后一个数据点超过阈值时触发告警，可以使用`last()`函数。\n          \n        3. `max()`: 用于计算一段时间内的最大值。适用于告警需要基于最大值的场景。例如，如果需要在CPU负载的最大值超过阈值时触发告警，可以使用`max()`函数。\n          \n        4. `min()`: 用于计算一段时间内的最小值。适用于告警需要基于最小值的场景。例如，如果需要在CPU负载的最小值低于阈值时触发告警，可以使用`min()`函数。\n          \n        5. `sum()`: 用于计算一段时间内的总和。适用于告警需要基于总和的场景。例如，如果需要在一段时间内的请求数总和超过阈值时触发告警，可以使用`sum()`函数。\n          \n        6. `count()`: 用于计算一段时间内的数据点数量。适用于告警需要基于数据点数量的场景。例如，如果需要在一段时间内的请求数量超过阈值时触发告警，可以使用`count()`函数。\n          \n        \n      \n      Define alert conditions: 定义告警状态：\n      \n      - condition: 选择基于哪个query或者表达式进行告警。\n        \n      - Evaluate: 设置多久评估一次告警条件，\n        \n      - For： 满足条件持续多久触发告警，改变告警状态到firing.\n        \n      - Configure no data and error handling: 设定无数错和错误处理：\n        \n        | No Data Option | Description |\n        | --- | --- |\n        | No Data | Create a new alert `DatasourceNoData` with the name and UID of the alert rule, and UID of the datasource that returned no data as labels. |\n        | Alerting | Set alert rule state to `Alerting`. |\n        | Ok  | Set alert rule state to `Normal`. |\n        \n        | Error or timeout option | Description |\n        | --- | --- |\n        | Alerting | Set alert rule state to `Alerting` |\n        | OK  | Set alert rule state to `Normal` |\n        | Error | Create a new alert `DatasourceError` with the name and UID of the alert rule, and UID of the datasource that returned no data as labels. |\n        \n      \n      Add details for your alert： 添加其他额外的alert信息。","source":"_posts/kubernetes/grafana-create-alert-rule.md","raw":"---\ntitle: grafana how to create alert rule\ndate: 2023-08-31 17:08:54\ncategories:\n  - [kubernetes]\ntags: grafana\n---\n# 1. 部署grafana的配置文件修改\n\n因为要采用发送邮件的方式通知告警内容所以，在部署grafana时要先配置好SMTP / Emailing的内容：\n\n```\n    [smtp]\n    enabled = true # 开启smtp\n    host = smtp.mxhichina.com:465  #设置邮箱服务器地址\n    user = test@test.com  #设置邮箱用户\n    password = test123456 #设置邮箱密码或授权码\n    from_address = test@test.com #设置邮箱发送方地址\n    from_name = Grafana #设置邮箱发送name\n```\n\n# 2. 配置contact points(告警通道)\n\n使用contact points定义在告警发生时如何通知联系人。包括创建message template和contact points。\n\n## 2.1 创建message template(消息模板)\n\ngrafana的消息模板基于go语言的模板系统。如下模板数据表列出了可用于模板的变量\n\n| Name | Type | Notes |\n| --- | --- | --- |\n| Receiver | string | Name of the contact point that the notification is being sent to. |\n| Status | string | `firing` if at least one alert is firing, otherwise `resolved`. |\n| Alerts | Alert | List of alert objects that are included in this notification (see below). |\n| GroupLabels | KeyValue | Labels these alerts were grouped by. |\n| CommonLabels | KeyValue | Labels common to all the alerts included in this notification. |\n| CommonAnnotations | KeyValue | Annotations common to all the alerts included in this notification. |\n| ExternalURL | string | Back link to the Grafana that sent the notification. If using external Alertmanager, back link to this Alertmanager. |\n\nAlerts类型是一个过滤告警的函数：\n\n- `Alerts.Firing` returns a list of firing alerts.\n- `Alerts.Resolved` returns a list of resolved alerts.\n\n![template](https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/grafana/create-message-template.png)\n\ndefine用来设置模板名，是可选的，如果不设置默认采用Template name,最佳实践时与Template name 保持一致。\n\n## 2.2 创建 contact point\n\n![point](https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/grafana/create-contact-point.png)\n\n创建name和不同类型的contact，包括邮箱，钉钉等，同一个name下可以添加多个contact。详细说一下邮箱类型的tact：\n\n- Addresses: 接收通知的邮件地址，可以写多个，用英文分号（;)隔开。\n  \n- Single email: 勾选表示发送一个邮件给所有的接受者。\n  \n- message: 可以通过模板变量引用前面创建的模板：\n  \n  ```\n  {{template \"alert message\" .}}\n  ```\n  \n- Disable resloved message: 是否关闭告警解决通知。\n  \n\n# 3. 创建通知策略（Notification policies）\n\n通知策略通过label配置告警，通知指定 contact point设置接收告警通知的对象。\n\n![np](https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/grafana/n-p.png)\n\n- matching labels： 添加指定的匹配label用于匹配alerts。\n  \n- contact point: 设置创建好的指定的contact point.\n  \n- Continue matching subsequent sibling nodes: 是否继续匹配嵌套策略。\n  \n- Override grouping：是一种告警策略设置，可用于覆盖默认的告警分组工作方式。默认情况下，Grafana根据告警规则的标签对告警进行分组。但是，对于某些特殊情况，用户可能希望以不同的方式进行告警分组，这时就可以使用Override grouping来实现。\n  \n  使用Override grouping，用户可以通过自定义指标和筛选条件来定义告警的分组方式。这样可以根据特定的业务需求，将相关的告警归为一组，便于在仪表盘中统一管理和查看。\n  \n  Override grouping的设置涉及以下几个重要的概念：\n  \n  1. 可聚合的字段：定义用于分组的字段，可以是任意的标签或指标。\n  2. 聚合器：确定了要使用哪种方法来聚合分组，如平均值、最大值、最小值等。\n  3. 时间范围：告警分组的时间范围，可以是一个固定的时间段或相对于当前时间的一段时间。\n  \n  用户可以根据具体情况选择合适的聚合字段、聚合器和时间范围来定义告警的分组方式。通过Override grouping，用户可以更加灵活地管理和控制告警的分组行为，从而更好地满足业务需求。\n  \n- Override general timings（覆盖一般定时）：用来覆盖通用的重复和间隔定时。\n  \n  具体来说，Grafana的告警策略中，可以设置一个重复间隔时间（Repeat interval），用于确定告警规则检查条件的重复间隔。默认情况下，这个间隔会使用Grafana的全局设置。\n  \n  然而，有时候我们希望针对特定的告警规则使用不同的重复间隔时间，这就可以使用Override general timings（覆盖一般定时）来实现。通过勾选此选项，并设置相应的重复间隔时间，可以覆盖全局设置，使特定的告警规则使用不同的重复间隔时间。\n  \n  这样做的好处是，可以根据特定的告警规则的需求，灵活地定义重复间隔时间，以更加精确和准确地监控和警告系统的状态变化。这对于保证系统的稳定性、性能和安全性非常有帮助。\n  \n  1. Group wait: 为传入警报创建的新组发送初始通知之前的等待时间。\n    \n  2. Group interval: 发送第一个通知后为该组发送一批新警报的等待时间。\n    \n  3. Repeat interval: 成功发送警报后重新发送警报的等待时间。\n    \n\n# 4. 创建告警规则（rule)\n\nrule有三种类型：\n\n- Cortex or Loki managed alerting rule：创建由Cortex或者Loki管理的rule；需要对Prometheus或者其他数据源有读写权限。\n  \n  Cortex和Loki都是与Grafana密切相关的工具。\n  \n  Cortex是一个可扩展、多租户、分布式的时间序列数据库。它能够接收和存储大规模的指标数据，并提供高速查询、聚合和处理数据的能力。Cortex的设计目标是能够处理海量的时间序列数据，并且具有可水平扩展性和高可用性。Cortex允许用户通过内置的查询语言PromQL来查询和分析指标数据，并支持数据的可视化和报表功能。Cortex还提供了横向扩展的能力，可以轻松地增加存储容量和查询吞吐量。因此，Cortex适用于大规模监控系统中需要存储和查询大量指标数据的场景。\n  \n  Loki是一个用于日志聚合和存储的系统。它可以接收多个来源的日志数据，并将它们存储为可搜索和可查询的格式。与传统的日志存储系统相比，Loki采用了一种高效的存储和索引方法，可以充分利用现代存储技术和硬件，以提供更高的性能和可扩展性。Loki支持使用标准的日志查询语言PromQL来查询和分析日志数据，并且与Cortex集成，可以实现和指标数据的混合查询和分析。此外，Loki还提供了强大的数据可视化和报表功能，可以方便地展示和监控系统的日志信息。\n  \n  综上所述，Cortex和Loki是Grafana监控和可视化平台的两个重要组成部分。Cortex用于存储和查询大规模的指标数据，而Loki则用于存储和查询系统的日志数据。它们都具有高性能、可扩展性和易于使用的特点，能够满足大规模监控系统中对指标和日志数据的存储、查询和分析需求。\n  \n- Cortex or Loki managed recording rule：创建recording类型的rule。\n  \n- Grafana managed alerting rule：创建grafana管理的告警规则，我们主要介绍这个类型的规则。\n  \n\n## 4.2 Grafana managed alerting rule\n\n![](https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/grafana/create-rule-1.png)\n\n- rule name: 告警规则名。\n  \n- rule type: 告警规则类型。\n  \n- Folder: 选择所属的Folder。\n  \n- 创建告警规则语句：\n  \n  1. 选择数据源为Prometheus\n    \n  2. 查询展示的最近10分钟的数据。\n    \n  3. Metrics browser: 设定数据查询的语句使用PromQL语法。\n    \n  4. Legend: 根据查询出的数据变量设置显示指标名。\n    \n  5. Min step: 最小步长表示图形里每两个点的最小数据间隔是多少，例如：这里我设置了 200，那表示图形上每隔 200 个单位才会有一个点。\n    \n  6. Resolution： 这表示其数据精度是怎样的，是 1 比 1 的精度，还是原有的 1/2，还是 1/3 等等。如果是 1/2 的话，那么就是原本 1 个单位显示一个点，现在 2 个单位合并起来显示成一个点了，那么其精度就变低了。\n    \n  7. Format： 表示你的数据格式是什么，这里有：Time series、Table、Heap Map 三个选项。Time series 表示是时间序列数据，即随着时间的流动有源源不断的数据。Table 表示是一个表格数据。Heap Map 表示是热力图数据。\n    \n    1. instant: 勾选时查询只在指定的单个时间点上执行，这对于需要聚合或对单个时间点数据感兴趣的场景非常有用。面板的时间选择器将被禁用，因为查询仅在一个固定时间点上执行。不勾选时：查询将返回一个时间范围内的数据，这对于需要在一段时间内进行数据分析或比较的情况非常有用。面板的时间选择器将启用，可以选择查询的时间范围。\n\n    ![](https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/grafana/create-rule-2.png)\n      \n    \n    创建Expression（表达式）：\n      \n    - classic condition:\n        \n        1. `avg()`: 用于计算一段时间内的平均值。适用于告警需要基于平均值的场景。例如，如果需要在CPU平均负载超过阈值时触发告警，可以使用`avg()`函数。\n          \n        2. `last()`: 用于获取时间段内最后一个数据点的值。适用于告警需要基于最后一个数据点的场景。例如，如果需要在最后一个数据点超过阈值时触发告警，可以使用`last()`函数。\n          \n        3. `max()`: 用于计算一段时间内的最大值。适用于告警需要基于最大值的场景。例如，如果需要在CPU负载的最大值超过阈值时触发告警，可以使用`max()`函数。\n          \n        4. `min()`: 用于计算一段时间内的最小值。适用于告警需要基于最小值的场景。例如，如果需要在CPU负载的最小值低于阈值时触发告警，可以使用`min()`函数。\n          \n        5. `sum()`: 用于计算一段时间内的总和。适用于告警需要基于总和的场景。例如，如果需要在一段时间内的请求数总和超过阈值时触发告警，可以使用`sum()`函数。\n          \n        6. `count()`: 用于计算一段时间内的数据点数量。适用于告警需要基于数据点数量的场景。例如，如果需要在一段时间内的请求数量超过阈值时触发告警，可以使用`count()`函数。\n          \n        \n      \n      Define alert conditions: 定义告警状态：\n      \n      - condition: 选择基于哪个query或者表达式进行告警。\n        \n      - Evaluate: 设置多久评估一次告警条件，\n        \n      - For： 满足条件持续多久触发告警，改变告警状态到firing.\n        \n      - Configure no data and error handling: 设定无数错和错误处理：\n        \n        | No Data Option | Description |\n        | --- | --- |\n        | No Data | Create a new alert `DatasourceNoData` with the name and UID of the alert rule, and UID of the datasource that returned no data as labels. |\n        | Alerting | Set alert rule state to `Alerting`. |\n        | Ok  | Set alert rule state to `Normal`. |\n        \n        | Error or timeout option | Description |\n        | --- | --- |\n        | Alerting | Set alert rule state to `Alerting` |\n        | OK  | Set alert rule state to `Normal` |\n        | Error | Create a new alert `DatasourceError` with the name and UID of the alert rule, and UID of the datasource that returned no data as labels. |\n        \n      \n      Add details for your alert： 添加其他额外的alert信息。","slug":"kubernetes/grafana-create-alert-rule","published":1,"updated":"2023-08-31T09:13:02.480Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clo89v5em000nb7jxh5auekrf","content":"<h1 id=\"1-部署grafana的配置文件修改\"><a href=\"#1-部署grafana的配置文件修改\" class=\"headerlink\" title=\"1. 部署grafana的配置文件修改\"></a>1. 部署grafana的配置文件修改</h1><p>因为要采用发送邮件的方式通知告警内容所以，在部署grafana时要先配置好SMTP &#x2F; Emailing的内容：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[smtp]</span><br><span class=\"line\">enabled = true # 开启smtp</span><br><span class=\"line\">host = smtp.mxhichina.com:465  #设置邮箱服务器地址</span><br><span class=\"line\">user = test@test.com  #设置邮箱用户</span><br><span class=\"line\">password = test123456 #设置邮箱密码或授权码</span><br><span class=\"line\">from_address = test@test.com #设置邮箱发送方地址</span><br><span class=\"line\">from_name = Grafana #设置邮箱发送name</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"2-配置contact-points-告警通道\"><a href=\"#2-配置contact-points-告警通道\" class=\"headerlink\" title=\"2. 配置contact points(告警通道)\"></a>2. 配置contact points(告警通道)</h1><p>使用contact points定义在告警发生时如何通知联系人。包括创建message template和contact points。</p>\n<h2 id=\"2-1-创建message-template-消息模板\"><a href=\"#2-1-创建message-template-消息模板\" class=\"headerlink\" title=\"2.1 创建message template(消息模板)\"></a>2.1 创建message template(消息模板)</h2><p>grafana的消息模板基于go语言的模板系统。如下模板数据表列出了可用于模板的变量</p>\n<table>\n<thead>\n<tr>\n<th>Name</th>\n<th>Type</th>\n<th>Notes</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Receiver</td>\n<td>string</td>\n<td>Name of the contact point that the notification is being sent to.</td>\n</tr>\n<tr>\n<td>Status</td>\n<td>string</td>\n<td><code>firing</code> if at least one alert is firing, otherwise <code>resolved</code>.</td>\n</tr>\n<tr>\n<td>Alerts</td>\n<td>Alert</td>\n<td>List of alert objects that are included in this notification (see below).</td>\n</tr>\n<tr>\n<td>GroupLabels</td>\n<td>KeyValue</td>\n<td>Labels these alerts were grouped by.</td>\n</tr>\n<tr>\n<td>CommonLabels</td>\n<td>KeyValue</td>\n<td>Labels common to all the alerts included in this notification.</td>\n</tr>\n<tr>\n<td>CommonAnnotations</td>\n<td>KeyValue</td>\n<td>Annotations common to all the alerts included in this notification.</td>\n</tr>\n<tr>\n<td>ExternalURL</td>\n<td>string</td>\n<td>Back link to the Grafana that sent the notification. If using external Alertmanager, back link to this Alertmanager.</td>\n</tr>\n</tbody></table>\n<p>Alerts类型是一个过滤告警的函数：</p>\n<ul>\n<li><code>Alerts.Firing</code> returns a list of firing alerts.</li>\n<li><code>Alerts.Resolved</code> returns a list of resolved alerts.</li>\n</ul>\n<p><img src=\"https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/grafana/create-message-template.png\" alt=\"template\"></p>\n<p>define用来设置模板名，是可选的，如果不设置默认采用Template name,最佳实践时与Template name 保持一致。</p>\n<h2 id=\"2-2-创建-contact-point\"><a href=\"#2-2-创建-contact-point\" class=\"headerlink\" title=\"2.2 创建 contact point\"></a>2.2 创建 contact point</h2><p><img src=\"https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/grafana/create-contact-point.png\" alt=\"point\"></p>\n<p>创建name和不同类型的contact，包括邮箱，钉钉等，同一个name下可以添加多个contact。详细说一下邮箱类型的tact：</p>\n<ul>\n<li><p>Addresses: 接收通知的邮件地址，可以写多个，用英文分号（;)隔开。</p>\n</li>\n<li><p>Single email: 勾选表示发送一个邮件给所有的接受者。</p>\n</li>\n<li><p>message: 可以通过模板变量引用前面创建的模板：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;template &quot;alert message&quot; .&#125;&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Disable resloved message: 是否关闭告警解决通知。</p>\n</li>\n</ul>\n<h1 id=\"3-创建通知策略（Notification-policies）\"><a href=\"#3-创建通知策略（Notification-policies）\" class=\"headerlink\" title=\"3. 创建通知策略（Notification policies）\"></a>3. 创建通知策略（Notification policies）</h1><p>通知策略通过label配置告警，通知指定 contact point设置接收告警通知的对象。</p>\n<p><img src=\"https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/grafana/n-p.png\" alt=\"np\"></p>\n<ul>\n<li><p>matching labels： 添加指定的匹配label用于匹配alerts。</p>\n</li>\n<li><p>contact point: 设置创建好的指定的contact point.</p>\n</li>\n<li><p>Continue matching subsequent sibling nodes: 是否继续匹配嵌套策略。</p>\n</li>\n<li><p>Override grouping：是一种告警策略设置，可用于覆盖默认的告警分组工作方式。默认情况下，Grafana根据告警规则的标签对告警进行分组。但是，对于某些特殊情况，用户可能希望以不同的方式进行告警分组，这时就可以使用Override grouping来实现。</p>\n<p>使用Override grouping，用户可以通过自定义指标和筛选条件来定义告警的分组方式。这样可以根据特定的业务需求，将相关的告警归为一组，便于在仪表盘中统一管理和查看。</p>\n<p>Override grouping的设置涉及以下几个重要的概念：</p>\n<ol>\n<li>可聚合的字段：定义用于分组的字段，可以是任意的标签或指标。</li>\n<li>聚合器：确定了要使用哪种方法来聚合分组，如平均值、最大值、最小值等。</li>\n<li>时间范围：告警分组的时间范围，可以是一个固定的时间段或相对于当前时间的一段时间。</li>\n</ol>\n<p>用户可以根据具体情况选择合适的聚合字段、聚合器和时间范围来定义告警的分组方式。通过Override grouping，用户可以更加灵活地管理和控制告警的分组行为，从而更好地满足业务需求。</p>\n</li>\n<li><p>Override general timings（覆盖一般定时）：用来覆盖通用的重复和间隔定时。</p>\n<p>具体来说，Grafana的告警策略中，可以设置一个重复间隔时间（Repeat interval），用于确定告警规则检查条件的重复间隔。默认情况下，这个间隔会使用Grafana的全局设置。</p>\n<p>然而，有时候我们希望针对特定的告警规则使用不同的重复间隔时间，这就可以使用Override general timings（覆盖一般定时）来实现。通过勾选此选项，并设置相应的重复间隔时间，可以覆盖全局设置，使特定的告警规则使用不同的重复间隔时间。</p>\n<p>这样做的好处是，可以根据特定的告警规则的需求，灵活地定义重复间隔时间，以更加精确和准确地监控和警告系统的状态变化。这对于保证系统的稳定性、性能和安全性非常有帮助。</p>\n<ol>\n<li><p>Group wait: 为传入警报创建的新组发送初始通知之前的等待时间。</p>\n</li>\n<li><p>Group interval: 发送第一个通知后为该组发送一批新警报的等待时间。</p>\n</li>\n<li><p>Repeat interval: 成功发送警报后重新发送警报的等待时间。</p>\n</li>\n</ol>\n</li>\n</ul>\n<h1 id=\"4-创建告警规则（rule\"><a href=\"#4-创建告警规则（rule\" class=\"headerlink\" title=\"4. 创建告警规则（rule)\"></a>4. 创建告警规则（rule)</h1><p>rule有三种类型：</p>\n<ul>\n<li><p>Cortex or Loki managed alerting rule：创建由Cortex或者Loki管理的rule；需要对Prometheus或者其他数据源有读写权限。</p>\n<p>Cortex和Loki都是与Grafana密切相关的工具。</p>\n<p>Cortex是一个可扩展、多租户、分布式的时间序列数据库。它能够接收和存储大规模的指标数据，并提供高速查询、聚合和处理数据的能力。Cortex的设计目标是能够处理海量的时间序列数据，并且具有可水平扩展性和高可用性。Cortex允许用户通过内置的查询语言PromQL来查询和分析指标数据，并支持数据的可视化和报表功能。Cortex还提供了横向扩展的能力，可以轻松地增加存储容量和查询吞吐量。因此，Cortex适用于大规模监控系统中需要存储和查询大量指标数据的场景。</p>\n<p>Loki是一个用于日志聚合和存储的系统。它可以接收多个来源的日志数据，并将它们存储为可搜索和可查询的格式。与传统的日志存储系统相比，Loki采用了一种高效的存储和索引方法，可以充分利用现代存储技术和硬件，以提供更高的性能和可扩展性。Loki支持使用标准的日志查询语言PromQL来查询和分析日志数据，并且与Cortex集成，可以实现和指标数据的混合查询和分析。此外，Loki还提供了强大的数据可视化和报表功能，可以方便地展示和监控系统的日志信息。</p>\n<p>综上所述，Cortex和Loki是Grafana监控和可视化平台的两个重要组成部分。Cortex用于存储和查询大规模的指标数据，而Loki则用于存储和查询系统的日志数据。它们都具有高性能、可扩展性和易于使用的特点，能够满足大规模监控系统中对指标和日志数据的存储、查询和分析需求。</p>\n</li>\n<li><p>Cortex or Loki managed recording rule：创建recording类型的rule。</p>\n</li>\n<li><p>Grafana managed alerting rule：创建grafana管理的告警规则，我们主要介绍这个类型的规则。</p>\n</li>\n</ul>\n<h2 id=\"4-2-Grafana-managed-alerting-rule\"><a href=\"#4-2-Grafana-managed-alerting-rule\" class=\"headerlink\" title=\"4.2 Grafana managed alerting rule\"></a>4.2 Grafana managed alerting rule</h2><p><img src=\"https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/grafana/create-rule-1.png\"></p>\n<ul>\n<li><p>rule name: 告警规则名。</p>\n</li>\n<li><p>rule type: 告警规则类型。</p>\n</li>\n<li><p>Folder: 选择所属的Folder。</p>\n</li>\n<li><p>创建告警规则语句：</p>\n<ol>\n<li><p>选择数据源为Prometheus</p>\n</li>\n<li><p>查询展示的最近10分钟的数据。</p>\n</li>\n<li><p>Metrics browser: 设定数据查询的语句使用PromQL语法。</p>\n</li>\n<li><p>Legend: 根据查询出的数据变量设置显示指标名。</p>\n</li>\n<li><p>Min step: 最小步长表示图形里每两个点的最小数据间隔是多少，例如：这里我设置了 200，那表示图形上每隔 200 个单位才会有一个点。</p>\n</li>\n<li><p>Resolution： 这表示其数据精度是怎样的，是 1 比 1 的精度，还是原有的 1&#x2F;2，还是 1&#x2F;3 等等。如果是 1&#x2F;2 的话，那么就是原本 1 个单位显示一个点，现在 2 个单位合并起来显示成一个点了，那么其精度就变低了。</p>\n</li>\n<li><p>Format： 表示你的数据格式是什么，这里有：Time series、Table、Heap Map 三个选项。Time series 表示是时间序列数据，即随着时间的流动有源源不断的数据。Table 表示是一个表格数据。Heap Map 表示是热力图数据。</p>\n</li>\n<li><p>instant: 勾选时查询只在指定的单个时间点上执行，这对于需要聚合或对单个时间点数据感兴趣的场景非常有用。面板的时间选择器将被禁用，因为查询仅在一个固定时间点上执行。不勾选时：查询将返回一个时间范围内的数据，这对于需要在一段时间内进行数据分析或比较的情况非常有用。面板的时间选择器将启用，可以选择查询的时间范围。</p>\n</li>\n</ol>\n<p>  <img src=\"https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/grafana/create-rule-2.png\"></p>\n<p>  创建Expression（表达式）：</p>\n<ul>\n<li><p>classic condition:</p>\n<ol>\n<li><p><code>avg()</code>: 用于计算一段时间内的平均值。适用于告警需要基于平均值的场景。例如，如果需要在CPU平均负载超过阈值时触发告警，可以使用<code>avg()</code>函数。</p>\n</li>\n<li><p><code>last()</code>: 用于获取时间段内最后一个数据点的值。适用于告警需要基于最后一个数据点的场景。例如，如果需要在最后一个数据点超过阈值时触发告警，可以使用<code>last()</code>函数。</p>\n</li>\n<li><p><code>max()</code>: 用于计算一段时间内的最大值。适用于告警需要基于最大值的场景。例如，如果需要在CPU负载的最大值超过阈值时触发告警，可以使用<code>max()</code>函数。</p>\n</li>\n<li><p><code>min()</code>: 用于计算一段时间内的最小值。适用于告警需要基于最小值的场景。例如，如果需要在CPU负载的最小值低于阈值时触发告警，可以使用<code>min()</code>函数。</p>\n</li>\n<li><p><code>sum()</code>: 用于计算一段时间内的总和。适用于告警需要基于总和的场景。例如，如果需要在一段时间内的请求数总和超过阈值时触发告警，可以使用<code>sum()</code>函数。</p>\n</li>\n<li><p><code>count()</code>: 用于计算一段时间内的数据点数量。适用于告警需要基于数据点数量的场景。例如，如果需要在一段时间内的请求数量超过阈值时触发告警，可以使用<code>count()</code>函数。</p>\n</li>\n</ol>\n<p>Define alert conditions: 定义告警状态：</p>\n<ul>\n<li><p>condition: 选择基于哪个query或者表达式进行告警。</p>\n</li>\n<li><p>Evaluate: 设置多久评估一次告警条件，</p>\n</li>\n<li><p>For： 满足条件持续多久触发告警，改变告警状态到firing.</p>\n</li>\n<li><p>Configure no data and error handling: 设定无数错和错误处理：</p>\n<table>\n<thead>\n<tr>\n<th>No Data Option</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>No Data</td>\n<td>Create a new alert <code>DatasourceNoData</code> with the name and UID of the alert rule, and UID of the datasource that returned no data as labels.</td>\n</tr>\n<tr>\n<td>Alerting</td>\n<td>Set alert rule state to <code>Alerting</code>.</td>\n</tr>\n<tr>\n<td>Ok</td>\n<td>Set alert rule state to <code>Normal</code>.</td>\n</tr>\n</tbody></table>\n<table>\n<thead>\n<tr>\n<th>Error or timeout option</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Alerting</td>\n<td>Set alert rule state to <code>Alerting</code></td>\n</tr>\n<tr>\n<td>OK</td>\n<td>Set alert rule state to <code>Normal</code></td>\n</tr>\n<tr>\n<td>Error</td>\n<td>Create a new alert <code>DatasourceError</code> with the name and UID of the alert rule, and UID of the datasource that returned no data as labels.</td>\n</tr>\n</tbody></table>\n</li>\n</ul>\n<p>Add details for your alert： 添加其他额外的alert信息。</p>\n</li>\n</ul>\n</li>\n</ul>\n","site":{"data":{"link":[{"class_name":"友情鏈接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、簡單且強大的網誌框架"}]},{"class_name":"網站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":false,"excerpt":"","more":"<h1 id=\"1-部署grafana的配置文件修改\"><a href=\"#1-部署grafana的配置文件修改\" class=\"headerlink\" title=\"1. 部署grafana的配置文件修改\"></a>1. 部署grafana的配置文件修改</h1><p>因为要采用发送邮件的方式通知告警内容所以，在部署grafana时要先配置好SMTP &#x2F; Emailing的内容：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[smtp]</span><br><span class=\"line\">enabled = true # 开启smtp</span><br><span class=\"line\">host = smtp.mxhichina.com:465  #设置邮箱服务器地址</span><br><span class=\"line\">user = test@test.com  #设置邮箱用户</span><br><span class=\"line\">password = test123456 #设置邮箱密码或授权码</span><br><span class=\"line\">from_address = test@test.com #设置邮箱发送方地址</span><br><span class=\"line\">from_name = Grafana #设置邮箱发送name</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"2-配置contact-points-告警通道\"><a href=\"#2-配置contact-points-告警通道\" class=\"headerlink\" title=\"2. 配置contact points(告警通道)\"></a>2. 配置contact points(告警通道)</h1><p>使用contact points定义在告警发生时如何通知联系人。包括创建message template和contact points。</p>\n<h2 id=\"2-1-创建message-template-消息模板\"><a href=\"#2-1-创建message-template-消息模板\" class=\"headerlink\" title=\"2.1 创建message template(消息模板)\"></a>2.1 创建message template(消息模板)</h2><p>grafana的消息模板基于go语言的模板系统。如下模板数据表列出了可用于模板的变量</p>\n<table>\n<thead>\n<tr>\n<th>Name</th>\n<th>Type</th>\n<th>Notes</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Receiver</td>\n<td>string</td>\n<td>Name of the contact point that the notification is being sent to.</td>\n</tr>\n<tr>\n<td>Status</td>\n<td>string</td>\n<td><code>firing</code> if at least one alert is firing, otherwise <code>resolved</code>.</td>\n</tr>\n<tr>\n<td>Alerts</td>\n<td>Alert</td>\n<td>List of alert objects that are included in this notification (see below).</td>\n</tr>\n<tr>\n<td>GroupLabels</td>\n<td>KeyValue</td>\n<td>Labels these alerts were grouped by.</td>\n</tr>\n<tr>\n<td>CommonLabels</td>\n<td>KeyValue</td>\n<td>Labels common to all the alerts included in this notification.</td>\n</tr>\n<tr>\n<td>CommonAnnotations</td>\n<td>KeyValue</td>\n<td>Annotations common to all the alerts included in this notification.</td>\n</tr>\n<tr>\n<td>ExternalURL</td>\n<td>string</td>\n<td>Back link to the Grafana that sent the notification. If using external Alertmanager, back link to this Alertmanager.</td>\n</tr>\n</tbody></table>\n<p>Alerts类型是一个过滤告警的函数：</p>\n<ul>\n<li><code>Alerts.Firing</code> returns a list of firing alerts.</li>\n<li><code>Alerts.Resolved</code> returns a list of resolved alerts.</li>\n</ul>\n<p><img src=\"https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/grafana/create-message-template.png\" alt=\"template\"></p>\n<p>define用来设置模板名，是可选的，如果不设置默认采用Template name,最佳实践时与Template name 保持一致。</p>\n<h2 id=\"2-2-创建-contact-point\"><a href=\"#2-2-创建-contact-point\" class=\"headerlink\" title=\"2.2 创建 contact point\"></a>2.2 创建 contact point</h2><p><img src=\"https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/grafana/create-contact-point.png\" alt=\"point\"></p>\n<p>创建name和不同类型的contact，包括邮箱，钉钉等，同一个name下可以添加多个contact。详细说一下邮箱类型的tact：</p>\n<ul>\n<li><p>Addresses: 接收通知的邮件地址，可以写多个，用英文分号（;)隔开。</p>\n</li>\n<li><p>Single email: 勾选表示发送一个邮件给所有的接受者。</p>\n</li>\n<li><p>message: 可以通过模板变量引用前面创建的模板：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;template &quot;alert message&quot; .&#125;&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Disable resloved message: 是否关闭告警解决通知。</p>\n</li>\n</ul>\n<h1 id=\"3-创建通知策略（Notification-policies）\"><a href=\"#3-创建通知策略（Notification-policies）\" class=\"headerlink\" title=\"3. 创建通知策略（Notification policies）\"></a>3. 创建通知策略（Notification policies）</h1><p>通知策略通过label配置告警，通知指定 contact point设置接收告警通知的对象。</p>\n<p><img src=\"https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/grafana/n-p.png\" alt=\"np\"></p>\n<ul>\n<li><p>matching labels： 添加指定的匹配label用于匹配alerts。</p>\n</li>\n<li><p>contact point: 设置创建好的指定的contact point.</p>\n</li>\n<li><p>Continue matching subsequent sibling nodes: 是否继续匹配嵌套策略。</p>\n</li>\n<li><p>Override grouping：是一种告警策略设置，可用于覆盖默认的告警分组工作方式。默认情况下，Grafana根据告警规则的标签对告警进行分组。但是，对于某些特殊情况，用户可能希望以不同的方式进行告警分组，这时就可以使用Override grouping来实现。</p>\n<p>使用Override grouping，用户可以通过自定义指标和筛选条件来定义告警的分组方式。这样可以根据特定的业务需求，将相关的告警归为一组，便于在仪表盘中统一管理和查看。</p>\n<p>Override grouping的设置涉及以下几个重要的概念：</p>\n<ol>\n<li>可聚合的字段：定义用于分组的字段，可以是任意的标签或指标。</li>\n<li>聚合器：确定了要使用哪种方法来聚合分组，如平均值、最大值、最小值等。</li>\n<li>时间范围：告警分组的时间范围，可以是一个固定的时间段或相对于当前时间的一段时间。</li>\n</ol>\n<p>用户可以根据具体情况选择合适的聚合字段、聚合器和时间范围来定义告警的分组方式。通过Override grouping，用户可以更加灵活地管理和控制告警的分组行为，从而更好地满足业务需求。</p>\n</li>\n<li><p>Override general timings（覆盖一般定时）：用来覆盖通用的重复和间隔定时。</p>\n<p>具体来说，Grafana的告警策略中，可以设置一个重复间隔时间（Repeat interval），用于确定告警规则检查条件的重复间隔。默认情况下，这个间隔会使用Grafana的全局设置。</p>\n<p>然而，有时候我们希望针对特定的告警规则使用不同的重复间隔时间，这就可以使用Override general timings（覆盖一般定时）来实现。通过勾选此选项，并设置相应的重复间隔时间，可以覆盖全局设置，使特定的告警规则使用不同的重复间隔时间。</p>\n<p>这样做的好处是，可以根据特定的告警规则的需求，灵活地定义重复间隔时间，以更加精确和准确地监控和警告系统的状态变化。这对于保证系统的稳定性、性能和安全性非常有帮助。</p>\n<ol>\n<li><p>Group wait: 为传入警报创建的新组发送初始通知之前的等待时间。</p>\n</li>\n<li><p>Group interval: 发送第一个通知后为该组发送一批新警报的等待时间。</p>\n</li>\n<li><p>Repeat interval: 成功发送警报后重新发送警报的等待时间。</p>\n</li>\n</ol>\n</li>\n</ul>\n<h1 id=\"4-创建告警规则（rule\"><a href=\"#4-创建告警规则（rule\" class=\"headerlink\" title=\"4. 创建告警规则（rule)\"></a>4. 创建告警规则（rule)</h1><p>rule有三种类型：</p>\n<ul>\n<li><p>Cortex or Loki managed alerting rule：创建由Cortex或者Loki管理的rule；需要对Prometheus或者其他数据源有读写权限。</p>\n<p>Cortex和Loki都是与Grafana密切相关的工具。</p>\n<p>Cortex是一个可扩展、多租户、分布式的时间序列数据库。它能够接收和存储大规模的指标数据，并提供高速查询、聚合和处理数据的能力。Cortex的设计目标是能够处理海量的时间序列数据，并且具有可水平扩展性和高可用性。Cortex允许用户通过内置的查询语言PromQL来查询和分析指标数据，并支持数据的可视化和报表功能。Cortex还提供了横向扩展的能力，可以轻松地增加存储容量和查询吞吐量。因此，Cortex适用于大规模监控系统中需要存储和查询大量指标数据的场景。</p>\n<p>Loki是一个用于日志聚合和存储的系统。它可以接收多个来源的日志数据，并将它们存储为可搜索和可查询的格式。与传统的日志存储系统相比，Loki采用了一种高效的存储和索引方法，可以充分利用现代存储技术和硬件，以提供更高的性能和可扩展性。Loki支持使用标准的日志查询语言PromQL来查询和分析日志数据，并且与Cortex集成，可以实现和指标数据的混合查询和分析。此外，Loki还提供了强大的数据可视化和报表功能，可以方便地展示和监控系统的日志信息。</p>\n<p>综上所述，Cortex和Loki是Grafana监控和可视化平台的两个重要组成部分。Cortex用于存储和查询大规模的指标数据，而Loki则用于存储和查询系统的日志数据。它们都具有高性能、可扩展性和易于使用的特点，能够满足大规模监控系统中对指标和日志数据的存储、查询和分析需求。</p>\n</li>\n<li><p>Cortex or Loki managed recording rule：创建recording类型的rule。</p>\n</li>\n<li><p>Grafana managed alerting rule：创建grafana管理的告警规则，我们主要介绍这个类型的规则。</p>\n</li>\n</ul>\n<h2 id=\"4-2-Grafana-managed-alerting-rule\"><a href=\"#4-2-Grafana-managed-alerting-rule\" class=\"headerlink\" title=\"4.2 Grafana managed alerting rule\"></a>4.2 Grafana managed alerting rule</h2><p><img src=\"https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/grafana/create-rule-1.png\"></p>\n<ul>\n<li><p>rule name: 告警规则名。</p>\n</li>\n<li><p>rule type: 告警规则类型。</p>\n</li>\n<li><p>Folder: 选择所属的Folder。</p>\n</li>\n<li><p>创建告警规则语句：</p>\n<ol>\n<li><p>选择数据源为Prometheus</p>\n</li>\n<li><p>查询展示的最近10分钟的数据。</p>\n</li>\n<li><p>Metrics browser: 设定数据查询的语句使用PromQL语法。</p>\n</li>\n<li><p>Legend: 根据查询出的数据变量设置显示指标名。</p>\n</li>\n<li><p>Min step: 最小步长表示图形里每两个点的最小数据间隔是多少，例如：这里我设置了 200，那表示图形上每隔 200 个单位才会有一个点。</p>\n</li>\n<li><p>Resolution： 这表示其数据精度是怎样的，是 1 比 1 的精度，还是原有的 1&#x2F;2，还是 1&#x2F;3 等等。如果是 1&#x2F;2 的话，那么就是原本 1 个单位显示一个点，现在 2 个单位合并起来显示成一个点了，那么其精度就变低了。</p>\n</li>\n<li><p>Format： 表示你的数据格式是什么，这里有：Time series、Table、Heap Map 三个选项。Time series 表示是时间序列数据，即随着时间的流动有源源不断的数据。Table 表示是一个表格数据。Heap Map 表示是热力图数据。</p>\n</li>\n<li><p>instant: 勾选时查询只在指定的单个时间点上执行，这对于需要聚合或对单个时间点数据感兴趣的场景非常有用。面板的时间选择器将被禁用，因为查询仅在一个固定时间点上执行。不勾选时：查询将返回一个时间范围内的数据，这对于需要在一段时间内进行数据分析或比较的情况非常有用。面板的时间选择器将启用，可以选择查询的时间范围。</p>\n</li>\n</ol>\n<p>  <img src=\"https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/grafana/create-rule-2.png\"></p>\n<p>  创建Expression（表达式）：</p>\n<ul>\n<li><p>classic condition:</p>\n<ol>\n<li><p><code>avg()</code>: 用于计算一段时间内的平均值。适用于告警需要基于平均值的场景。例如，如果需要在CPU平均负载超过阈值时触发告警，可以使用<code>avg()</code>函数。</p>\n</li>\n<li><p><code>last()</code>: 用于获取时间段内最后一个数据点的值。适用于告警需要基于最后一个数据点的场景。例如，如果需要在最后一个数据点超过阈值时触发告警，可以使用<code>last()</code>函数。</p>\n</li>\n<li><p><code>max()</code>: 用于计算一段时间内的最大值。适用于告警需要基于最大值的场景。例如，如果需要在CPU负载的最大值超过阈值时触发告警，可以使用<code>max()</code>函数。</p>\n</li>\n<li><p><code>min()</code>: 用于计算一段时间内的最小值。适用于告警需要基于最小值的场景。例如，如果需要在CPU负载的最小值低于阈值时触发告警，可以使用<code>min()</code>函数。</p>\n</li>\n<li><p><code>sum()</code>: 用于计算一段时间内的总和。适用于告警需要基于总和的场景。例如，如果需要在一段时间内的请求数总和超过阈值时触发告警，可以使用<code>sum()</code>函数。</p>\n</li>\n<li><p><code>count()</code>: 用于计算一段时间内的数据点数量。适用于告警需要基于数据点数量的场景。例如，如果需要在一段时间内的请求数量超过阈值时触发告警，可以使用<code>count()</code>函数。</p>\n</li>\n</ol>\n<p>Define alert conditions: 定义告警状态：</p>\n<ul>\n<li><p>condition: 选择基于哪个query或者表达式进行告警。</p>\n</li>\n<li><p>Evaluate: 设置多久评估一次告警条件，</p>\n</li>\n<li><p>For： 满足条件持续多久触发告警，改变告警状态到firing.</p>\n</li>\n<li><p>Configure no data and error handling: 设定无数错和错误处理：</p>\n<table>\n<thead>\n<tr>\n<th>No Data Option</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>No Data</td>\n<td>Create a new alert <code>DatasourceNoData</code> with the name and UID of the alert rule, and UID of the datasource that returned no data as labels.</td>\n</tr>\n<tr>\n<td>Alerting</td>\n<td>Set alert rule state to <code>Alerting</code>.</td>\n</tr>\n<tr>\n<td>Ok</td>\n<td>Set alert rule state to <code>Normal</code>.</td>\n</tr>\n</tbody></table>\n<table>\n<thead>\n<tr>\n<th>Error or timeout option</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Alerting</td>\n<td>Set alert rule state to <code>Alerting</code></td>\n</tr>\n<tr>\n<td>OK</td>\n<td>Set alert rule state to <code>Normal</code></td>\n</tr>\n<tr>\n<td>Error</td>\n<td>Create a new alert <code>DatasourceError</code> with the name and UID of the alert rule, and UID of the datasource that returned no data as labels.</td>\n</tr>\n</tbody></table>\n</li>\n</ul>\n<p>Add details for your alert： 添加其他额外的alert信息。</p>\n</li>\n</ul>\n</li>\n</ul>\n"},{"title":"kibana create ILM","date":"2023-09-05T08:14:39.000Z","_content":"# kibana设置ILM\n\n## 1. 背景\n\nkibana version: v7.9.3\n\n## 2. 设置ILM\n\n### 2.1 创建索引生命周期策略\n\n#### 2.1.1 热阶段\n\n首先需要先创建索引生命周期策略，在索引模板中可以引用创建好的索引生命周期策略。\n\n![](https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/kibana/ilm01.png)\n\n- 策略名称： 引用该策略是需要用，例如设置为：filebeat-index-ilm\n  \n- 最大索引大小：设置单个索引最大字节数，此处为50千兆字节，即50G.\n  \n- 最大文档数：设置单个索引所内容乃的最大文档数，超过该数则创建新的索引。\n  \n- 最大存在时间： 指的是索引在温热阶段中可以存在的最长时间。一旦索引达到这个时间限制，它将被自动转移到冷却阶段，并最终被归档或删除。\n  \n  \"最大存在时间\"是一个可选的参数，你可以根据实际需求来决定是否设置这个参数。如果你没有设置这个参数，索引将会一直保持在温热阶段，直到你手动将其转移到冷却阶段或删除。\n  \n  在设置\"最大存在时间\"时，你可以选择一个固定的时间长度，例如30天。这意味着索引在温热阶段中最多存在30天，之后它将被自动转移到冷却阶段。这个参数可以帮助你控制索引的生命周期，避免过多的旧索引占用存储空间和资源。\n  \n  需要注意的是，具体的索引生命周期策略还受到其他参数的影响，例如滚动布署的频率、索引模板、索引生命周期策略等。因此，在实际应用中，需要根据具体的业务需求和数据量来调整和优化这些参数。\n  \n\n#### 2.1.2 温阶段和冷阶段\n\n温阶段和冷阶段不再设置，解释一下这两个阶段：\n\n在 Kibana 中创建索引生命周期策略时，warm phase和Cold phase的存在有意义，它们适用于不同的场景。\n\n1. Warm phase（温阶段）：\n  Warm phase是索引生命周期的中间阶段，适用于处理活跃但不再频繁更改的数据。在这个阶段，索引被用于的搜索和查询操作较多，因此需要保持良好的搜索性能。在温阶段，索引可以被滚动更新，以保持其当前的索引结构、映射和设置。\n  \n  温阶段适用于以下场景：\n  \n  - 数据检索：如果您的应用程序需要从历史数据中检索信息，并且这些数据已经过了一段时间但仍然活跃，那么可以将索引设置为在温阶段。\n  - 数据归档和分析：如果您的应用程序需要将数据存储一段时间以便进行进一步的分析、报告或可视化，那么可以将索引设置为在温阶段。\n2. Cold phase（冷阶段）：\n  Cold phase是索引生命周期的后期阶段，适用于处理不再活跃的数据。在这个阶段，索引被用于的搜索和查询操作较少，因此可以降低存储成本和索引维护开销。在冷阶段，索引可以被归档和压缩，以进一步降低存储成本。\n  \n  冷阶段适用于以下场景：\n  \n  - 数据归档：如果您的应用程序需要长期存储数据，并且这些数据不再被频繁地搜索和查询，那么可以将索引设置为在冷阶段。\n  - 数据保留策略：如果您的应用程序需要保留某些数据一段时间后将其删除，那么可以将索引设置为在冷阶段，并在达到保留期限时自动删除索引。\n  \n  综上所述，温阶段和冷阶段的存在意义在于进一步优化索引生命周期的管理。通过将索引分阶段管理，可以更好地平衡性能、存储成本和维护开销，以满足不同的业务需求。\n  \n\n#### 2.1.3 删除阶段\n\n![](https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/kibana/ilm03.png)\n\n- 删除倒计时： 设置日志多久之后删除。\n  \n\n### 2.2 创建索引模板\n\n![](https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/kibana/index-template01.png)\n\n- 名称：索引模板名\n  \n- 索引模式： 用来匹配应用于哪些索引，例如匹配filebeat-开头的索引;filebeat-*\n  \n- 优先级：是一个整数值，用于确定索引模板的优先级。较高的优先级值表示该索引模板具有更高的优先级。当多个索引模板匹配到同一个索引时，优先级最高的索引模板将被应用。\n  \n- 版本：是一个整数值，用于跟踪索引模板的版本号。你可以根据需要为每个索引模板设置一个唯一的版本号。当索引模板需要更新时，你可以增加版本号以确保新版本的索引模板被应用。\n  \n- _meta 字段：_meta 字段是一个 JSON 对象，用于存储与索引模板相关的元数据。你可以在 _meta 字段中添加自定义的键值对，例如索引模板的创建时间、作者等信息。这些元数据可以在使用 Elasticsearch API 管理索引模板时进行访问和操作。\n  \n\n![](https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/kibana/index-template02.png)\n\n- 选择组件： 引用已经创建好的组件模板\n  \n\n![](https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/kibana/index-template03.png)\n\n- 索引设置: 图中设置了生命周期相关内容，lifecycle：指的就是索引的生命周期，这里就是我们之前创建的索引生命周期；rollover_alias：滚动别名，当我们配置了索引大小，超过这个大小后，会以这个名称命名。\n  \n\n1. 映射字段：  \n  映射字段是指将文档中的字段与特定的数据类型和属性进行映射。在创建索引模板时，可以手动添加映射字段，以便在索引文档时将字段映射为指定的数据类型和属性。例如，可以添加一个名为 \"message\" 的映射字段，将其映射为文本类型，并设置其分析器为 \"standard\"。\n\n映射字段适用于以下场景：\n\n- 数据类型已知且固定的场景：当文档中的字段类型固定且已知时，可以手动添加映射字段，以确保索引的准确性和性能。\n  \n- 需要自定义数据类型的场景：当文档中存在自定义的数据类型时，可以手动添加映射字段，并将其映射为相应的数据类型，以便在查询和聚合时能够正确地处理数据。\n  \n\n2. 动态模板：  \n  动态模板是指根据文档中的字段名、数据类型等动态地设定字段类型。在创建索引模板时，可以定义动态模板规则，以便根据文档的实际情况动态地设定字段类型。例如，可以定义一个名为 \"text\" 的动态模板，将所有以 \"message\" 开头的字段映射为文本类型。\n\n动态模板适用于以下场景：\n\n- 数据类型未知或动态变化的场景：当文档中的字段类型未知或动态变化时，可以使用动态模板来自动识别字段类型，并将其映射为相应的数据类型。\n  \n- 需要灵活处理不同数据类型的场景：当文档中存在多种数据类型时，可以使用动态模板来根据字段名、数据类型等信息动态设定字段类型，以便在查询和聚合时能够正确地处理数据。\n  \n\n3. 高级选项：  \n  高级选项是指在创建索引模板时可以配置的一些高级设置，例如索引分片数、索引副本数、分析器等。这些设置可以优化索引的性能和存储效率。\n\n高级选项适用于以下场景：\n\n- 需要优化索引性能的场景：可以通过配置索引分片数和索引副本数来优化索引的性能，提高查询和聚合的速度。\n- 需要优化存储效率的场景：可以通过配置存储设置和分析器来优化索引的存储效率，减少存储空间的使用.。\n\n![](https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/kibana/index-template05.png)\n\n- 设置索引别名\n  \n  1. 方便对多个索引进行查询：如果你有许多索引并且经常需要同时查询这些索引，使用别名可以方便地将这些索引组合在一起进行查询。\n  2. 简化索引引用：在查询时，只需要引用别名，而不需要写出完整的索引名称，这使得查询语句更加简洁。\n  3. 方便索引的版本控制：如果你在系统中对索引进行更新或替换，使用别名可以使得对已有查询的影响最小化。例如，你可以创建一个别名，使其始终映射到最新的索引版本，这样在更新索引时，不需要更改所有查询。\n  \n  在 Elasticsearch 中创建别名的方法是通过使用 \"alias\" API。例如，如果你有一个索引 \"test-20190120\"，并想为其创建一个别名 \"test\"，你可以使用以下的请求：\n  \n  ```bash\n  PUT /_aliases  {    \"actions\": [      {        \"add\": {          \"index\": \"test-20190120\",          \"alias\": \"test\"        }      }    ]  }\n  ```\n  \n  在上述请求中，\"add\" 动作告诉 Elasticsearch 将别名 \"test\" 添加到索引 \"test-20190120\" 上。之后，你可以使用别名 \"test\" 来查询该索引的内容。\n  \n\n![](https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/kibana/index-template06.png)\n\n完成模板创建。\n\n## 3. 生效\n\n创建索引生命周期之前的创建的索引不会受索引生命周期影响，之后创建的索引会进入到索引生命周期的策略管理中。","source":"_posts/kubernetes/kibana-ilm.md","raw":"---\ntitle: kibana create ILM\ndate: 2023-09-05 16:14:39\ncategories:\n  - [kubernetes]\ntags: kibana\n---\n# kibana设置ILM\n\n## 1. 背景\n\nkibana version: v7.9.3\n\n## 2. 设置ILM\n\n### 2.1 创建索引生命周期策略\n\n#### 2.1.1 热阶段\n\n首先需要先创建索引生命周期策略，在索引模板中可以引用创建好的索引生命周期策略。\n\n![](https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/kibana/ilm01.png)\n\n- 策略名称： 引用该策略是需要用，例如设置为：filebeat-index-ilm\n  \n- 最大索引大小：设置单个索引最大字节数，此处为50千兆字节，即50G.\n  \n- 最大文档数：设置单个索引所内容乃的最大文档数，超过该数则创建新的索引。\n  \n- 最大存在时间： 指的是索引在温热阶段中可以存在的最长时间。一旦索引达到这个时间限制，它将被自动转移到冷却阶段，并最终被归档或删除。\n  \n  \"最大存在时间\"是一个可选的参数，你可以根据实际需求来决定是否设置这个参数。如果你没有设置这个参数，索引将会一直保持在温热阶段，直到你手动将其转移到冷却阶段或删除。\n  \n  在设置\"最大存在时间\"时，你可以选择一个固定的时间长度，例如30天。这意味着索引在温热阶段中最多存在30天，之后它将被自动转移到冷却阶段。这个参数可以帮助你控制索引的生命周期，避免过多的旧索引占用存储空间和资源。\n  \n  需要注意的是，具体的索引生命周期策略还受到其他参数的影响，例如滚动布署的频率、索引模板、索引生命周期策略等。因此，在实际应用中，需要根据具体的业务需求和数据量来调整和优化这些参数。\n  \n\n#### 2.1.2 温阶段和冷阶段\n\n温阶段和冷阶段不再设置，解释一下这两个阶段：\n\n在 Kibana 中创建索引生命周期策略时，warm phase和Cold phase的存在有意义，它们适用于不同的场景。\n\n1. Warm phase（温阶段）：\n  Warm phase是索引生命周期的中间阶段，适用于处理活跃但不再频繁更改的数据。在这个阶段，索引被用于的搜索和查询操作较多，因此需要保持良好的搜索性能。在温阶段，索引可以被滚动更新，以保持其当前的索引结构、映射和设置。\n  \n  温阶段适用于以下场景：\n  \n  - 数据检索：如果您的应用程序需要从历史数据中检索信息，并且这些数据已经过了一段时间但仍然活跃，那么可以将索引设置为在温阶段。\n  - 数据归档和分析：如果您的应用程序需要将数据存储一段时间以便进行进一步的分析、报告或可视化，那么可以将索引设置为在温阶段。\n2. Cold phase（冷阶段）：\n  Cold phase是索引生命周期的后期阶段，适用于处理不再活跃的数据。在这个阶段，索引被用于的搜索和查询操作较少，因此可以降低存储成本和索引维护开销。在冷阶段，索引可以被归档和压缩，以进一步降低存储成本。\n  \n  冷阶段适用于以下场景：\n  \n  - 数据归档：如果您的应用程序需要长期存储数据，并且这些数据不再被频繁地搜索和查询，那么可以将索引设置为在冷阶段。\n  - 数据保留策略：如果您的应用程序需要保留某些数据一段时间后将其删除，那么可以将索引设置为在冷阶段，并在达到保留期限时自动删除索引。\n  \n  综上所述，温阶段和冷阶段的存在意义在于进一步优化索引生命周期的管理。通过将索引分阶段管理，可以更好地平衡性能、存储成本和维护开销，以满足不同的业务需求。\n  \n\n#### 2.1.3 删除阶段\n\n![](https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/kibana/ilm03.png)\n\n- 删除倒计时： 设置日志多久之后删除。\n  \n\n### 2.2 创建索引模板\n\n![](https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/kibana/index-template01.png)\n\n- 名称：索引模板名\n  \n- 索引模式： 用来匹配应用于哪些索引，例如匹配filebeat-开头的索引;filebeat-*\n  \n- 优先级：是一个整数值，用于确定索引模板的优先级。较高的优先级值表示该索引模板具有更高的优先级。当多个索引模板匹配到同一个索引时，优先级最高的索引模板将被应用。\n  \n- 版本：是一个整数值，用于跟踪索引模板的版本号。你可以根据需要为每个索引模板设置一个唯一的版本号。当索引模板需要更新时，你可以增加版本号以确保新版本的索引模板被应用。\n  \n- _meta 字段：_meta 字段是一个 JSON 对象，用于存储与索引模板相关的元数据。你可以在 _meta 字段中添加自定义的键值对，例如索引模板的创建时间、作者等信息。这些元数据可以在使用 Elasticsearch API 管理索引模板时进行访问和操作。\n  \n\n![](https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/kibana/index-template02.png)\n\n- 选择组件： 引用已经创建好的组件模板\n  \n\n![](https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/kibana/index-template03.png)\n\n- 索引设置: 图中设置了生命周期相关内容，lifecycle：指的就是索引的生命周期，这里就是我们之前创建的索引生命周期；rollover_alias：滚动别名，当我们配置了索引大小，超过这个大小后，会以这个名称命名。\n  \n\n1. 映射字段：  \n  映射字段是指将文档中的字段与特定的数据类型和属性进行映射。在创建索引模板时，可以手动添加映射字段，以便在索引文档时将字段映射为指定的数据类型和属性。例如，可以添加一个名为 \"message\" 的映射字段，将其映射为文本类型，并设置其分析器为 \"standard\"。\n\n映射字段适用于以下场景：\n\n- 数据类型已知且固定的场景：当文档中的字段类型固定且已知时，可以手动添加映射字段，以确保索引的准确性和性能。\n  \n- 需要自定义数据类型的场景：当文档中存在自定义的数据类型时，可以手动添加映射字段，并将其映射为相应的数据类型，以便在查询和聚合时能够正确地处理数据。\n  \n\n2. 动态模板：  \n  动态模板是指根据文档中的字段名、数据类型等动态地设定字段类型。在创建索引模板时，可以定义动态模板规则，以便根据文档的实际情况动态地设定字段类型。例如，可以定义一个名为 \"text\" 的动态模板，将所有以 \"message\" 开头的字段映射为文本类型。\n\n动态模板适用于以下场景：\n\n- 数据类型未知或动态变化的场景：当文档中的字段类型未知或动态变化时，可以使用动态模板来自动识别字段类型，并将其映射为相应的数据类型。\n  \n- 需要灵活处理不同数据类型的场景：当文档中存在多种数据类型时，可以使用动态模板来根据字段名、数据类型等信息动态设定字段类型，以便在查询和聚合时能够正确地处理数据。\n  \n\n3. 高级选项：  \n  高级选项是指在创建索引模板时可以配置的一些高级设置，例如索引分片数、索引副本数、分析器等。这些设置可以优化索引的性能和存储效率。\n\n高级选项适用于以下场景：\n\n- 需要优化索引性能的场景：可以通过配置索引分片数和索引副本数来优化索引的性能，提高查询和聚合的速度。\n- 需要优化存储效率的场景：可以通过配置存储设置和分析器来优化索引的存储效率，减少存储空间的使用.。\n\n![](https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/kibana/index-template05.png)\n\n- 设置索引别名\n  \n  1. 方便对多个索引进行查询：如果你有许多索引并且经常需要同时查询这些索引，使用别名可以方便地将这些索引组合在一起进行查询。\n  2. 简化索引引用：在查询时，只需要引用别名，而不需要写出完整的索引名称，这使得查询语句更加简洁。\n  3. 方便索引的版本控制：如果你在系统中对索引进行更新或替换，使用别名可以使得对已有查询的影响最小化。例如，你可以创建一个别名，使其始终映射到最新的索引版本，这样在更新索引时，不需要更改所有查询。\n  \n  在 Elasticsearch 中创建别名的方法是通过使用 \"alias\" API。例如，如果你有一个索引 \"test-20190120\"，并想为其创建一个别名 \"test\"，你可以使用以下的请求：\n  \n  ```bash\n  PUT /_aliases  {    \"actions\": [      {        \"add\": {          \"index\": \"test-20190120\",          \"alias\": \"test\"        }      }    ]  }\n  ```\n  \n  在上述请求中，\"add\" 动作告诉 Elasticsearch 将别名 \"test\" 添加到索引 \"test-20190120\" 上。之后，你可以使用别名 \"test\" 来查询该索引的内容。\n  \n\n![](https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/kibana/index-template06.png)\n\n完成模板创建。\n\n## 3. 生效\n\n创建索引生命周期之前的创建的索引不会受索引生命周期影响，之后创建的索引会进入到索引生命周期的策略管理中。","slug":"kubernetes/kibana-ilm","published":1,"updated":"2023-09-05T08:16:32.662Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clo89v5en000qb7jx2ygo4yig","content":"<h1 id=\"kibana设置ILM\"><a href=\"#kibana设置ILM\" class=\"headerlink\" title=\"kibana设置ILM\"></a>kibana设置ILM</h1><h2 id=\"1-背景\"><a href=\"#1-背景\" class=\"headerlink\" title=\"1. 背景\"></a>1. 背景</h2><p>kibana version: v7.9.3</p>\n<h2 id=\"2-设置ILM\"><a href=\"#2-设置ILM\" class=\"headerlink\" title=\"2. 设置ILM\"></a>2. 设置ILM</h2><h3 id=\"2-1-创建索引生命周期策略\"><a href=\"#2-1-创建索引生命周期策略\" class=\"headerlink\" title=\"2.1 创建索引生命周期策略\"></a>2.1 创建索引生命周期策略</h3><h4 id=\"2-1-1-热阶段\"><a href=\"#2-1-1-热阶段\" class=\"headerlink\" title=\"2.1.1 热阶段\"></a>2.1.1 热阶段</h4><p>首先需要先创建索引生命周期策略，在索引模板中可以引用创建好的索引生命周期策略。</p>\n<p><img src=\"https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/kibana/ilm01.png\"></p>\n<ul>\n<li><p>策略名称： 引用该策略是需要用，例如设置为：filebeat-index-ilm</p>\n</li>\n<li><p>最大索引大小：设置单个索引最大字节数，此处为50千兆字节，即50G.</p>\n</li>\n<li><p>最大文档数：设置单个索引所内容乃的最大文档数，超过该数则创建新的索引。</p>\n</li>\n<li><p>最大存在时间： 指的是索引在温热阶段中可以存在的最长时间。一旦索引达到这个时间限制，它将被自动转移到冷却阶段，并最终被归档或删除。</p>\n<p>“最大存在时间”是一个可选的参数，你可以根据实际需求来决定是否设置这个参数。如果你没有设置这个参数，索引将会一直保持在温热阶段，直到你手动将其转移到冷却阶段或删除。</p>\n<p>在设置”最大存在时间”时，你可以选择一个固定的时间长度，例如30天。这意味着索引在温热阶段中最多存在30天，之后它将被自动转移到冷却阶段。这个参数可以帮助你控制索引的生命周期，避免过多的旧索引占用存储空间和资源。</p>\n<p>需要注意的是，具体的索引生命周期策略还受到其他参数的影响，例如滚动布署的频率、索引模板、索引生命周期策略等。因此，在实际应用中，需要根据具体的业务需求和数据量来调整和优化这些参数。</p>\n</li>\n</ul>\n<h4 id=\"2-1-2-温阶段和冷阶段\"><a href=\"#2-1-2-温阶段和冷阶段\" class=\"headerlink\" title=\"2.1.2 温阶段和冷阶段\"></a>2.1.2 温阶段和冷阶段</h4><p>温阶段和冷阶段不再设置，解释一下这两个阶段：</p>\n<p>在 Kibana 中创建索引生命周期策略时，warm phase和Cold phase的存在有意义，它们适用于不同的场景。</p>\n<ol>\n<li>Warm phase（温阶段）：<br>  Warm phase是索引生命周期的中间阶段，适用于处理活跃但不再频繁更改的数据。在这个阶段，索引被用于的搜索和查询操作较多，因此需要保持良好的搜索性能。在温阶段，索引可以被滚动更新，以保持其当前的索引结构、映射和设置。</li>\n</ol>\n<p>  温阶段适用于以下场景：</p>\n<ul>\n<li>数据检索：如果您的应用程序需要从历史数据中检索信息，并且这些数据已经过了一段时间但仍然活跃，那么可以将索引设置为在温阶段。</li>\n<li>数据归档和分析：如果您的应用程序需要将数据存储一段时间以便进行进一步的分析、报告或可视化，那么可以将索引设置为在温阶段。</li>\n</ul>\n<ol start=\"2\">\n<li>Cold phase（冷阶段）：<br>  Cold phase是索引生命周期的后期阶段，适用于处理不再活跃的数据。在这个阶段，索引被用于的搜索和查询操作较少，因此可以降低存储成本和索引维护开销。在冷阶段，索引可以被归档和压缩，以进一步降低存储成本。</li>\n</ol>\n<p>  冷阶段适用于以下场景：</p>\n<ul>\n<li>数据归档：如果您的应用程序需要长期存储数据，并且这些数据不再被频繁地搜索和查询，那么可以将索引设置为在冷阶段。</li>\n<li>数据保留策略：如果您的应用程序需要保留某些数据一段时间后将其删除，那么可以将索引设置为在冷阶段，并在达到保留期限时自动删除索引。</li>\n</ul>\n<p>  综上所述，温阶段和冷阶段的存在意义在于进一步优化索引生命周期的管理。通过将索引分阶段管理，可以更好地平衡性能、存储成本和维护开销，以满足不同的业务需求。</p>\n<h4 id=\"2-1-3-删除阶段\"><a href=\"#2-1-3-删除阶段\" class=\"headerlink\" title=\"2.1.3 删除阶段\"></a>2.1.3 删除阶段</h4><p><img src=\"https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/kibana/ilm03.png\"></p>\n<ul>\n<li>删除倒计时： 设置日志多久之后删除。</li>\n</ul>\n<h3 id=\"2-2-创建索引模板\"><a href=\"#2-2-创建索引模板\" class=\"headerlink\" title=\"2.2 创建索引模板\"></a>2.2 创建索引模板</h3><p><img src=\"https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/kibana/index-template01.png\"></p>\n<ul>\n<li><p>名称：索引模板名</p>\n</li>\n<li><p>索引模式： 用来匹配应用于哪些索引，例如匹配filebeat-开头的索引;filebeat-*</p>\n</li>\n<li><p>优先级：是一个整数值，用于确定索引模板的优先级。较高的优先级值表示该索引模板具有更高的优先级。当多个索引模板匹配到同一个索引时，优先级最高的索引模板将被应用。</p>\n</li>\n<li><p>版本：是一个整数值，用于跟踪索引模板的版本号。你可以根据需要为每个索引模板设置一个唯一的版本号。当索引模板需要更新时，你可以增加版本号以确保新版本的索引模板被应用。</p>\n</li>\n<li><p>_meta 字段：_meta 字段是一个 JSON 对象，用于存储与索引模板相关的元数据。你可以在 _meta 字段中添加自定义的键值对，例如索引模板的创建时间、作者等信息。这些元数据可以在使用 Elasticsearch API 管理索引模板时进行访问和操作。</p>\n</li>\n</ul>\n<p><img src=\"https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/kibana/index-template02.png\"></p>\n<ul>\n<li>选择组件： 引用已经创建好的组件模板</li>\n</ul>\n<p><img src=\"https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/kibana/index-template03.png\"></p>\n<ul>\n<li>索引设置: 图中设置了生命周期相关内容，lifecycle：指的就是索引的生命周期，这里就是我们之前创建的索引生命周期；rollover_alias：滚动别名，当我们配置了索引大小，超过这个大小后，会以这个名称命名。</li>\n</ul>\n<ol>\n<li>映射字段：<br>  映射字段是指将文档中的字段与特定的数据类型和属性进行映射。在创建索引模板时，可以手动添加映射字段，以便在索引文档时将字段映射为指定的数据类型和属性。例如，可以添加一个名为 “message” 的映射字段，将其映射为文本类型，并设置其分析器为 “standard”。</li>\n</ol>\n<p>映射字段适用于以下场景：</p>\n<ul>\n<li><p>数据类型已知且固定的场景：当文档中的字段类型固定且已知时，可以手动添加映射字段，以确保索引的准确性和性能。</p>\n</li>\n<li><p>需要自定义数据类型的场景：当文档中存在自定义的数据类型时，可以手动添加映射字段，并将其映射为相应的数据类型，以便在查询和聚合时能够正确地处理数据。</p>\n</li>\n</ul>\n<ol start=\"2\">\n<li>动态模板：<br>  动态模板是指根据文档中的字段名、数据类型等动态地设定字段类型。在创建索引模板时，可以定义动态模板规则，以便根据文档的实际情况动态地设定字段类型。例如，可以定义一个名为 “text” 的动态模板，将所有以 “message” 开头的字段映射为文本类型。</li>\n</ol>\n<p>动态模板适用于以下场景：</p>\n<ul>\n<li><p>数据类型未知或动态变化的场景：当文档中的字段类型未知或动态变化时，可以使用动态模板来自动识别字段类型，并将其映射为相应的数据类型。</p>\n</li>\n<li><p>需要灵活处理不同数据类型的场景：当文档中存在多种数据类型时，可以使用动态模板来根据字段名、数据类型等信息动态设定字段类型，以便在查询和聚合时能够正确地处理数据。</p>\n</li>\n</ul>\n<ol start=\"3\">\n<li>高级选项：<br>  高级选项是指在创建索引模板时可以配置的一些高级设置，例如索引分片数、索引副本数、分析器等。这些设置可以优化索引的性能和存储效率。</li>\n</ol>\n<p>高级选项适用于以下场景：</p>\n<ul>\n<li>需要优化索引性能的场景：可以通过配置索引分片数和索引副本数来优化索引的性能，提高查询和聚合的速度。</li>\n<li>需要优化存储效率的场景：可以通过配置存储设置和分析器来优化索引的存储效率，减少存储空间的使用.。</li>\n</ul>\n<p><img src=\"https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/kibana/index-template05.png\"></p>\n<ul>\n<li><p>设置索引别名</p>\n<ol>\n<li>方便对多个索引进行查询：如果你有许多索引并且经常需要同时查询这些索引，使用别名可以方便地将这些索引组合在一起进行查询。</li>\n<li>简化索引引用：在查询时，只需要引用别名，而不需要写出完整的索引名称，这使得查询语句更加简洁。</li>\n<li>方便索引的版本控制：如果你在系统中对索引进行更新或替换，使用别名可以使得对已有查询的影响最小化。例如，你可以创建一个别名，使其始终映射到最新的索引版本，这样在更新索引时，不需要更改所有查询。</li>\n</ol>\n<p>在 Elasticsearch 中创建别名的方法是通过使用 “alias” API。例如，如果你有一个索引 “test-20190120”，并想为其创建一个别名 “test”，你可以使用以下的请求：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PUT /_aliases  &#123;    <span class=\"string\">&quot;actions&quot;</span>: [      &#123;        <span class=\"string\">&quot;add&quot;</span>: &#123;          <span class=\"string\">&quot;index&quot;</span>: <span class=\"string\">&quot;test-20190120&quot;</span>,          <span class=\"string\">&quot;alias&quot;</span>: <span class=\"string\">&quot;test&quot;</span>        &#125;      &#125;    ]  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>在上述请求中，”add” 动作告诉 Elasticsearch 将别名 “test” 添加到索引 “test-20190120” 上。之后，你可以使用别名 “test” 来查询该索引的内容。</p>\n</li>\n</ul>\n<p><img src=\"https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/kibana/index-template06.png\"></p>\n<p>完成模板创建。</p>\n<h2 id=\"3-生效\"><a href=\"#3-生效\" class=\"headerlink\" title=\"3. 生效\"></a>3. 生效</h2><p>创建索引生命周期之前的创建的索引不会受索引生命周期影响，之后创建的索引会进入到索引生命周期的策略管理中。</p>\n","site":{"data":{"link":[{"class_name":"友情鏈接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、簡單且強大的網誌框架"}]},{"class_name":"網站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":false,"excerpt":"","more":"<h1 id=\"kibana设置ILM\"><a href=\"#kibana设置ILM\" class=\"headerlink\" title=\"kibana设置ILM\"></a>kibana设置ILM</h1><h2 id=\"1-背景\"><a href=\"#1-背景\" class=\"headerlink\" title=\"1. 背景\"></a>1. 背景</h2><p>kibana version: v7.9.3</p>\n<h2 id=\"2-设置ILM\"><a href=\"#2-设置ILM\" class=\"headerlink\" title=\"2. 设置ILM\"></a>2. 设置ILM</h2><h3 id=\"2-1-创建索引生命周期策略\"><a href=\"#2-1-创建索引生命周期策略\" class=\"headerlink\" title=\"2.1 创建索引生命周期策略\"></a>2.1 创建索引生命周期策略</h3><h4 id=\"2-1-1-热阶段\"><a href=\"#2-1-1-热阶段\" class=\"headerlink\" title=\"2.1.1 热阶段\"></a>2.1.1 热阶段</h4><p>首先需要先创建索引生命周期策略，在索引模板中可以引用创建好的索引生命周期策略。</p>\n<p><img src=\"https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/kibana/ilm01.png\"></p>\n<ul>\n<li><p>策略名称： 引用该策略是需要用，例如设置为：filebeat-index-ilm</p>\n</li>\n<li><p>最大索引大小：设置单个索引最大字节数，此处为50千兆字节，即50G.</p>\n</li>\n<li><p>最大文档数：设置单个索引所内容乃的最大文档数，超过该数则创建新的索引。</p>\n</li>\n<li><p>最大存在时间： 指的是索引在温热阶段中可以存在的最长时间。一旦索引达到这个时间限制，它将被自动转移到冷却阶段，并最终被归档或删除。</p>\n<p>“最大存在时间”是一个可选的参数，你可以根据实际需求来决定是否设置这个参数。如果你没有设置这个参数，索引将会一直保持在温热阶段，直到你手动将其转移到冷却阶段或删除。</p>\n<p>在设置”最大存在时间”时，你可以选择一个固定的时间长度，例如30天。这意味着索引在温热阶段中最多存在30天，之后它将被自动转移到冷却阶段。这个参数可以帮助你控制索引的生命周期，避免过多的旧索引占用存储空间和资源。</p>\n<p>需要注意的是，具体的索引生命周期策略还受到其他参数的影响，例如滚动布署的频率、索引模板、索引生命周期策略等。因此，在实际应用中，需要根据具体的业务需求和数据量来调整和优化这些参数。</p>\n</li>\n</ul>\n<h4 id=\"2-1-2-温阶段和冷阶段\"><a href=\"#2-1-2-温阶段和冷阶段\" class=\"headerlink\" title=\"2.1.2 温阶段和冷阶段\"></a>2.1.2 温阶段和冷阶段</h4><p>温阶段和冷阶段不再设置，解释一下这两个阶段：</p>\n<p>在 Kibana 中创建索引生命周期策略时，warm phase和Cold phase的存在有意义，它们适用于不同的场景。</p>\n<ol>\n<li>Warm phase（温阶段）：<br>  Warm phase是索引生命周期的中间阶段，适用于处理活跃但不再频繁更改的数据。在这个阶段，索引被用于的搜索和查询操作较多，因此需要保持良好的搜索性能。在温阶段，索引可以被滚动更新，以保持其当前的索引结构、映射和设置。</li>\n</ol>\n<p>  温阶段适用于以下场景：</p>\n<ul>\n<li>数据检索：如果您的应用程序需要从历史数据中检索信息，并且这些数据已经过了一段时间但仍然活跃，那么可以将索引设置为在温阶段。</li>\n<li>数据归档和分析：如果您的应用程序需要将数据存储一段时间以便进行进一步的分析、报告或可视化，那么可以将索引设置为在温阶段。</li>\n</ul>\n<ol start=\"2\">\n<li>Cold phase（冷阶段）：<br>  Cold phase是索引生命周期的后期阶段，适用于处理不再活跃的数据。在这个阶段，索引被用于的搜索和查询操作较少，因此可以降低存储成本和索引维护开销。在冷阶段，索引可以被归档和压缩，以进一步降低存储成本。</li>\n</ol>\n<p>  冷阶段适用于以下场景：</p>\n<ul>\n<li>数据归档：如果您的应用程序需要长期存储数据，并且这些数据不再被频繁地搜索和查询，那么可以将索引设置为在冷阶段。</li>\n<li>数据保留策略：如果您的应用程序需要保留某些数据一段时间后将其删除，那么可以将索引设置为在冷阶段，并在达到保留期限时自动删除索引。</li>\n</ul>\n<p>  综上所述，温阶段和冷阶段的存在意义在于进一步优化索引生命周期的管理。通过将索引分阶段管理，可以更好地平衡性能、存储成本和维护开销，以满足不同的业务需求。</p>\n<h4 id=\"2-1-3-删除阶段\"><a href=\"#2-1-3-删除阶段\" class=\"headerlink\" title=\"2.1.3 删除阶段\"></a>2.1.3 删除阶段</h4><p><img src=\"https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/kibana/ilm03.png\"></p>\n<ul>\n<li>删除倒计时： 设置日志多久之后删除。</li>\n</ul>\n<h3 id=\"2-2-创建索引模板\"><a href=\"#2-2-创建索引模板\" class=\"headerlink\" title=\"2.2 创建索引模板\"></a>2.2 创建索引模板</h3><p><img src=\"https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/kibana/index-template01.png\"></p>\n<ul>\n<li><p>名称：索引模板名</p>\n</li>\n<li><p>索引模式： 用来匹配应用于哪些索引，例如匹配filebeat-开头的索引;filebeat-*</p>\n</li>\n<li><p>优先级：是一个整数值，用于确定索引模板的优先级。较高的优先级值表示该索引模板具有更高的优先级。当多个索引模板匹配到同一个索引时，优先级最高的索引模板将被应用。</p>\n</li>\n<li><p>版本：是一个整数值，用于跟踪索引模板的版本号。你可以根据需要为每个索引模板设置一个唯一的版本号。当索引模板需要更新时，你可以增加版本号以确保新版本的索引模板被应用。</p>\n</li>\n<li><p>_meta 字段：_meta 字段是一个 JSON 对象，用于存储与索引模板相关的元数据。你可以在 _meta 字段中添加自定义的键值对，例如索引模板的创建时间、作者等信息。这些元数据可以在使用 Elasticsearch API 管理索引模板时进行访问和操作。</p>\n</li>\n</ul>\n<p><img src=\"https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/kibana/index-template02.png\"></p>\n<ul>\n<li>选择组件： 引用已经创建好的组件模板</li>\n</ul>\n<p><img src=\"https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/kibana/index-template03.png\"></p>\n<ul>\n<li>索引设置: 图中设置了生命周期相关内容，lifecycle：指的就是索引的生命周期，这里就是我们之前创建的索引生命周期；rollover_alias：滚动别名，当我们配置了索引大小，超过这个大小后，会以这个名称命名。</li>\n</ul>\n<ol>\n<li>映射字段：<br>  映射字段是指将文档中的字段与特定的数据类型和属性进行映射。在创建索引模板时，可以手动添加映射字段，以便在索引文档时将字段映射为指定的数据类型和属性。例如，可以添加一个名为 “message” 的映射字段，将其映射为文本类型，并设置其分析器为 “standard”。</li>\n</ol>\n<p>映射字段适用于以下场景：</p>\n<ul>\n<li><p>数据类型已知且固定的场景：当文档中的字段类型固定且已知时，可以手动添加映射字段，以确保索引的准确性和性能。</p>\n</li>\n<li><p>需要自定义数据类型的场景：当文档中存在自定义的数据类型时，可以手动添加映射字段，并将其映射为相应的数据类型，以便在查询和聚合时能够正确地处理数据。</p>\n</li>\n</ul>\n<ol start=\"2\">\n<li>动态模板：<br>  动态模板是指根据文档中的字段名、数据类型等动态地设定字段类型。在创建索引模板时，可以定义动态模板规则，以便根据文档的实际情况动态地设定字段类型。例如，可以定义一个名为 “text” 的动态模板，将所有以 “message” 开头的字段映射为文本类型。</li>\n</ol>\n<p>动态模板适用于以下场景：</p>\n<ul>\n<li><p>数据类型未知或动态变化的场景：当文档中的字段类型未知或动态变化时，可以使用动态模板来自动识别字段类型，并将其映射为相应的数据类型。</p>\n</li>\n<li><p>需要灵活处理不同数据类型的场景：当文档中存在多种数据类型时，可以使用动态模板来根据字段名、数据类型等信息动态设定字段类型，以便在查询和聚合时能够正确地处理数据。</p>\n</li>\n</ul>\n<ol start=\"3\">\n<li>高级选项：<br>  高级选项是指在创建索引模板时可以配置的一些高级设置，例如索引分片数、索引副本数、分析器等。这些设置可以优化索引的性能和存储效率。</li>\n</ol>\n<p>高级选项适用于以下场景：</p>\n<ul>\n<li>需要优化索引性能的场景：可以通过配置索引分片数和索引副本数来优化索引的性能，提高查询和聚合的速度。</li>\n<li>需要优化存储效率的场景：可以通过配置存储设置和分析器来优化索引的存储效率，减少存储空间的使用.。</li>\n</ul>\n<p><img src=\"https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/kibana/index-template05.png\"></p>\n<ul>\n<li><p>设置索引别名</p>\n<ol>\n<li>方便对多个索引进行查询：如果你有许多索引并且经常需要同时查询这些索引，使用别名可以方便地将这些索引组合在一起进行查询。</li>\n<li>简化索引引用：在查询时，只需要引用别名，而不需要写出完整的索引名称，这使得查询语句更加简洁。</li>\n<li>方便索引的版本控制：如果你在系统中对索引进行更新或替换，使用别名可以使得对已有查询的影响最小化。例如，你可以创建一个别名，使其始终映射到最新的索引版本，这样在更新索引时，不需要更改所有查询。</li>\n</ol>\n<p>在 Elasticsearch 中创建别名的方法是通过使用 “alias” API。例如，如果你有一个索引 “test-20190120”，并想为其创建一个别名 “test”，你可以使用以下的请求：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PUT /_aliases  &#123;    <span class=\"string\">&quot;actions&quot;</span>: [      &#123;        <span class=\"string\">&quot;add&quot;</span>: &#123;          <span class=\"string\">&quot;index&quot;</span>: <span class=\"string\">&quot;test-20190120&quot;</span>,          <span class=\"string\">&quot;alias&quot;</span>: <span class=\"string\">&quot;test&quot;</span>        &#125;      &#125;    ]  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>在上述请求中，”add” 动作告诉 Elasticsearch 将别名 “test” 添加到索引 “test-20190120” 上。之后，你可以使用别名 “test” 来查询该索引的内容。</p>\n</li>\n</ul>\n<p><img src=\"https://ghproxy.com/https://github.com/wongearl/mypic/blob/main/kibana/index-template06.png\"></p>\n<p>完成模板创建。</p>\n<h2 id=\"3-生效\"><a href=\"#3-生效\" class=\"headerlink\" title=\"3. 生效\"></a>3. 生效</h2><p>创建索引生命周期之前的创建的索引不会受索引生命周期影响，之后创建的索引会进入到索引生命周期的策略管理中。</p>\n"},{"title":"kubevirt expose vm by svc","date":"2023-09-01T09:36:42.000Z","_content":"# 背景\n存在kubevit存在的三个虚机：\n\n```\nubuntu-4tlg7   7d22h   Running   True\nubuntu-7kgrk   7d22h   Running   True\nubuntu-94kg2   7d22h   Running   True\n```\n\n网络没有做透传，pod也不是underlay网络想要通过NodePort方式暴露虚机22端口进行远程登录。\n\n# 方法\n1. 修改vm资源实例，在spec.template.metada下添加labels设置,已存在的则不用添加。例如如下：\n```\n  spec:\n    runStrategy: RerunOnFailure\n    template:\n      metadata:\n        creationTimestamp: null\n        labels:\n          kubevirtvm01: kubevirtvm01\n```\n2. 重启虚机\n\n```\nvirtctl -n wyl-vm restart ubuntu-4tlg7\n```\n\n3. 暴露端口\n```\nvirtctl expose vm ubuntu-4tlg7 --name ubuntu-4tlg7-ssh --port 22 --target-port 22 --type NodePort -n wyl-vm\n```\n\n4. 查看svc\n\n```\nNAME               TYPE       CLUSTER-IP    EXTERNAL-IP   PORT(S)        AGE\nubuntu-4tlg7-ssh   NodePort   10.96.23.17   <none>        22:32581/TCP   14m\n```\n使用节点ip地址加svc nodeport即可访问虚机。\n","source":"_posts/kubernetes/kubevirt-vm-expose.md","raw":"---\ntitle: kubevirt expose vm by svc\ndate: 2023-09-01 17:36:42\ncategories:\n  - [kubernetes]\ntags: kubevirt\n---\n# 背景\n存在kubevit存在的三个虚机：\n\n```\nubuntu-4tlg7   7d22h   Running   True\nubuntu-7kgrk   7d22h   Running   True\nubuntu-94kg2   7d22h   Running   True\n```\n\n网络没有做透传，pod也不是underlay网络想要通过NodePort方式暴露虚机22端口进行远程登录。\n\n# 方法\n1. 修改vm资源实例，在spec.template.metada下添加labels设置,已存在的则不用添加。例如如下：\n```\n  spec:\n    runStrategy: RerunOnFailure\n    template:\n      metadata:\n        creationTimestamp: null\n        labels:\n          kubevirtvm01: kubevirtvm01\n```\n2. 重启虚机\n\n```\nvirtctl -n wyl-vm restart ubuntu-4tlg7\n```\n\n3. 暴露端口\n```\nvirtctl expose vm ubuntu-4tlg7 --name ubuntu-4tlg7-ssh --port 22 --target-port 22 --type NodePort -n wyl-vm\n```\n\n4. 查看svc\n\n```\nNAME               TYPE       CLUSTER-IP    EXTERNAL-IP   PORT(S)        AGE\nubuntu-4tlg7-ssh   NodePort   10.96.23.17   <none>        22:32581/TCP   14m\n```\n使用节点ip地址加svc nodeport即可访问虚机。\n","slug":"kubernetes/kubevirt-vm-expose","published":1,"updated":"2023-09-01T09:38:58.859Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clo89v5ep000tb7jx5xunbz1a","content":"<h1 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h1><p>存在kubevit存在的三个虚机：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ubuntu-4tlg7   7d22h   Running   True</span><br><span class=\"line\">ubuntu-7kgrk   7d22h   Running   True</span><br><span class=\"line\">ubuntu-94kg2   7d22h   Running   True</span><br></pre></td></tr></table></figure>\n\n<p>网络没有做透传，pod也不是underlay网络想要通过NodePort方式暴露虚机22端口进行远程登录。</p>\n<h1 id=\"方法\"><a href=\"#方法\" class=\"headerlink\" title=\"方法\"></a>方法</h1><ol>\n<li>修改vm资源实例，在spec.template.metada下添加labels设置,已存在的则不用添加。例如如下：<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">spec:</span><br><span class=\"line\">  runStrategy: RerunOnFailure</span><br><span class=\"line\">  template:</span><br><span class=\"line\">    metadata:</span><br><span class=\"line\">      creationTimestamp: null</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        kubevirtvm01: kubevirtvm01</span><br></pre></td></tr></table></figure></li>\n<li>重启虚机</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">virtctl -n wyl-vm restart ubuntu-4tlg7</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li><p>暴露端口</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">virtctl expose vm ubuntu-4tlg7 --name ubuntu-4tlg7-ssh --port 22 --target-port 22 --type NodePort -n wyl-vm</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看svc</p>\n</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">NAME               TYPE       CLUSTER-IP    EXTERNAL-IP   PORT(S)        AGE</span><br><span class=\"line\">ubuntu-4tlg7-ssh   NodePort   10.96.23.17   &lt;none&gt;        22:32581/TCP   14m</span><br></pre></td></tr></table></figure>\n<p>使用节点ip地址加svc nodeport即可访问虚机。</p>\n","site":{"data":{"link":[{"class_name":"友情鏈接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、簡單且強大的網誌框架"}]},{"class_name":"網站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":false,"excerpt":"","more":"<h1 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h1><p>存在kubevit存在的三个虚机：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ubuntu-4tlg7   7d22h   Running   True</span><br><span class=\"line\">ubuntu-7kgrk   7d22h   Running   True</span><br><span class=\"line\">ubuntu-94kg2   7d22h   Running   True</span><br></pre></td></tr></table></figure>\n\n<p>网络没有做透传，pod也不是underlay网络想要通过NodePort方式暴露虚机22端口进行远程登录。</p>\n<h1 id=\"方法\"><a href=\"#方法\" class=\"headerlink\" title=\"方法\"></a>方法</h1><ol>\n<li>修改vm资源实例，在spec.template.metada下添加labels设置,已存在的则不用添加。例如如下：<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">spec:</span><br><span class=\"line\">  runStrategy: RerunOnFailure</span><br><span class=\"line\">  template:</span><br><span class=\"line\">    metadata:</span><br><span class=\"line\">      creationTimestamp: null</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        kubevirtvm01: kubevirtvm01</span><br></pre></td></tr></table></figure></li>\n<li>重启虚机</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">virtctl -n wyl-vm restart ubuntu-4tlg7</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li><p>暴露端口</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">virtctl expose vm ubuntu-4tlg7 --name ubuntu-4tlg7-ssh --port 22 --target-port 22 --type NodePort -n wyl-vm</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看svc</p>\n</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">NAME               TYPE       CLUSTER-IP    EXTERNAL-IP   PORT(S)        AGE</span><br><span class=\"line\">ubuntu-4tlg7-ssh   NodePort   10.96.23.17   &lt;none&gt;        22:32581/TCP   14m</span><br></pre></td></tr></table></figure>\n<p>使用节点ip地址加svc nodeport即可访问虚机。</p>\n"},{"title":"install metrics-server","date":"2023-08-25T02:25:58.000Z","_content":"使用kubectl top命名需要安装metrics-server,否则会报错: error: Metrics API not available\n使用如下yaml文件安装metrics-server:\n```yaml\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: metrics-server\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  labels:\n    k8s-app: metrics-server\n    rbac.authorization.k8s.io/aggregate-to-admin: \"true\"\n    rbac.authorization.k8s.io/aggregate-to-edit: \"true\"\n    rbac.authorization.k8s.io/aggregate-to-view: \"true\"\n  name: system:aggregated-metrics-reader\nrules:\n- apiGroups:\n  - metrics.k8s.io\n  resources:\n  - pods\n  - nodes\n  verbs:\n  - get\n  - list\n  - watch\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: system:metrics-server\nrules:\n- apiGroups:\n  - \"\"\n  resources:\n  - nodes/metrics\n  verbs:\n  - get\n- apiGroups:\n  - \"\"\n  resources:\n  - pods\n  - nodes\n  verbs:\n  - get\n  - list\n  - watch\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: metrics-server-auth-reader\n  namespace: kube-system\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: Role\n  name: extension-apiserver-authentication-reader\nsubjects:\n- kind: ServiceAccount\n  name: metrics-server\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: metrics-server:system:auth-delegator\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:auth-delegator\nsubjects:\n- kind: ServiceAccount\n  name: metrics-server\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: system:metrics-server\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:metrics-server\nsubjects:\n- kind: ServiceAccount\n  name: metrics-server\n  namespace: kube-system\n---\napiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: metrics-server\n  namespace: kube-system\nspec:\n  ports:\n  - name: https\n    port: 443\n    protocol: TCP\n    targetPort: https\n  selector:\n    k8s-app: metrics-server\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: metrics-server\n  namespace: kube-system\nspec:\n  selector:\n    matchLabels:\n      k8s-app: metrics-server\n  strategy:\n    rollingUpdate:\n      maxUnavailable: 0\n  template:\n    metadata:\n      labels:\n        k8s-app: metrics-server\n    spec:\n      containers:\n      - args:\n        - --cert-dir=/tmp\n        - --secure-port=4443\n        - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname\n        - --kubelet-use-node-status-port\n        - --metric-resolution=15s\n        - --kubelet-insecure-tls\n        image: registry.cn-hangzhou.aliyuncs.com/google_containers/metrics-server:v0.6.4\n        imagePullPolicy: IfNotPresent\n        livenessProbe:\n          failureThreshold: 3\n          httpGet:\n            path: /livez\n            port: https\n            scheme: HTTPS\n          periodSeconds: 10\n        name: metrics-server\n        ports:\n        - containerPort: 4443\n          name: https\n          protocol: TCP\n        readinessProbe:\n          failureThreshold: 3\n          httpGet:\n            path: /readyz\n            port: https\n            scheme: HTTPS\n          initialDelaySeconds: 20\n          periodSeconds: 10\n        resources:\n          requests:\n            cpu: 100m\n            memory: 200Mi\n        securityContext:\n          allowPrivilegeEscalation: false\n          readOnlyRootFilesystem: true\n          runAsNonRoot: true\n          runAsUser: 1000\n        volumeMounts:\n        - mountPath: /tmp\n          name: tmp-dir\n      nodeSelector:\n        kubernetes.io/os: linux\n      priorityClassName: system-cluster-critical\n      serviceAccountName: metrics-server\n      volumes:\n      - emptyDir: {}\n        name: tmp-dir\n---\napiVersion: apiregistration.k8s.io/v1\nkind: APIService\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: v1beta1.metrics.k8s.io\nspec:\n  group: metrics.k8s.io\n  groupPriorityMinimum: 100\n  insecureSkipTLSVerify: true\n  service:\n    name: metrics-server\n    namespace: kube-system\n  version: v1beta1\n  versionPriority: 100\n```\n\n```shell\nkubectl apply -f metrics-server.yaml\n```","source":"_posts/kubernetes/metrics-server.md","raw":"---\ntitle: install metrics-server\ndate: 2023-08-25 10:25:58\ncategories:\n  - [kubernetes]\ntags: kubernetes\n---\n使用kubectl top命名需要安装metrics-server,否则会报错: error: Metrics API not available\n使用如下yaml文件安装metrics-server:\n```yaml\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: metrics-server\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  labels:\n    k8s-app: metrics-server\n    rbac.authorization.k8s.io/aggregate-to-admin: \"true\"\n    rbac.authorization.k8s.io/aggregate-to-edit: \"true\"\n    rbac.authorization.k8s.io/aggregate-to-view: \"true\"\n  name: system:aggregated-metrics-reader\nrules:\n- apiGroups:\n  - metrics.k8s.io\n  resources:\n  - pods\n  - nodes\n  verbs:\n  - get\n  - list\n  - watch\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: system:metrics-server\nrules:\n- apiGroups:\n  - \"\"\n  resources:\n  - nodes/metrics\n  verbs:\n  - get\n- apiGroups:\n  - \"\"\n  resources:\n  - pods\n  - nodes\n  verbs:\n  - get\n  - list\n  - watch\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: metrics-server-auth-reader\n  namespace: kube-system\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: Role\n  name: extension-apiserver-authentication-reader\nsubjects:\n- kind: ServiceAccount\n  name: metrics-server\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: metrics-server:system:auth-delegator\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:auth-delegator\nsubjects:\n- kind: ServiceAccount\n  name: metrics-server\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: system:metrics-server\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:metrics-server\nsubjects:\n- kind: ServiceAccount\n  name: metrics-server\n  namespace: kube-system\n---\napiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: metrics-server\n  namespace: kube-system\nspec:\n  ports:\n  - name: https\n    port: 443\n    protocol: TCP\n    targetPort: https\n  selector:\n    k8s-app: metrics-server\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: metrics-server\n  namespace: kube-system\nspec:\n  selector:\n    matchLabels:\n      k8s-app: metrics-server\n  strategy:\n    rollingUpdate:\n      maxUnavailable: 0\n  template:\n    metadata:\n      labels:\n        k8s-app: metrics-server\n    spec:\n      containers:\n      - args:\n        - --cert-dir=/tmp\n        - --secure-port=4443\n        - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname\n        - --kubelet-use-node-status-port\n        - --metric-resolution=15s\n        - --kubelet-insecure-tls\n        image: registry.cn-hangzhou.aliyuncs.com/google_containers/metrics-server:v0.6.4\n        imagePullPolicy: IfNotPresent\n        livenessProbe:\n          failureThreshold: 3\n          httpGet:\n            path: /livez\n            port: https\n            scheme: HTTPS\n          periodSeconds: 10\n        name: metrics-server\n        ports:\n        - containerPort: 4443\n          name: https\n          protocol: TCP\n        readinessProbe:\n          failureThreshold: 3\n          httpGet:\n            path: /readyz\n            port: https\n            scheme: HTTPS\n          initialDelaySeconds: 20\n          periodSeconds: 10\n        resources:\n          requests:\n            cpu: 100m\n            memory: 200Mi\n        securityContext:\n          allowPrivilegeEscalation: false\n          readOnlyRootFilesystem: true\n          runAsNonRoot: true\n          runAsUser: 1000\n        volumeMounts:\n        - mountPath: /tmp\n          name: tmp-dir\n      nodeSelector:\n        kubernetes.io/os: linux\n      priorityClassName: system-cluster-critical\n      serviceAccountName: metrics-server\n      volumes:\n      - emptyDir: {}\n        name: tmp-dir\n---\napiVersion: apiregistration.k8s.io/v1\nkind: APIService\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: v1beta1.metrics.k8s.io\nspec:\n  group: metrics.k8s.io\n  groupPriorityMinimum: 100\n  insecureSkipTLSVerify: true\n  service:\n    name: metrics-server\n    namespace: kube-system\n  version: v1beta1\n  versionPriority: 100\n```\n\n```shell\nkubectl apply -f metrics-server.yaml\n```","slug":"kubernetes/metrics-server","published":1,"updated":"2023-08-25T02:33:13.160Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clo89v5et000wb7jx3imp69oo","content":"<p>使用kubectl top命名需要安装metrics-server,否则会报错: error: Metrics API not available<br>使用如下yaml文件安装metrics-server:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">    <span class=\"attr\">rbac.authorization.k8s.io/aggregate-to-admin:</span> <span class=\"string\">&quot;true&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">rbac.authorization.k8s.io/aggregate-to-edit:</span> <span class=\"string\">&quot;true&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">rbac.authorization.k8s.io/aggregate-to-view:</span> <span class=\"string\">&quot;true&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">system:aggregated-metrics-reader</span></span><br><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">metrics.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">pods</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">nodes</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">get</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">list</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">watch</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">system:metrics-server</span></span><br><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">nodes/metrics</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">get</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">pods</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">nodes</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">get</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">list</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">watch</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">RoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server-auth-reader</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\">  <span class=\"attr\">apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">kind:</span> <span class=\"string\">Role</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">extension-apiserver-authentication-reader</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server:system:auth-delegator</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\">  <span class=\"attr\">apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">system:auth-delegator</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">system:metrics-server</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\">  <span class=\"attr\">apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">system:metrics-server</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">https</span></span><br><span class=\"line\">    <span class=\"attr\">port:</span> <span class=\"number\">443</span></span><br><span class=\"line\">    <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"string\">https</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">strategy:</span></span><br><span class=\"line\">    <span class=\"attr\">rollingUpdate:</span></span><br><span class=\"line\">      <span class=\"attr\">maxUnavailable:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">args:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--cert-dir=/tmp</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--secure-port=4443</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--kubelet-use-node-status-port</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--metric-resolution=15s</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--kubelet-insecure-tls</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">registry.cn-hangzhou.aliyuncs.com/google_containers/metrics-server:v0.6.4</span></span><br><span class=\"line\">        <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\">        <span class=\"attr\">livenessProbe:</span></span><br><span class=\"line\">          <span class=\"attr\">failureThreshold:</span> <span class=\"number\">3</span></span><br><span class=\"line\">          <span class=\"attr\">httpGet:</span></span><br><span class=\"line\">            <span class=\"attr\">path:</span> <span class=\"string\">/livez</span></span><br><span class=\"line\">            <span class=\"attr\">port:</span> <span class=\"string\">https</span></span><br><span class=\"line\">            <span class=\"attr\">scheme:</span> <span class=\"string\">HTTPS</span></span><br><span class=\"line\">          <span class=\"attr\">periodSeconds:</span> <span class=\"number\">10</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">4443</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">https</span></span><br><span class=\"line\">          <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\">        <span class=\"attr\">readinessProbe:</span></span><br><span class=\"line\">          <span class=\"attr\">failureThreshold:</span> <span class=\"number\">3</span></span><br><span class=\"line\">          <span class=\"attr\">httpGet:</span></span><br><span class=\"line\">            <span class=\"attr\">path:</span> <span class=\"string\">/readyz</span></span><br><span class=\"line\">            <span class=\"attr\">port:</span> <span class=\"string\">https</span></span><br><span class=\"line\">            <span class=\"attr\">scheme:</span> <span class=\"string\">HTTPS</span></span><br><span class=\"line\">          <span class=\"attr\">initialDelaySeconds:</span> <span class=\"number\">20</span></span><br><span class=\"line\">          <span class=\"attr\">periodSeconds:</span> <span class=\"number\">10</span></span><br><span class=\"line\">        <span class=\"attr\">resources:</span></span><br><span class=\"line\">          <span class=\"attr\">requests:</span></span><br><span class=\"line\">            <span class=\"attr\">cpu:</span> <span class=\"string\">100m</span></span><br><span class=\"line\">            <span class=\"attr\">memory:</span> <span class=\"string\">200Mi</span></span><br><span class=\"line\">        <span class=\"attr\">securityContext:</span></span><br><span class=\"line\">          <span class=\"attr\">allowPrivilegeEscalation:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">          <span class=\"attr\">readOnlyRootFilesystem:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">          <span class=\"attr\">runAsNonRoot:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">          <span class=\"attr\">runAsUser:</span> <span class=\"number\">1000</span></span><br><span class=\"line\">        <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">mountPath:</span> <span class=\"string\">/tmp</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">tmp-dir</span></span><br><span class=\"line\">      <span class=\"attr\">nodeSelector:</span></span><br><span class=\"line\">        <span class=\"attr\">kubernetes.io/os:</span> <span class=\"string\">linux</span></span><br><span class=\"line\">      <span class=\"attr\">priorityClassName:</span> <span class=\"string\">system-cluster-critical</span></span><br><span class=\"line\">      <span class=\"attr\">serviceAccountName:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">      <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">emptyDir:</span> &#123;&#125;</span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">tmp-dir</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apiregistration.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">APIService</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">v1beta1.metrics.k8s.io</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">group:</span> <span class=\"string\">metrics.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">groupPriorityMinimum:</span> <span class=\"number\">100</span></span><br><span class=\"line\">  <span class=\"attr\">insecureSkipTLSVerify:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">service:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">    <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\">  <span class=\"attr\">version:</span> <span class=\"string\">v1beta1</span></span><br><span class=\"line\">  <span class=\"attr\">versionPriority:</span> <span class=\"number\">100</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f metrics-server.yaml</span><br></pre></td></tr></table></figure>","site":{"data":{"link":[{"class_name":"友情鏈接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、簡單且強大的網誌框架"}]},{"class_name":"網站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":false,"excerpt":"","more":"<p>使用kubectl top命名需要安装metrics-server,否则会报错: error: Metrics API not available<br>使用如下yaml文件安装metrics-server:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">    <span class=\"attr\">rbac.authorization.k8s.io/aggregate-to-admin:</span> <span class=\"string\">&quot;true&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">rbac.authorization.k8s.io/aggregate-to-edit:</span> <span class=\"string\">&quot;true&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">rbac.authorization.k8s.io/aggregate-to-view:</span> <span class=\"string\">&quot;true&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">system:aggregated-metrics-reader</span></span><br><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">metrics.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">pods</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">nodes</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">get</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">list</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">watch</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">system:metrics-server</span></span><br><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">nodes/metrics</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">get</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">pods</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">nodes</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">get</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">list</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">watch</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">RoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server-auth-reader</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\">  <span class=\"attr\">apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">kind:</span> <span class=\"string\">Role</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">extension-apiserver-authentication-reader</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server:system:auth-delegator</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\">  <span class=\"attr\">apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">system:auth-delegator</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">system:metrics-server</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\">  <span class=\"attr\">apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">system:metrics-server</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">https</span></span><br><span class=\"line\">    <span class=\"attr\">port:</span> <span class=\"number\">443</span></span><br><span class=\"line\">    <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"string\">https</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">strategy:</span></span><br><span class=\"line\">    <span class=\"attr\">rollingUpdate:</span></span><br><span class=\"line\">      <span class=\"attr\">maxUnavailable:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">args:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--cert-dir=/tmp</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--secure-port=4443</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--kubelet-use-node-status-port</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--metric-resolution=15s</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--kubelet-insecure-tls</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">registry.cn-hangzhou.aliyuncs.com/google_containers/metrics-server:v0.6.4</span></span><br><span class=\"line\">        <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\">        <span class=\"attr\">livenessProbe:</span></span><br><span class=\"line\">          <span class=\"attr\">failureThreshold:</span> <span class=\"number\">3</span></span><br><span class=\"line\">          <span class=\"attr\">httpGet:</span></span><br><span class=\"line\">            <span class=\"attr\">path:</span> <span class=\"string\">/livez</span></span><br><span class=\"line\">            <span class=\"attr\">port:</span> <span class=\"string\">https</span></span><br><span class=\"line\">            <span class=\"attr\">scheme:</span> <span class=\"string\">HTTPS</span></span><br><span class=\"line\">          <span class=\"attr\">periodSeconds:</span> <span class=\"number\">10</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">4443</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">https</span></span><br><span class=\"line\">          <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\">        <span class=\"attr\">readinessProbe:</span></span><br><span class=\"line\">          <span class=\"attr\">failureThreshold:</span> <span class=\"number\">3</span></span><br><span class=\"line\">          <span class=\"attr\">httpGet:</span></span><br><span class=\"line\">            <span class=\"attr\">path:</span> <span class=\"string\">/readyz</span></span><br><span class=\"line\">            <span class=\"attr\">port:</span> <span class=\"string\">https</span></span><br><span class=\"line\">            <span class=\"attr\">scheme:</span> <span class=\"string\">HTTPS</span></span><br><span class=\"line\">          <span class=\"attr\">initialDelaySeconds:</span> <span class=\"number\">20</span></span><br><span class=\"line\">          <span class=\"attr\">periodSeconds:</span> <span class=\"number\">10</span></span><br><span class=\"line\">        <span class=\"attr\">resources:</span></span><br><span class=\"line\">          <span class=\"attr\">requests:</span></span><br><span class=\"line\">            <span class=\"attr\">cpu:</span> <span class=\"string\">100m</span></span><br><span class=\"line\">            <span class=\"attr\">memory:</span> <span class=\"string\">200Mi</span></span><br><span class=\"line\">        <span class=\"attr\">securityContext:</span></span><br><span class=\"line\">          <span class=\"attr\">allowPrivilegeEscalation:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">          <span class=\"attr\">readOnlyRootFilesystem:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">          <span class=\"attr\">runAsNonRoot:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">          <span class=\"attr\">runAsUser:</span> <span class=\"number\">1000</span></span><br><span class=\"line\">        <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">mountPath:</span> <span class=\"string\">/tmp</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">tmp-dir</span></span><br><span class=\"line\">      <span class=\"attr\">nodeSelector:</span></span><br><span class=\"line\">        <span class=\"attr\">kubernetes.io/os:</span> <span class=\"string\">linux</span></span><br><span class=\"line\">      <span class=\"attr\">priorityClassName:</span> <span class=\"string\">system-cluster-critical</span></span><br><span class=\"line\">      <span class=\"attr\">serviceAccountName:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">      <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">emptyDir:</span> &#123;&#125;</span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">tmp-dir</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apiregistration.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">APIService</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">v1beta1.metrics.k8s.io</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">group:</span> <span class=\"string\">metrics.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">groupPriorityMinimum:</span> <span class=\"number\">100</span></span><br><span class=\"line\">  <span class=\"attr\">insecureSkipTLSVerify:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">service:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">    <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\">  <span class=\"attr\">version:</span> <span class=\"string\">v1beta1</span></span><br><span class=\"line\">  <span class=\"attr\">versionPriority:</span> <span class=\"number\">100</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f metrics-server.yaml</span><br></pre></td></tr></table></figure>"},{"title":"metrics/cadvisor,kube-state-metrics,node-exporter","date":"2023-08-18T10:30:53.000Z","_content":"# kubelet的metrics/cadvisor\nKubelet是Kubernetes主节点的一个核心组件，负责管理节点上的容器，以及与主控平面进行通信。Kubelet通过提供不同的接口和嵌入式组件来收集和暴露节点和容器的监控指标。\n\n1. Kubelet监控指标：\n   - Kubelet启动的Pod数目\n   - Kubelet已经完成的Pod数目\n   - Kubelet当前正在运行的Pod数目\n   - Kubelet拒绝启动的Pod数目\n   - Kubelet处理错误的Pod数目\n   - Kubelet未知状态的Pod数目\n   - Kubelet容器运行时间\n   - Kubelet容器CPU使用率\n   - Kubelet容器内存使用率\n   - Kubelet存储设备使用率\n   - Kubelet网络上行流量\n   - Kubelet网络下行流量\n   - Kubelet容器磁盘使用量\n   - Kubelet容器文件系统使用率\n   - Kubelet容器日志记录量\n\n2. cAdvisor监控指标：\n   - 容器的CPU使用率\n   - 容器的内存使用率\n   - 容器的磁盘使用率\n   - 容器的网络上行流量\n   - 容器的网络下行流量\n   - 容器的文件系统使用率\n   - 容器的日志记录量\n   - 容器的进程数\n   - 容器的打开文件数\n   - 容器的线程数\n   - 容器的磁盘I/O使用率\n   - 容器的网络延迟\n   - 容器的网络吞吐量\n   - 容器的内存压缩率\n   - 容器的内存丢失\n   - 容器的CPU限制与请求\n\n总体来说，Kubelet和cAdvisor提供了丰富的监控指标，可以用于监视节点和容器的资源使用情况、运行状态及性能状况。这些指标对于在Kubernetes集群中管理和优化容器化应用程序的性能和可靠性非常有帮助。\n# kube-state-metrics\nkube-state-metrics（KSM）是一个用于将Kubernetes集群的状态信息转换为Prometheus指标的开源项目。它可以提供丰富的监控指标，用于监控Kubernetes集群中的各种资源和对象。以下是Kube-state-metrics提供的一些主要监控指标：\n\n1. 节点指标（Node Metrics）：包括节点的CPU利用率、内存利用率、磁盘空间利用率等信息。\n\n2. Pod指标（Pod Metrics）：包括Pod的CPU利用率、内存利用率、网络流量等信息。\n\n3. 命名空间指标（Namespace Metrics）：包括命名空间中的Pod、Replication Controller、Deployment、DaemonSet等资源的数量和状态信息。\n\n4. 服务指标（Service Metrics）：包括服务的连接数、请求流量、响应时间等信息。\n\n5. 部署指标（Deployment Metrics）：包括部署的副本数量、可用副本数量、滚动更新状态等信息。\n\n6. 容器指标（Container Metrics）：包括容器的CPU利用率、内存利用率、文件系统使用情况等信息。\n\n7. StatefulSet指标（StatefulSet Metrics）：包括StatefulSet的副本数量、可用副本数量、当前状态等信息。\n\n8. 守护进程指标（DaemonSet Metrics）：包括DaemonSet的副本数量、可用副本数量、当前状态等信息。\n\n9. 任务指标（Job Metrics）：包括任务的运行状态、副本数量、成功和失败的次数等信息。\n\n这些指标可以提供关于Kubernetes集群和其中资源的性能、状态和健康状况的详细信息。使用这些指标，可以进行实时监控、性能优化、故障排除和容量规划，以确保集群的稳定性和可靠性。\n# node-exporter\nNode Exporter 是一种用于 Prometheus 的开源代理，用于暴露各种系统级监控指标。它可以在 Linux 系统上工作，并提供以下类型的监控指标：\n\n1. 系统指标：包括 CPU 使用率、内存使用率、磁盘使用率、磁盘 I/O 情况、网络流量、文件系统使用率等。这些指标可以帮助管理员了解系统的整体状态和资源利用情况。\n\n2. 进程指标：可以获取正在运行的进程数、进程CPU和内存使用情况、进程网络连接数等信息。通过这些指标，可以监控和识别系统中资源占用较多的进程，从而及时调整和优化。\n\n3. 网络指标：包括网络接口的带宽利用率、传输速率、丢包率和错误率等。这些指标可以帮助了解网络流量情况，监控网络性能和及时发现问题。\n\n4. 磁盘指标：包括磁盘使用率、磁盘读写速度、磁盘IO等。这些指标可以帮助监控磁盘的健康状况、数据读写速度和IO性能。\n\n5. 内存指标：包括内存使用量、内存交换情况、内存分页等。这些指标可以帮助了解内存的使用情况和性能。\n\n6. CPU 指标：包括 CPU 使用率、CPU 温度、CPU 核心数等。这些指标可以帮助监控系统的负载情况和CPU性能。\n\n7. 运行时间指标：包括系统的运行时间以及系统启动后的负载状况。这些指标可以帮助了解系统的稳定性和运行时间。\n\n除了以上列举的指标，Node Exporter 还提供了其他许多监控指标，以及一些自定义指标的扩展方式。用户可以根据需要选择性地监控和收集这些指标，以满足对系统性能和资源利用的需求。","source":"_posts/kubernetes/monitor.md","raw":"---\ntitle: metrics/cadvisor,kube-state-metrics,node-exporter\ndate: 2023-08-18 18:30:53\ncategories:\n  - [kubernetes]\ntags: kubernetes\n---\n# kubelet的metrics/cadvisor\nKubelet是Kubernetes主节点的一个核心组件，负责管理节点上的容器，以及与主控平面进行通信。Kubelet通过提供不同的接口和嵌入式组件来收集和暴露节点和容器的监控指标。\n\n1. Kubelet监控指标：\n   - Kubelet启动的Pod数目\n   - Kubelet已经完成的Pod数目\n   - Kubelet当前正在运行的Pod数目\n   - Kubelet拒绝启动的Pod数目\n   - Kubelet处理错误的Pod数目\n   - Kubelet未知状态的Pod数目\n   - Kubelet容器运行时间\n   - Kubelet容器CPU使用率\n   - Kubelet容器内存使用率\n   - Kubelet存储设备使用率\n   - Kubelet网络上行流量\n   - Kubelet网络下行流量\n   - Kubelet容器磁盘使用量\n   - Kubelet容器文件系统使用率\n   - Kubelet容器日志记录量\n\n2. cAdvisor监控指标：\n   - 容器的CPU使用率\n   - 容器的内存使用率\n   - 容器的磁盘使用率\n   - 容器的网络上行流量\n   - 容器的网络下行流量\n   - 容器的文件系统使用率\n   - 容器的日志记录量\n   - 容器的进程数\n   - 容器的打开文件数\n   - 容器的线程数\n   - 容器的磁盘I/O使用率\n   - 容器的网络延迟\n   - 容器的网络吞吐量\n   - 容器的内存压缩率\n   - 容器的内存丢失\n   - 容器的CPU限制与请求\n\n总体来说，Kubelet和cAdvisor提供了丰富的监控指标，可以用于监视节点和容器的资源使用情况、运行状态及性能状况。这些指标对于在Kubernetes集群中管理和优化容器化应用程序的性能和可靠性非常有帮助。\n# kube-state-metrics\nkube-state-metrics（KSM）是一个用于将Kubernetes集群的状态信息转换为Prometheus指标的开源项目。它可以提供丰富的监控指标，用于监控Kubernetes集群中的各种资源和对象。以下是Kube-state-metrics提供的一些主要监控指标：\n\n1. 节点指标（Node Metrics）：包括节点的CPU利用率、内存利用率、磁盘空间利用率等信息。\n\n2. Pod指标（Pod Metrics）：包括Pod的CPU利用率、内存利用率、网络流量等信息。\n\n3. 命名空间指标（Namespace Metrics）：包括命名空间中的Pod、Replication Controller、Deployment、DaemonSet等资源的数量和状态信息。\n\n4. 服务指标（Service Metrics）：包括服务的连接数、请求流量、响应时间等信息。\n\n5. 部署指标（Deployment Metrics）：包括部署的副本数量、可用副本数量、滚动更新状态等信息。\n\n6. 容器指标（Container Metrics）：包括容器的CPU利用率、内存利用率、文件系统使用情况等信息。\n\n7. StatefulSet指标（StatefulSet Metrics）：包括StatefulSet的副本数量、可用副本数量、当前状态等信息。\n\n8. 守护进程指标（DaemonSet Metrics）：包括DaemonSet的副本数量、可用副本数量、当前状态等信息。\n\n9. 任务指标（Job Metrics）：包括任务的运行状态、副本数量、成功和失败的次数等信息。\n\n这些指标可以提供关于Kubernetes集群和其中资源的性能、状态和健康状况的详细信息。使用这些指标，可以进行实时监控、性能优化、故障排除和容量规划，以确保集群的稳定性和可靠性。\n# node-exporter\nNode Exporter 是一种用于 Prometheus 的开源代理，用于暴露各种系统级监控指标。它可以在 Linux 系统上工作，并提供以下类型的监控指标：\n\n1. 系统指标：包括 CPU 使用率、内存使用率、磁盘使用率、磁盘 I/O 情况、网络流量、文件系统使用率等。这些指标可以帮助管理员了解系统的整体状态和资源利用情况。\n\n2. 进程指标：可以获取正在运行的进程数、进程CPU和内存使用情况、进程网络连接数等信息。通过这些指标，可以监控和识别系统中资源占用较多的进程，从而及时调整和优化。\n\n3. 网络指标：包括网络接口的带宽利用率、传输速率、丢包率和错误率等。这些指标可以帮助了解网络流量情况，监控网络性能和及时发现问题。\n\n4. 磁盘指标：包括磁盘使用率、磁盘读写速度、磁盘IO等。这些指标可以帮助监控磁盘的健康状况、数据读写速度和IO性能。\n\n5. 内存指标：包括内存使用量、内存交换情况、内存分页等。这些指标可以帮助了解内存的使用情况和性能。\n\n6. CPU 指标：包括 CPU 使用率、CPU 温度、CPU 核心数等。这些指标可以帮助监控系统的负载情况和CPU性能。\n\n7. 运行时间指标：包括系统的运行时间以及系统启动后的负载状况。这些指标可以帮助了解系统的稳定性和运行时间。\n\n除了以上列举的指标，Node Exporter 还提供了其他许多监控指标，以及一些自定义指标的扩展方式。用户可以根据需要选择性地监控和收集这些指标，以满足对系统性能和资源利用的需求。","slug":"kubernetes/monitor","published":1,"updated":"2023-08-23T06:55:44.756Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clo89v5eu000zb7jxf3i1dg45","content":"<h1 id=\"kubelet的metrics-cadvisor\"><a href=\"#kubelet的metrics-cadvisor\" class=\"headerlink\" title=\"kubelet的metrics&#x2F;cadvisor\"></a>kubelet的metrics&#x2F;cadvisor</h1><p>Kubelet是Kubernetes主节点的一个核心组件，负责管理节点上的容器，以及与主控平面进行通信。Kubelet通过提供不同的接口和嵌入式组件来收集和暴露节点和容器的监控指标。</p>\n<ol>\n<li><p>Kubelet监控指标：</p>\n<ul>\n<li>Kubelet启动的Pod数目</li>\n<li>Kubelet已经完成的Pod数目</li>\n<li>Kubelet当前正在运行的Pod数目</li>\n<li>Kubelet拒绝启动的Pod数目</li>\n<li>Kubelet处理错误的Pod数目</li>\n<li>Kubelet未知状态的Pod数目</li>\n<li>Kubelet容器运行时间</li>\n<li>Kubelet容器CPU使用率</li>\n<li>Kubelet容器内存使用率</li>\n<li>Kubelet存储设备使用率</li>\n<li>Kubelet网络上行流量</li>\n<li>Kubelet网络下行流量</li>\n<li>Kubelet容器磁盘使用量</li>\n<li>Kubelet容器文件系统使用率</li>\n<li>Kubelet容器日志记录量</li>\n</ul>\n</li>\n<li><p>cAdvisor监控指标：</p>\n<ul>\n<li>容器的CPU使用率</li>\n<li>容器的内存使用率</li>\n<li>容器的磁盘使用率</li>\n<li>容器的网络上行流量</li>\n<li>容器的网络下行流量</li>\n<li>容器的文件系统使用率</li>\n<li>容器的日志记录量</li>\n<li>容器的进程数</li>\n<li>容器的打开文件数</li>\n<li>容器的线程数</li>\n<li>容器的磁盘I&#x2F;O使用率</li>\n<li>容器的网络延迟</li>\n<li>容器的网络吞吐量</li>\n<li>容器的内存压缩率</li>\n<li>容器的内存丢失</li>\n<li>容器的CPU限制与请求</li>\n</ul>\n</li>\n</ol>\n<p>总体来说，Kubelet和cAdvisor提供了丰富的监控指标，可以用于监视节点和容器的资源使用情况、运行状态及性能状况。这些指标对于在Kubernetes集群中管理和优化容器化应用程序的性能和可靠性非常有帮助。</p>\n<h1 id=\"kube-state-metrics\"><a href=\"#kube-state-metrics\" class=\"headerlink\" title=\"kube-state-metrics\"></a>kube-state-metrics</h1><p>kube-state-metrics（KSM）是一个用于将Kubernetes集群的状态信息转换为Prometheus指标的开源项目。它可以提供丰富的监控指标，用于监控Kubernetes集群中的各种资源和对象。以下是Kube-state-metrics提供的一些主要监控指标：</p>\n<ol>\n<li><p>节点指标（Node Metrics）：包括节点的CPU利用率、内存利用率、磁盘空间利用率等信息。</p>\n</li>\n<li><p>Pod指标（Pod Metrics）：包括Pod的CPU利用率、内存利用率、网络流量等信息。</p>\n</li>\n<li><p>命名空间指标（Namespace Metrics）：包括命名空间中的Pod、Replication Controller、Deployment、DaemonSet等资源的数量和状态信息。</p>\n</li>\n<li><p>服务指标（Service Metrics）：包括服务的连接数、请求流量、响应时间等信息。</p>\n</li>\n<li><p>部署指标（Deployment Metrics）：包括部署的副本数量、可用副本数量、滚动更新状态等信息。</p>\n</li>\n<li><p>容器指标（Container Metrics）：包括容器的CPU利用率、内存利用率、文件系统使用情况等信息。</p>\n</li>\n<li><p>StatefulSet指标（StatefulSet Metrics）：包括StatefulSet的副本数量、可用副本数量、当前状态等信息。</p>\n</li>\n<li><p>守护进程指标（DaemonSet Metrics）：包括DaemonSet的副本数量、可用副本数量、当前状态等信息。</p>\n</li>\n<li><p>任务指标（Job Metrics）：包括任务的运行状态、副本数量、成功和失败的次数等信息。</p>\n</li>\n</ol>\n<p>这些指标可以提供关于Kubernetes集群和其中资源的性能、状态和健康状况的详细信息。使用这些指标，可以进行实时监控、性能优化、故障排除和容量规划，以确保集群的稳定性和可靠性。</p>\n<h1 id=\"node-exporter\"><a href=\"#node-exporter\" class=\"headerlink\" title=\"node-exporter\"></a>node-exporter</h1><p>Node Exporter 是一种用于 Prometheus 的开源代理，用于暴露各种系统级监控指标。它可以在 Linux 系统上工作，并提供以下类型的监控指标：</p>\n<ol>\n<li><p>系统指标：包括 CPU 使用率、内存使用率、磁盘使用率、磁盘 I&#x2F;O 情况、网络流量、文件系统使用率等。这些指标可以帮助管理员了解系统的整体状态和资源利用情况。</p>\n</li>\n<li><p>进程指标：可以获取正在运行的进程数、进程CPU和内存使用情况、进程网络连接数等信息。通过这些指标，可以监控和识别系统中资源占用较多的进程，从而及时调整和优化。</p>\n</li>\n<li><p>网络指标：包括网络接口的带宽利用率、传输速率、丢包率和错误率等。这些指标可以帮助了解网络流量情况，监控网络性能和及时发现问题。</p>\n</li>\n<li><p>磁盘指标：包括磁盘使用率、磁盘读写速度、磁盘IO等。这些指标可以帮助监控磁盘的健康状况、数据读写速度和IO性能。</p>\n</li>\n<li><p>内存指标：包括内存使用量、内存交换情况、内存分页等。这些指标可以帮助了解内存的使用情况和性能。</p>\n</li>\n<li><p>CPU 指标：包括 CPU 使用率、CPU 温度、CPU 核心数等。这些指标可以帮助监控系统的负载情况和CPU性能。</p>\n</li>\n<li><p>运行时间指标：包括系统的运行时间以及系统启动后的负载状况。这些指标可以帮助了解系统的稳定性和运行时间。</p>\n</li>\n</ol>\n<p>除了以上列举的指标，Node Exporter 还提供了其他许多监控指标，以及一些自定义指标的扩展方式。用户可以根据需要选择性地监控和收集这些指标，以满足对系统性能和资源利用的需求。</p>\n","site":{"data":{"link":[{"class_name":"友情鏈接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、簡單且強大的網誌框架"}]},{"class_name":"網站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":false,"excerpt":"","more":"<h1 id=\"kubelet的metrics-cadvisor\"><a href=\"#kubelet的metrics-cadvisor\" class=\"headerlink\" title=\"kubelet的metrics&#x2F;cadvisor\"></a>kubelet的metrics&#x2F;cadvisor</h1><p>Kubelet是Kubernetes主节点的一个核心组件，负责管理节点上的容器，以及与主控平面进行通信。Kubelet通过提供不同的接口和嵌入式组件来收集和暴露节点和容器的监控指标。</p>\n<ol>\n<li><p>Kubelet监控指标：</p>\n<ul>\n<li>Kubelet启动的Pod数目</li>\n<li>Kubelet已经完成的Pod数目</li>\n<li>Kubelet当前正在运行的Pod数目</li>\n<li>Kubelet拒绝启动的Pod数目</li>\n<li>Kubelet处理错误的Pod数目</li>\n<li>Kubelet未知状态的Pod数目</li>\n<li>Kubelet容器运行时间</li>\n<li>Kubelet容器CPU使用率</li>\n<li>Kubelet容器内存使用率</li>\n<li>Kubelet存储设备使用率</li>\n<li>Kubelet网络上行流量</li>\n<li>Kubelet网络下行流量</li>\n<li>Kubelet容器磁盘使用量</li>\n<li>Kubelet容器文件系统使用率</li>\n<li>Kubelet容器日志记录量</li>\n</ul>\n</li>\n<li><p>cAdvisor监控指标：</p>\n<ul>\n<li>容器的CPU使用率</li>\n<li>容器的内存使用率</li>\n<li>容器的磁盘使用率</li>\n<li>容器的网络上行流量</li>\n<li>容器的网络下行流量</li>\n<li>容器的文件系统使用率</li>\n<li>容器的日志记录量</li>\n<li>容器的进程数</li>\n<li>容器的打开文件数</li>\n<li>容器的线程数</li>\n<li>容器的磁盘I&#x2F;O使用率</li>\n<li>容器的网络延迟</li>\n<li>容器的网络吞吐量</li>\n<li>容器的内存压缩率</li>\n<li>容器的内存丢失</li>\n<li>容器的CPU限制与请求</li>\n</ul>\n</li>\n</ol>\n<p>总体来说，Kubelet和cAdvisor提供了丰富的监控指标，可以用于监视节点和容器的资源使用情况、运行状态及性能状况。这些指标对于在Kubernetes集群中管理和优化容器化应用程序的性能和可靠性非常有帮助。</p>\n<h1 id=\"kube-state-metrics\"><a href=\"#kube-state-metrics\" class=\"headerlink\" title=\"kube-state-metrics\"></a>kube-state-metrics</h1><p>kube-state-metrics（KSM）是一个用于将Kubernetes集群的状态信息转换为Prometheus指标的开源项目。它可以提供丰富的监控指标，用于监控Kubernetes集群中的各种资源和对象。以下是Kube-state-metrics提供的一些主要监控指标：</p>\n<ol>\n<li><p>节点指标（Node Metrics）：包括节点的CPU利用率、内存利用率、磁盘空间利用率等信息。</p>\n</li>\n<li><p>Pod指标（Pod Metrics）：包括Pod的CPU利用率、内存利用率、网络流量等信息。</p>\n</li>\n<li><p>命名空间指标（Namespace Metrics）：包括命名空间中的Pod、Replication Controller、Deployment、DaemonSet等资源的数量和状态信息。</p>\n</li>\n<li><p>服务指标（Service Metrics）：包括服务的连接数、请求流量、响应时间等信息。</p>\n</li>\n<li><p>部署指标（Deployment Metrics）：包括部署的副本数量、可用副本数量、滚动更新状态等信息。</p>\n</li>\n<li><p>容器指标（Container Metrics）：包括容器的CPU利用率、内存利用率、文件系统使用情况等信息。</p>\n</li>\n<li><p>StatefulSet指标（StatefulSet Metrics）：包括StatefulSet的副本数量、可用副本数量、当前状态等信息。</p>\n</li>\n<li><p>守护进程指标（DaemonSet Metrics）：包括DaemonSet的副本数量、可用副本数量、当前状态等信息。</p>\n</li>\n<li><p>任务指标（Job Metrics）：包括任务的运行状态、副本数量、成功和失败的次数等信息。</p>\n</li>\n</ol>\n<p>这些指标可以提供关于Kubernetes集群和其中资源的性能、状态和健康状况的详细信息。使用这些指标，可以进行实时监控、性能优化、故障排除和容量规划，以确保集群的稳定性和可靠性。</p>\n<h1 id=\"node-exporter\"><a href=\"#node-exporter\" class=\"headerlink\" title=\"node-exporter\"></a>node-exporter</h1><p>Node Exporter 是一种用于 Prometheus 的开源代理，用于暴露各种系统级监控指标。它可以在 Linux 系统上工作，并提供以下类型的监控指标：</p>\n<ol>\n<li><p>系统指标：包括 CPU 使用率、内存使用率、磁盘使用率、磁盘 I&#x2F;O 情况、网络流量、文件系统使用率等。这些指标可以帮助管理员了解系统的整体状态和资源利用情况。</p>\n</li>\n<li><p>进程指标：可以获取正在运行的进程数、进程CPU和内存使用情况、进程网络连接数等信息。通过这些指标，可以监控和识别系统中资源占用较多的进程，从而及时调整和优化。</p>\n</li>\n<li><p>网络指标：包括网络接口的带宽利用率、传输速率、丢包率和错误率等。这些指标可以帮助了解网络流量情况，监控网络性能和及时发现问题。</p>\n</li>\n<li><p>磁盘指标：包括磁盘使用率、磁盘读写速度、磁盘IO等。这些指标可以帮助监控磁盘的健康状况、数据读写速度和IO性能。</p>\n</li>\n<li><p>内存指标：包括内存使用量、内存交换情况、内存分页等。这些指标可以帮助了解内存的使用情况和性能。</p>\n</li>\n<li><p>CPU 指标：包括 CPU 使用率、CPU 温度、CPU 核心数等。这些指标可以帮助监控系统的负载情况和CPU性能。</p>\n</li>\n<li><p>运行时间指标：包括系统的运行时间以及系统启动后的负载状况。这些指标可以帮助了解系统的稳定性和运行时间。</p>\n</li>\n</ol>\n<p>除了以上列举的指标，Node Exporter 还提供了其他许多监控指标，以及一些自定义指标的扩展方式。用户可以根据需要选择性地监控和收集这些指标，以满足对系统性能和资源利用的需求。</p>\n"},{"title":"uninstall containerd","date":"2023-08-22T03:39:52.000Z","_content":"要彻底清除 Kubernetes 集群节点上的 containerd，可以按照以下步骤进行：\n\nStep 1: 停止并移除所有运行的容器\n```\n$ crictl ps -a | awk '{if(NR>1) print $1}' | xargs -I {} crictl rm {}\n```\n这将停止并删除节点上所有正在运行的容器。\n\nStep 2: 停止并禁用 containerd 服务\n```\n$ systemctl stop containerd\n$ systemctl disable containerd\n```\n这将停止并禁用 containerd 服务。\n\nStep 3: 卸载 containerd 软件包\n```\n$ yum remove containerd -y\n```\n根据你的系统，可能需要使用适当的软件包管理器（如apt、dnf）来移除 containerd 软件包。\n\nStep 4: 删除 containerd 配置目录\n```\n$ rm -rf /etc/containerd\n```\n这将删除 containerd 的配置文件。\n\nStep 5: 删除 containerd 数据目录\n```\n$ rm -rf /var/lib/containerd\n```\n这将删除 containerd 的数据目录。\n\nStep 6: 清理 containerd 相关的 iptables 规则\n```\n$ iptables -t nat -F\n$ iptables -t mangle -F\n```\n这将清除与 containerd 相关的 iptables 规则。\n\nStep 7: 检查是否有残留的 containerd 配置文件\n```\n$ ls /etc/systemd/system/containerd*\n```\n如果输出中有任何文件，则手动删除它们：\n```\n$ rm /etc/systemd/system/containerd*.service\n```\n\n现在，你的 Kubernetes 集群节点上的 containerd 已经彻底卸载。","source":"_posts/kubernetes/uninstall_cintainerd.md","raw":"---\ntitle: uninstall containerd\ndate: 2023-08-22 11:39:52\ncategories:\n  - [kubernetes]\ntags: containerd\n---\n要彻底清除 Kubernetes 集群节点上的 containerd，可以按照以下步骤进行：\n\nStep 1: 停止并移除所有运行的容器\n```\n$ crictl ps -a | awk '{if(NR>1) print $1}' | xargs -I {} crictl rm {}\n```\n这将停止并删除节点上所有正在运行的容器。\n\nStep 2: 停止并禁用 containerd 服务\n```\n$ systemctl stop containerd\n$ systemctl disable containerd\n```\n这将停止并禁用 containerd 服务。\n\nStep 3: 卸载 containerd 软件包\n```\n$ yum remove containerd -y\n```\n根据你的系统，可能需要使用适当的软件包管理器（如apt、dnf）来移除 containerd 软件包。\n\nStep 4: 删除 containerd 配置目录\n```\n$ rm -rf /etc/containerd\n```\n这将删除 containerd 的配置文件。\n\nStep 5: 删除 containerd 数据目录\n```\n$ rm -rf /var/lib/containerd\n```\n这将删除 containerd 的数据目录。\n\nStep 6: 清理 containerd 相关的 iptables 规则\n```\n$ iptables -t nat -F\n$ iptables -t mangle -F\n```\n这将清除与 containerd 相关的 iptables 规则。\n\nStep 7: 检查是否有残留的 containerd 配置文件\n```\n$ ls /etc/systemd/system/containerd*\n```\n如果输出中有任何文件，则手动删除它们：\n```\n$ rm /etc/systemd/system/containerd*.service\n```\n\n现在，你的 Kubernetes 集群节点上的 containerd 已经彻底卸载。","slug":"kubernetes/uninstall_cintainerd","published":1,"updated":"2023-08-22T07:29:52.616Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clo89v5fw001vb7jx033f2n5b","content":"<p>要彻底清除 Kubernetes 集群节点上的 containerd，可以按照以下步骤进行：</p>\n<p>Step 1: 停止并移除所有运行的容器</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ crictl ps -a | awk &#x27;&#123;if(NR&gt;1) print $1&#125;&#x27; | xargs -I &#123;&#125; crictl rm &#123;&#125;</span><br></pre></td></tr></table></figure>\n<p>这将停止并删除节点上所有正在运行的容器。</p>\n<p>Step 2: 停止并禁用 containerd 服务</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ systemctl stop containerd</span><br><span class=\"line\">$ systemctl disable containerd</span><br></pre></td></tr></table></figure>\n<p>这将停止并禁用 containerd 服务。</p>\n<p>Step 3: 卸载 containerd 软件包</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ yum remove containerd -y</span><br></pre></td></tr></table></figure>\n<p>根据你的系统，可能需要使用适当的软件包管理器（如apt、dnf）来移除 containerd 软件包。</p>\n<p>Step 4: 删除 containerd 配置目录</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ rm -rf /etc/containerd</span><br></pre></td></tr></table></figure>\n<p>这将删除 containerd 的配置文件。</p>\n<p>Step 5: 删除 containerd 数据目录</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ rm -rf /var/lib/containerd</span><br></pre></td></tr></table></figure>\n<p>这将删除 containerd 的数据目录。</p>\n<p>Step 6: 清理 containerd 相关的 iptables 规则</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ iptables -t nat -F</span><br><span class=\"line\">$ iptables -t mangle -F</span><br></pre></td></tr></table></figure>\n<p>这将清除与 containerd 相关的 iptables 规则。</p>\n<p>Step 7: 检查是否有残留的 containerd 配置文件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ls /etc/systemd/system/containerd*</span><br></pre></td></tr></table></figure>\n<p>如果输出中有任何文件，则手动删除它们：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ rm /etc/systemd/system/containerd*.service</span><br></pre></td></tr></table></figure>\n\n<p>现在，你的 Kubernetes 集群节点上的 containerd 已经彻底卸载。</p>\n","site":{"data":{"link":[{"class_name":"友情鏈接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、簡單且強大的網誌框架"}]},{"class_name":"網站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}},"cover":false,"excerpt":"","more":"<p>要彻底清除 Kubernetes 集群节点上的 containerd，可以按照以下步骤进行：</p>\n<p>Step 1: 停止并移除所有运行的容器</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ crictl ps -a | awk &#x27;&#123;if(NR&gt;1) print $1&#125;&#x27; | xargs -I &#123;&#125; crictl rm &#123;&#125;</span><br></pre></td></tr></table></figure>\n<p>这将停止并删除节点上所有正在运行的容器。</p>\n<p>Step 2: 停止并禁用 containerd 服务</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ systemctl stop containerd</span><br><span class=\"line\">$ systemctl disable containerd</span><br></pre></td></tr></table></figure>\n<p>这将停止并禁用 containerd 服务。</p>\n<p>Step 3: 卸载 containerd 软件包</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ yum remove containerd -y</span><br></pre></td></tr></table></figure>\n<p>根据你的系统，可能需要使用适当的软件包管理器（如apt、dnf）来移除 containerd 软件包。</p>\n<p>Step 4: 删除 containerd 配置目录</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ rm -rf /etc/containerd</span><br></pre></td></tr></table></figure>\n<p>这将删除 containerd 的配置文件。</p>\n<p>Step 5: 删除 containerd 数据目录</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ rm -rf /var/lib/containerd</span><br></pre></td></tr></table></figure>\n<p>这将删除 containerd 的数据目录。</p>\n<p>Step 6: 清理 containerd 相关的 iptables 规则</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ iptables -t nat -F</span><br><span class=\"line\">$ iptables -t mangle -F</span><br></pre></td></tr></table></figure>\n<p>这将清除与 containerd 相关的 iptables 规则。</p>\n<p>Step 7: 检查是否有残留的 containerd 配置文件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ls /etc/systemd/system/containerd*</span><br></pre></td></tr></table></figure>\n<p>如果输出中有任何文件，则手动删除它们：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ rm /etc/systemd/system/containerd*.service</span><br></pre></td></tr></table></figure>\n\n<p>现在，你的 Kubernetes 集群节点上的 containerd 已经彻底卸载。</p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"clo89v5dt0005b7jx62lhbcu4","category_id":"clo89v5e3000ab7jx4evb1cpi","_id":"clo89v5el000lb7jx2baoetg6"},{"post_id":"clo89v5dw0007b7jxd4cj1x57","category_id":"clo89v5ec000eb7jxcn5q2p89","_id":"clo89v5ep000sb7jx4uc21qyk"},{"post_id":"clo89v5e10009b7jx4hi8c6vn","category_id":"clo89v5ec000eb7jxcn5q2p89","_id":"clo89v5eu000xb7jxgedb75sq"},{"post_id":"clo89v5e8000cb7jx9hd810tn","category_id":"clo89v5en000pb7jx3zf9029q","_id":"clo89v5ey0012b7jxa9u2hwzn"},{"post_id":"clo89v5et000wb7jx3imp69oo","category_id":"clo89v5es000vb7jx9ky06m6t","_id":"clo89v5ez0014b7jxeglq6lao"},{"post_id":"clo89v5ed000gb7jx1z7x2s6d","category_id":"clo89v5es000vb7jx9ky06m6t","_id":"clo89v5f10018b7jxey5q4gpa"},{"post_id":"clo89v5eu000zb7jxf3i1dg45","category_id":"clo89v5es000vb7jx9ky06m6t","_id":"clo89v5f10019b7jxc3xm71fb"},{"post_id":"clo89v5ef000hb7jx2q5e6ql3","category_id":"clo89v5es000vb7jx9ky06m6t","_id":"clo89v5f3001cb7jx7c925mvm"},{"post_id":"clo89v5ek000kb7jxcqw0313i","category_id":"clo89v5es000vb7jx9ky06m6t","_id":"clo89v5f8001gb7jxb7evhydv"},{"post_id":"clo89v5em000nb7jxh5auekrf","category_id":"clo89v5es000vb7jx9ky06m6t","_id":"clo89v5fd001kb7jx6xoxh8uz"},{"post_id":"clo89v5en000qb7jx2ygo4yig","category_id":"clo89v5es000vb7jx9ky06m6t","_id":"clo89v5fe001mb7jxb22r04u2"},{"post_id":"clo89v5ep000tb7jx5xunbz1a","category_id":"clo89v5es000vb7jx9ky06m6t","_id":"clo89v5fe001pb7jx5082905s"},{"post_id":"clo89v5fw001vb7jx033f2n5b","category_id":"clo89v5es000vb7jx9ky06m6t","_id":"clo89v5fz001xb7jx1kdz1oed"}],"PostTag":[{"post_id":"clo89v5dt0005b7jx62lhbcu4","tag_id":"clo89v5dy0008b7jx8l663jan","_id":"clo89v5ed000fb7jxdp895rpr"},{"post_id":"clo89v5dw0007b7jxd4cj1x57","tag_id":"clo89v5eb000db7jxdlj62qxj","_id":"clo89v5el000mb7jx7gv5cf8v"},{"post_id":"clo89v5e10009b7jx4hi8c6vn","tag_id":"clo89v5eb000db7jxdlj62qxj","_id":"clo89v5eo000rb7jxc834erhs"},{"post_id":"clo89v5e6000bb7jx326d9a3e","tag_id":"clo89v5em000ob7jx3mtl0c1w","_id":"clo89v5eu000yb7jx2fyb8nkd"},{"post_id":"clo89v5e8000cb7jx9hd810tn","tag_id":"clo89v5er000ub7jx4kpxd558","_id":"clo89v5ey0013b7jxa115b4bf"},{"post_id":"clo89v5ed000gb7jx1z7x2s6d","tag_id":"clo89v5ew0010b7jx8wbrgq55","_id":"clo89v5f00017b7jx0d2odns4"},{"post_id":"clo89v5ef000hb7jx2q5e6ql3","tag_id":"clo89v5ez0016b7jx0qcpe9aq","_id":"clo89v5f3001db7jx53jc4qqn"},{"post_id":"clo89v5ek000kb7jxcqw0313i","tag_id":"clo89v5ez0016b7jx0qcpe9aq","_id":"clo89v5f8001hb7jxgzp64j73"},{"post_id":"clo89v5em000nb7jxh5auekrf","tag_id":"clo89v5f4001fb7jxhyslbow0","_id":"clo89v5fd001lb7jx6703gopx"},{"post_id":"clo89v5en000qb7jx2ygo4yig","tag_id":"clo89v5fa001jb7jx5i4vdzdo","_id":"clo89v5fe001ob7jxe0irdagm"},{"post_id":"clo89v5ep000tb7jx5xunbz1a","tag_id":"clo89v5fe001nb7jxajkqh714","_id":"clo89v5ff001rb7jx353d062q"},{"post_id":"clo89v5et000wb7jx3imp69oo","tag_id":"clo89v5ff001qb7jx57daefdt","_id":"clo89v5fg001tb7jxeiyk25ml"},{"post_id":"clo89v5eu000zb7jxf3i1dg45","tag_id":"clo89v5ff001qb7jx57daefdt","_id":"clo89v5fg001ub7jxduwzf483"},{"post_id":"clo89v5fw001vb7jx033f2n5b","tag_id":"clo89v5fy001wb7jxgauo476b","_id":"clo89v5g0001yb7jxbgh14vn7"}],"Tag":[{"name":"docker","_id":"clo89v5dy0008b7jx8l663jan"},{"name":"golang","_id":"clo89v5eb000db7jxdlj62qxj"},{"name":"nodejs","_id":"clo89v5em000ob7jx3mtl0c1w"},{"name":"chrony","_id":"clo89v5er000ub7jx4kpxd558"},{"name":"deepflow","_id":"clo89v5ew0010b7jx8wbrgq55"},{"name":"logging","_id":"clo89v5ez0016b7jx0qcpe9aq"},{"name":"grafana","_id":"clo89v5f4001fb7jxhyslbow0"},{"name":"kibana","_id":"clo89v5fa001jb7jx5i4vdzdo"},{"name":"kubevirt","_id":"clo89v5fe001nb7jxajkqh714"},{"name":"kubernetes","_id":"clo89v5ff001qb7jx57daefdt"},{"name":"containerd","_id":"clo89v5fy001wb7jxgauo476b"}]}}